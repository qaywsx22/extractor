{"version":3,"sources":["components/Button.js","components/Paper.js","components/ValueChooser.js","components/PDFRenderer.js","components/BusyIndicator.js","components/Dialog.js","components/Extractor.js","index.js"],"names":["Button","React","forwardRef","props","ref","onClick","handleClick","title","className","children","Paper","state","file","updateViewBoxPosition","bind","setZoom","resetPosition","clearCanvas","cropImage","loadRasterImage","loadSVGImage","loadResultSVGImage","loadCropedImage","cancelMask","onKeyDown","removeOldImage","wrapper","createRef","paperId","crBlob","crImgUrl","paper","mask","startPos","moveFlag","newFlag","mdp","pausePanning","allowedTypes","imageOptions","hasControls","hasBorders","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockScewingX","lockScewingY","lockRotation","selectable","hoverCursor","opt","pt","this","getPointer","point","fabric","Point","x","y","onMouseWheelZoom","e","deltaY","preventDefault","stopPropagation","evt","type","startsWith","screenX","screenY","ctrlKey","Rect","fill","stroke","strokeDashArray","opacity","left","top","width","height","evented","selectionBorderColor","transparentCorners","cornerColor","cornerStrokeColor","hasBorder","id","add","setControlVisible","requestRenderAll","endPos","set","Math","abs","o","setCoords","setActiveObject","remove","pos","w","h","setWidth","current","offsetWidth","setHeight","offsetHeight","renderAll","deltaX","delta","relativePan","val","getVpCenter","zoomToPoint","absolutePan","keyCode","resetZoom","locPaper","items","getObjects","reverse","forEach","item","clear","setState","target","tco","getCoords","mco","bottom","right","zoomF","getZoom","cropX","scaleX","cropY","scaleY","dirty","optObj","withoutTransform","withoutShadow","cloned","toDataURL","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","length","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","b64toBlob","split","Image","fromURL","img","scaleToHeight","getHeight","scaleToWidth","getWidth","center","fire","shieldHandler","svgString","loadSVGFromString","crossOrigin","objects","options","obj","util","groupSVGElements","selection","on","onMouseWheel","onMouseDown","onMouseUp","onMouseMove","window","addEventListener","onWindowResize","Canvas","tabIndex","initCanvas","prevProps","prevState","zoom","includes","reader","FileReader","callback","onload","f","result","readAsText","readAsDataURL","Component","ValueChooser","active","value","decrementButton","incrementButton","mainContainer","input","leftSeparator","rightSeparator","update","onBlurI","onFocusI","oldInputValue","cl","getAttribute","classNames","inactive","setAttribute","currentValue","cur","parseFloat","min","max","isNaN","disabled","blurAndEnterHandler","clName","dbTitle","dbCallback","alt","src","dbIconSrc","placeholder","prompt","minValue","maxValue","step","onBlur","onFocus","ibTitle","ibCallback","ibIconSrc","pdfjsLib","require","pdfjsWorker","GlobalWorkerOptions","workerSrc","PDFRenderer","totalPageNumber","currentPage","paperSetImage","paperRemoveOldImage","hiddenCanvas","pager","loadPdfFile","saveImageToState","loadPage","loadPdfDocument","renderPage","processError","changePage","setCurrentPage","pdfDocument","name","endsWith","parseInt","imgStr","pageNumber","pdf","getPage","then","page","viewport","getViewport","scale","context","getContext","render","canvasContext","promise","numPages","error","console","log","fileReader","lPDFD","perr","ev","typedarray","getDocument","readAsArrayBuffer","act","dec","cp","tp","pn","style","display","BusyIndicator","Dialog","modal","ok","cancel","dialogWrapper","content","shield","doAccept","doCancel","show","hide","acceptCallback","titleClassName","ZoomContext","createContext","Extractor","pap","hiddenFileInput","pdfRend","zoomer","busyind","modDialog","processFiles","loadImage","doZoom","setShieldActive","showModalDialog","onDialogAccept","doVectorizeExtern","doVectorizeIntern","showSVGResult","zoomFactor","minZoom","maxZoom","files","out","zf","z","toPrecision","click","pngBlob","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","response","responseText","send","svgImgStr","pngImg","ImageTracer","imageToSVG","curzoom","Provider","newZoom","onChange","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.9317fca4.chunk.js","sourcesContent":["import React from 'react';\r\n// import './Button.css';\r\n\r\nvar Button = React.forwardRef((props, ref) => (\r\n  <button\r\n    ref={ref}\r\n    onClick={props.handleClick}\r\n    title={props.title}\r\n    className={props.className}\r\n    >{props.children}\r\n  </button>\r\n))\r\n\r\nexport default Button;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\n// import './Paper.css';\r\n\r\nfunction b64toBlob(b64Data, contentType, sliceSize) {\r\n  contentType = contentType || '';\r\n  sliceSize = sliceSize || 512;\r\n\r\n  var byteCharacters = atob(b64Data);\r\n  var byteArrays = [];\r\n\r\n  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n          byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n\r\n      byteArrays.push(byteArray);\r\n  }\r\n\r\n  var blob = new Blob(byteArrays, {type: contentType});\r\n  return blob;\r\n}\r\n\r\nclass Paper extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      file: null\r\n    }   \r\n    this.updateViewBoxPosition = this.updateViewBoxPosition.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.resetPosition = this.resetPosition.bind(this);\r\n    this.clearCanvas = this.clearCanvas.bind(this);\r\n    this.cropImage = this.cropImage.bind(this);\r\n    this.loadRasterImage = this.loadRasterImage.bind(this);\r\n    this.loadSVGImage = this.loadSVGImage.bind(this);\r\n    this.loadResultSVGImage = this.loadResultSVGImage.bind(this);\r\n    this.loadCropedImage = this.loadCropedImage.bind(this);\r\n    this.cancelMask = this.cancelMask.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.removeOldImage = this.removeOldImage.bind(this);\r\n\r\n    this.wrapper = React.createRef();\r\n    this.paperId = React.createRef();\r\n\r\n    this.crBlob = null;\r\n    this.crImgUrl = null;\r\n    this.paper = null;\r\n    this.mask = null;\r\n    this.startPos = null;\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mdp = null;\r\n    this.pausePanning = false;\r\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/svg+xml'];\r\n    this.imageOptions = {\r\n      hasControls: false,\r\n      hasBorders: false,\r\n      lockMovementX: true,\r\n      lockMovementY: true,\r\n      lockScalingX: true,\r\n      lockScalingY: true,\r\n      lockScewingX: true,\r\n      lockScewingY: true,\r\n      lockRotation: true,\r\n      selectable: false,\r\n      hoverCursor: 'default'\r\n    };\r\n}\r\n\r\n  onMouseWheel(opt) {\r\n    var pt = this.paper.getPointer(opt);\r\n    var point = new fabric.Point(pt.x, pt.y);\r\n    this.props.onMouseWheelZoom(opt.e.deltaY < 0, point);\r\n    opt.e.preventDefault();\r\n    opt.e.stopPropagation();\r\n  }\r\n\r\n  onMouseDown(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n    if (!evt.e.ctrlKey) {\r\n      this.startPos = this.paper.getPointer(evt);\r\n      if (this.mask == null) {\r\n        this.mask = new fabric.Rect({\r\n          fill: \"rgba(255,255,0,0.2)\",\r\n          stroke: 'red',\r\n          strokeDashArray: [8, 8],\r\n          \"stroke-width\": 2,\r\n          opacity: 1.0,\r\n          left: this.startPos.x,\r\n          top: this.startPos.y,\r\n          width: 0,\r\n          height: 0,\r\n          evented: true,\r\n          selectable: true,\r\n          // hasControls: false,\r\n          lockScewingX: true,\r\n          lockScewingY: true,\r\n          lockRotation: true,\r\n          selectionBorderColor: 'red',\r\n          transparentCorners: true,\r\n          cornerColor: 'red',\r\n          cornerStrokeColor: 'red',\r\n          // borderColor: 'red',\r\n          // borderDashArray: [3, 3],\r\n          // padding: 10,\r\n          hasBorder: false,\r\n          id: \"mask\"\r\n        });\r\n        this.paper.add(this.mask);\r\n        this.mask.setControlVisible(\"mtr\", false);\r\n        this.paper.requestRenderAll();\r\n        this.newFlag = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  onMouseUp(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n    }\r\n    else {\r\n      if (this.mask != null) {\r\n        if (this.moveFlag) {\r\n          var endPos = this.paper.getPointer(evt);\r\n          this.mask.set({\r\n            width: Math.abs(endPos.x - this.startPos.x),\r\n            height: Math.abs(endPos.y - this.startPos.y)\r\n          });\r\n          var o = {\r\n            left: this.startPos.x,\r\n            top: this.startPos.y\r\n          };\r\n          if (endPos.x < this.startPos.x) {\r\n            o.left = endPos.x;\r\n          }\r\n          if (endPos.y < this.startPos.y) {\r\n            o.top = endPos.y;\r\n          }\r\n          this.mask.setCoords(o);\r\n          this.paper.setActiveObject(this.mask);\r\n          this.paper.requestRenderAll();\r\n        }\r\n        else if (this.newFlag) {\r\n          this.paper.remove(this.mask);\r\n          this.mask = null;\r\n        }\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  onMouseMove(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n    }\r\n    else {\r\n      if (this.mask != null && this.startPos != null && this.newFlag) {\r\n        var pos = this.paper.getPointer(evt);\r\n        var w = pos.x - this.startPos.x;\r\n        var h = pos.y - this.startPos.y;\r\n        this.mask.set({\r\n          width: w,\r\n          height: h\r\n        });\r\n        this.paper.requestRenderAll();\r\n        this.moveFlag = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  onWindowResize(evt) {\r\n    this.paper.setWidth(this.wrapper.current.offsetWidth);\r\n    this.paper.setHeight(this.wrapper.current.offsetHeight);\r\n    this.paper.renderAll();\r\n  }\r\n\r\n  updateViewBoxPosition(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (this.mdp != null) {\r\n      var deltaX = evt.e.screenX - this.mdp.x;\r\n      var deltaY = evt.e.screenY - this.mdp.y;\r\n      this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n      var delta = new fabric.Point(deltaX, deltaY);\r\n      this.paper.relativePan(delta);\r\n    }\r\n  }\r\n\r\n  setZoom(val, point) {\r\n    var pt = point;\r\n    if (pt == null) {\r\n      pt = this.paper.getVpCenter();\r\n    }\r\n    this.paper.zoomToPoint(pt, val);\r\n  }\r\n\r\n  // reset viewport position to 0,0\r\n  resetPosition() {\r\n    this.paper.absolutePan(new fabric.Point(0, 0));\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    if (e.keyCode === 27) { // ESC\r\n      this.cancelMask(e);\r\n    }\r\n  }\r\n\r\n  cancelMask(e) {\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    if (this.mask != null) {\r\n      this.paper.remove(this.mask);\r\n      this.mask = null;\r\n    }\r\n    this.paper.requestRenderAll();\r\n  }\r\n\r\n  removeOldImage() {\r\n    if (this.props.resetZoom != null) {\r\n      this.props.resetZoom();\r\n    }\r\n    this.resetPosition();\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mask = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          locPaper.remove(item);\r\n        });\r\n      }\r\n      this.paper.clear();\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    this.removeOldImage();\r\n    // this.crBlob = null\r\n    // this.crImgUrl = null;\r\n    this.setState({file: null});\r\n  }\r\n\r\n  cropImage() {\r\n    if (this.paper != null) {\r\n      var items = this.paper.getObjects();\r\n      if (items != null && this.mask != null) {\r\n        var target = items[0];\r\n        var mask = this.mask;\r\n        var tco = target.getCoords();\r\n        var mco = mask.getCoords();\r\n        var left = tco[0].x;\r\n        if (mco[0].x > left) {\r\n          left = mco[0].x;\r\n        }\r\n        var top = tco[0].y;\r\n        if (mco[0].y > top) {\r\n          top = mco[0].y;\r\n        }\r\n        var bottom = tco[2].y;\r\n        if (mco[2].y < bottom) {\r\n          bottom = mco[2].y;\r\n        }\r\n        var right = tco[1].x;\r\n        if (mco[1].x < right) {\r\n          right = mco[1].x;\r\n        }\r\n        var zoomF = this.paper.getZoom();\r\n        var cropX = (left - tco[0].x) / (target.scaleX * zoomF);\r\n        var cropY = (top - tco[0].y) / (target.scaleY * zoomF);\r\n        var width = (right - left) / (target.scaleX * zoomF);\r\n        var height = (bottom - top) / (target.scaleY * zoomF);\r\n        target.dirty=true;\r\n        this.paper.remove(mask);\r\n\r\n        this.paper.renderAll();\r\n\r\n        var optObj = {\r\n          left:cropX, \r\n          top:cropY, \r\n          width:width, \r\n          height:height, \r\n          withoutTransform: true, \r\n          withoutShadow: true\r\n        };\r\n        var cloned = target.toDataURL(optObj);\r\n        var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n        this.crBlob = crBlob;\r\n        this.crImgUrl = cloned;\r\n        fabric.Image.fromURL(cloned, this.loadCropedImage);\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCropedImage(img) {\r\n    this.clearCanvas();        \r\n    img.set(this.imageOptions);\r\n    img.set({id:\"croped\"});\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(this.paper.getHeight());\r\n    }\r\n    else {\r\n      img.scaleToWidth(this.paper.getWidth());\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.requestRenderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }  \r\n \r\n  loadResultSVGImage(svgString) {\r\n    this.clearCanvas();        \r\n    fabric.loadSVGFromString(svgString, this.loadSVGImage, null, {crossOrigin: 'anonymous'});  \r\n  }\r\n\r\n  loadSVGImage(objects, options) {\r\n    var obj = fabric.util.groupSVGElements(objects, options);\r\n    obj.set(this.imageOptions);\r\n    this.paper.add(obj);\r\n    obj.center().setCoords();\r\n\r\n    this.paper.renderAll()\r\n    this.paper.fire('object:modified')\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n  \r\n  loadRasterImage(img) {\r\n    img.set(this.imageOptions);\r\n    img.set({id:\"target\"});\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(this.paper.getHeight());\r\n    }\r\n    else {\r\n      img.scaleToWidth(this.paper.getWidth());\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.renderAll();\r\n    this.paper.fire('object:modified');\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n\r\n  initCanvas() {\r\n    this.paper.selection = false;\r\n    if (this.props.onMouseWheelZoom != null) {\r\n      this.paper.on('mouse:wheel', this.onMouseWheel.bind(this));\r\n    }\r\n    this.paper.on('mouse:down', this.onMouseDown.bind(this));\r\n    this.paper.on('mouse:up', this.onMouseUp.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    window.addEventListener(\"resize\", this.onWindowResize.bind(this)); \r\n  }\r\n\r\n  componentDidMount() {\r\n    this.paper = new fabric.Canvas(this.paperId.current.id, {\r\n      height: this.wrapper.current.offsetHeight,\r\n      width: this.wrapper.current.offsetWidth\r\n    });\r\n    this.wrapper.current.tabIndex = 1;\r\n    this.wrapper.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (this.props.zoom !== this.paper.getZoom()) {\r\n      this.setZoom(this.props.zoom, this.props.point);\r\n    }\r\n    if (this.state.file === null) {\r\n        return;\r\n    }\r\n    var file = this.state.file;\r\n    this.clearCanvas();\r\n    // check type\r\n    if (this.allowedTypes.includes(file.type)) {\r\n      var reader = new FileReader();\r\n      var callback = null;\r\n\r\n      // handle svg\r\n      if (file.type === 'image/svg+xml') {\r\n        callback = this.loadSVGImage;\r\n        reader.onload = function(f) {\r\n          fabric.loadSVGFromString(f.target.result, callback, null, {crossOrigin: 'anonymous'});\r\n        }\r\n        reader.readAsText(file);\r\n        return;\r\n      }\r\n\r\n      // handle image, read file, add to canvas\r\n      callback = this.loadRasterImage;\r\n      reader.onload = function(f) {\r\n        fabric.Image.fromURL(f.target.result, callback);\r\n      }\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <div className=\"main\">\r\n      <div className=\"canvasWrapper\" ref={this.wrapper}>\r\n        <canvas id=\"canvasElementId\" className=\"paper\" ref={this.paperId}></canvas>\r\n      </div>\r\n    </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Paper;","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\n// import './ValueChooser.css';\r\n\r\nclass ValueChooser extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            active: false,\r\n            value: null\r\n        }\r\n        this.decrementButton = React.createRef();\r\n        this.incrementButton = React.createRef();\r\n        this.mainContainer = React.createRef();\r\n        this.input = React.createRef();\r\n        this.leftSeparator = React.createRef();\r\n        this.rightSeparator = React.createRef();\r\n\r\n        this.update = this.update.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onBlurI = this.onBlurI.bind(this);\r\n        this.onFocusI = this.onFocusI.bind(this);\r\n\r\n        this.oldInputValue = null; \r\n    }\r\n\r\n    update(prevState, prevProps) {\r\n        var cl;\r\n        if (prevState == null || this.state.active !== prevState.active) {\r\n            cl = this.mainContainer.current.getAttribute(\"class\");\r\n            if (this.state.active) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.mainContainer.current.setAttribute(\"class\", cl);\r\n        }\r\n        if (!this.state.active) {\r\n            return;\r\n        }\r\n        if (prevProps == null || this.props.leftSeparator !== prevProps.leftSeparator) {\r\n            cl = this.leftSeparator.current.getAttribute(\"class\");\r\n            if (this.props.leftSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.leftSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null || this.props.rightSeparator !== prevProps.rightSeparator) {\r\n            cl = this.rightSeparator.current.getAttribute(\"class\");\r\n            if (this.props.rightSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.rightSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null) {\r\n            if (prevState == null) {\r\n                this.input.current.value = this.state.value;\r\n            }\r\n        }\r\n        else if (prevProps == null || this.props.currentValue !== this.input.current.value) {\r\n            this.input.current.value = this.props.currentValue;\r\n        }\r\n\r\n        if (this.input.current != null) {\r\n            var cur = parseFloat(this.input.current.value);\r\n            var min = parseFloat(this.input.current.min);\r\n            var max = parseFloat(this.input.current.max);\r\n            if (this.decrementButton.current != null) {\r\n                if (!isNaN(cur) && cur > min) {\r\n                    this.decrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.decrementButton.current.disabled = true;\r\n                }\r\n            }\r\n            if (this.incrementButton.current != null) {\r\n                if (!isNaN(cur) && cur < max) {\r\n                    this.incrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.incrementButton.current.disabled = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        if (this.props.blurAndEnterHandler != null && e.keyCode === 13  && this.oldInputValue !== this.input.current.value) { // ENTER\r\n            this.props.blurAndEnterHandler(parseFloat(this.input.current.value));\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n\r\n    onBlurI(e) {\r\n        if (this.props.blurAndEnterHandler != null && this.oldInputValue !== this.input.current.value) {\r\n            this.props.blurAndEnterHandler(this.input.current.value);\r\n            this.oldInputValue = null;\r\n        }\r\n    }\r\n\r\n    onFocusI(e) {\r\n        if (this.props.blurAndEnterHandler != null) {\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n       \r\n    componentDidUpdate(prevProps, prevState) {\r\n        this.update(prevState, prevProps);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        this.input.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n        this.update();\r\n    }\r\n  \r\n    render() {\r\n        var clName = \"inactive blockdiv\";\r\n        if (this.props.className != null) {\r\n            clName += \" \" + this.props.className;\r\n        }\r\n        return (\r\n            <div className={clName} ref={this.mainContainer}>\r\n                <div ref={this.leftSeparator} className=\"separator inactive\"></div>\r\n                <Button ref={this.decrementButton} title={this.props.dbTitle} handleClick={ this.props.dbCallback }>\r\n                    <img alt={this.props.dbTitle} src={this.props.dbIconSrc}></img>\r\n                </Button>\r\n                <input \r\n                    className=\"value_input\" \r\n                    ref={this.input} \r\n                    type=\"text\"\r\n                    placeholder={this.props.prompt} \r\n                    min={this.props.minValue}\r\n                    max={this.props.maxValue} \r\n                    step={this.props.step} \r\n                    onBlur={this.onBlurI} \r\n                    onFocus={this.onFocusI}\r\n                    >\r\n                </input>\r\n                <Button ref={this.incrementButton} title={this.props.ibTitle} handleClick={ this.props.ibCallback }>\r\n                    <img alt={this.props.ibTitle}src={this.props.ibIconSrc}></img>\r\n                </Button>\r\n                <div ref={this.rightSeparator} className=\"separator inactive\"></div>\r\n                {this.props.children}\r\n            </div>\r\n        )\r\n  }\r\n}\r\n\r\nexport default ValueChooser;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\nimport ValueChooser from './ValueChooser';\r\n// import './PDFRenderer.css';\r\n\r\nvar pdfjsLib = require(\"pdfjs-dist/build/pdf.js\");\r\nvar pdfjsWorker = require('pdfjs-dist/build/pdf.worker.entry');\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n// const PageContext = React.createContext(1);\r\n\r\nclass PDFRenderer extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n        totalPageNumber: 0,\r\n        currentPage: 0,\r\n        paperSetImage: null,\r\n        paperRemoveOldImage: null,\r\n        file: null\r\n    }\r\n    this.hiddenCanvas = React.createRef();\r\n    this.pager = React.createRef();\r\n\r\n    this.update = this.update.bind(this);\r\n    this.loadPdfFile = this.loadPdfFile.bind(this);\r\n    this.saveImageToState = this.saveImageToState.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.loadPdfDocument = this.loadPdfDocument.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.renderPage = this.renderPage.bind(this);\r\n    this.processError = this.processError.bind(this);\r\n    this.changePage = this.changePage.bind(this);\r\n    this.setCurrentPage = this.setCurrentPage.bind(this);\r\n\r\n    this.pdfDocument = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.pdfDocument = null;\r\n    this.setState({currentPage: 0, totalPageNumber: 0});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!this.update(prevState)) {\r\n      return;\r\n    }\r\n    if (this.state.file === null || !this.state.file.name.endsWith(\".pdf\")) {\r\n        return;\r\n    }\r\n    if (prevState != null) {\r\n      if (prevState.file !== this.state.file) {\r\n        this.loadPdfFile(this.state.file);\r\n        return;\r\n      }\r\n      if (this.state.totalPageNumber >= 1 && this.state.currentPage <= this.state.totalPageNumber && this.pdfDocument != null && this.state.currentPage !== prevState.currentPage) {\r\n        this.loadPage(parseInt(this.state.currentPage), this.pdfDocument);\r\n      }\r\n    }\r\n  }\r\n\r\n  saveImageToState() {\r\n    var imgStr = this.hiddenCanvas.current.toDataURL(\"image/png\");\r\n    if (imgStr != null && this.state.paperSetImage != null) {\r\n      fabric.Image.fromURL(imgStr, this.state.paperSetImage);\r\n    }\r\n  }\r\n\r\n  loadPage(pageNumber, pdf) {\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    if (this.state.paperRemoveOldImage != null) {\r\n      this.state.paperRemoveOldImage();\r\n    }\r\n    pdf.getPage(pageNumber).then(this.renderPage);\r\n  }\r\n\r\n  renderPage(page) {\r\n    var viewport = page.getViewport({\r\n        scale: 8.0\r\n    });\r\n    // Prepare canvas using PDF page dimensions\r\n    var context = this.hiddenCanvas.current.getContext('2d');\r\n    this.hiddenCanvas.current.height = viewport.height;\r\n    this.hiddenCanvas.current.width = viewport.width;\r\n    // Render PDF page into canvas context\r\n    var task = page.render({canvasContext: context, viewport: viewport});\r\n    task.promise.then(this.saveImageToState);\r\n  }\r\n\r\n  loadPdfDocument(pdf) {\r\n    this.pdfDocument = pdf;\r\n    // Fetch the first page\r\n    this.setState({totalPageNumber: pdf.numPages, currentPage: 1});\r\n  }\r\n\r\n  processError(error) {\r\n    console.log(error);\r\n  }\r\n\r\n  loadPdfFile(file) {\r\n    var fileReader = new FileReader();\r\n    var lPDFD = this.loadPdfDocument;\r\n    var perr = this.processError;\r\n    this.pdfDocument = null;    \r\n    this.setState({currentPage: 0, totalPageNumber: 0});    \r\n    fileReader.onload = function(ev) {\r\n      var typedarray = new Uint8Array(ev.target.result);\r\n      pdfjsLib.getDocument(typedarray).promise.then(lPDFD, perr);\r\n    };\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    fileReader.readAsArrayBuffer(file);\r\n  }\r\n\r\n  update(prevState) {\r\n    var act = (this.state.file != null && this.state.file.name.endsWith(\".pdf\"));\r\n    if (this.pager.current.state.active !== act) {\r\n      this.pager.current.setState({active: act});\r\n    }\r\n    return act;\r\n  }\r\n\r\n  changePage(dec) {\r\n    if (this.state.totalPageNumber > 0) {\r\n      var cp = parseInt(this.state.currentPage);\r\n      if (!isNaN(cp)) {\r\n        dec ? cp-- : cp++;\r\n        this.setCurrentPage(cp);\r\n      }\r\n    }\r\n  }\r\n\r\n  setCurrentPage(cp) {\r\n    if (cp < 1) {\r\n      cp = 1;\r\n    }\r\n    if (cp > this.state.totalPageNumber) {\r\n      cp = this.state.totalPageNumber;\r\n    }\r\n    this.setState({currentPage: cp});\r\n  }  \r\n\r\n  render() {\r\n    var tp = this.state.totalPageNumber;\r\n    var cp = this.state.currentPage;\r\n    return (\r\n        <ValueChooser \r\n            ref={this.pager}\r\n            dbIconSrc={\"assets/chevron-back-circle-outline.svg\"} \r\n            ibIconSrc={\"assets/chevron-forward-circle-outline.svg\"}\r\n            dbTitle={\"Previous page\"}\r\n            ibTitle={\"Next page\"}\r\n            dbCallback={ () => this.changePage(true) }\r\n            ibCallback={ () => this.changePage(false) }\r\n            prompt={\"Page Nr\"}\r\n            minValue={1}\r\n            maxValue={tp}\r\n            step={1}\r\n            leftSeparator={true}\r\n            className=\"pager\"\r\n            blurAndEnterHandler={ pn => {this.setCurrentPage(pn);} }\r\n            currentValue={cp}\r\n        >\r\n          <canvas id=\"hiddenCanvasForPdfId\" ref={this.hiddenCanvas} style={{display: 'none'}}></canvas>\r\n        </ValueChooser>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PDFRenderer;","import React from 'react';\r\n// import './BusyIndicator.css';\r\n\r\nvar BusyIndicator = React.forwardRef((props, ref) => (\r\n  <div className=\"shield inactive\" ref={ref}>\r\n    <div className=\"viewer-busyind\"></div>\r\n    {props.children}\r\n  </div>\r\n))\r\n\r\nexport default BusyIndicator;\r\n","import React from 'react';\r\nimport Button from './Button';\r\nimport classNames from 'classnames/dedupe';\r\n// import './Dialog.css';\r\n\r\nclass Dialog extends React.Component {\r\n \r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      modal: true,\r\n      active: false\r\n  }\r\n\r\n    this.ok = React.createRef();\r\n    this.cancel = React.createRef();\r\n    this.dialogWrapper = React.createRef();\r\n    this.content = React.createRef();\r\n    this.shield = React.createRef();\r\n\r\n    this.doAccept = this.doAccept.bind(this);\r\n    this.doCancel = this.doCancel.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n\r\n  show() {\r\n    var cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:true, inactive: false});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n    if (this.state.modal) {\r\n      cl = this.shield.current.getAttribute(\"class\");\r\n      cl = classNames(cl, {active:true, inactive: false});\r\n      this.shield.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  hide() {\r\n    var cl = this.shield.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.shield.current.setAttribute(\"class\", cl);\r\n    cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n  }\r\n\r\n  doAccept() {\r\n    if (this.props.acceptCallback != null) {\r\n      this.props.acceptCallback();\r\n    }\r\n    this.setState({active: false});\r\n  }\r\n\r\n  doCancel() {\r\n    this.setState({active: false});\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState == null || this.state.active !== prevState.active) {\r\n      if (this.state.active) {\r\n        this.show();\r\n      }\r\n      else {\r\n        this.hide();\r\n      }\r\n    }\r\n    // if (!this.state.active) {\r\n    //   return;\r\n    // }\r\n  }\r\n\r\n  render() {\r\n    var title = this.props.title;\r\n    var titleClassName = \"dlgtitle\" + (title == null ? \" inactive\" : \" active\");\r\n    return (\r\n      <div className=\"inactive dialogwrapper\" ref={this.dialogWrapper}>\r\n        <div className=\"shield inactive\" ref={this.shield}></div>\r\n        <div className=\"dlg\">\r\n          <div className={titleClassName}>\r\n            {title}\r\n          </div>\r\n          <div className=\"dlgcontent\" ref={this.content}>\r\n            {this.props.children}\r\n          </div>\r\n\r\n          <div className=\"toolbar\">\r\n            <Button name=\"ok\" title={\"Accept\"} ref={this.ok} className={\"active\"} handleClick={ () => this.doAccept() }>\r\n              Ok\r\n            </Button>\r\n\r\n            <div className=\"filler\"></div>\r\n\r\n            <Button name=\"cancel\" title={\"Cancel\"} ref={this.cancel} className={\"active\"} handleClick={ () => this.doCancel() }>\r\n              Cancel\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Dialog;\r\n","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\nimport Paper from './Paper';\r\nimport PDFRenderer from './PDFRenderer';\r\nimport ValueChooser from './ValueChooser';\r\nimport BusyIndicator from './BusyIndicator';\r\nimport Dialog from './Dialog';\r\n// import ImageTracer from './imagetracer_v1.2.6';\r\n// import './Extractor.css';\r\n\r\nvar ZoomContext = React.createContext(1.0);\r\n\r\nclass Extractor extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.pap = React.createRef();\r\n    this.hiddenFileInput = React.createRef();\r\n    this.pdfRend = React.createRef();\r\n    this.zoomer = React.createRef();\r\n    this.busyind = React.createRef();\r\n    this.modDialog = React.createRef();\r\n\r\n    this.processFiles = this.processFiles.bind(this);\r\n    this.loadImage = this.loadImage.bind(this);\r\n    this.doZoom = this.doZoom.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.setShieldActive = this.setShieldActive.bind(this);\r\n    this.showModalDialog = this.showModalDialog.bind(this);\r\n    this.onDialogAccept = this.onDialogAccept.bind(this);\r\n    this.doVectorizeExtern = this.doVectorizeExtern.bind(this);\r\n    this.doVectorizeIntern = this.doVectorizeIntern.bind(this);\r\n    this.showSVGResult = this.showSVGResult.bind(this);\r\n\r\n    this.state = {\r\n      zoom: '1.0',\r\n      point: null\r\n    }\r\n\r\n    this.zoomFactor = 0.05;\r\n    this.minZoom = 0.05;\r\n    this.maxZoom = 5.0;\r\n  }\r\n\r\n  setShieldActive(act) {\r\n    if (this.busyind.current != null) {\r\n      var cl = this.busyind.current.getAttribute(\"class\");\r\n      if (act) {\r\n          cl = classNames(cl, {active:true, inactive: false});\r\n      }\r\n      else {\r\n          cl = classNames(cl, {active:false, inactive: true});\r\n      }\r\n      this.busyind.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  showModalDialog() {\r\n    if (this.modDialog.current != null) {\r\n      this.modDialog.current.setState({active: true});\r\n    }\r\n  }\r\n\r\n  processFiles(e) {\r\n    if (e.target.files != null && e.target.files.length === 1) {\r\n      if (this.pap.current.allowedTypes.includes(e.target.files.item(0).type) || e.target.files.item(0).name.endsWith(\".pdf\")) {\r\n        // show shield\r\n        this.setShieldActive(true);\r\n        this.pap.current.crBlob = null\r\n        this.pap.current.crImgUrl = null;\r\n          this.pdfRend.current.setState({\r\n          paperSetImage: this.pap.current.loadRasterImage, \r\n          file: e.target.files.item(0)\r\n        });\r\n        this.pap.current.setState({file: e.target.files.item(0)});\r\n      }\r\n      e.target.value = null;\r\n    }\r\n  }\r\n\r\n  doZoom(out, point) {\r\n    var zf = out ? this.zoomFactor : -this.zoomFactor;\r\n    var zoom = parseFloat(this.state.zoom) + zf;\r\n    this.setZoom(zoom, point);\r\n  }\r\n\r\n  setZoom(zoom, point) {\r\n    var z = parseFloat(zoom);\r\n    if (z > this.maxZoom) {\r\n      z = this.maxZoom;\r\n    }\r\n    if (z < this.minZoom) {\r\n      z = this.minZoom;\r\n    }\r\n    this.setState({zoom:parseFloat(z).toPrecision(3), point:point});\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.pdfRend.current.setState({paperSetImage: this.pap.current.loadRasterImage, paperRemoveOldImage: this.pap.current.removeOldImage});\r\n    this.zoomer.current.setState({active: true});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  loadImage(e) {\r\n    e.preventDefault();\r\n    this.hiddenFileInput.current.click();\r\n  }\r\n  \r\n  onDialogAccept() {\r\n    console.log(\"Dialog content accepted\");\r\n  }\r\n\r\n  doVectorizeExtern(pngBlob) {\r\n    if (pngBlob == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    // var proxyurl = \"https://cors-anywhere.herokuapp.com/\";\r\n    var proxyurl = \"\";\r\n    var url = 'https://api.vectorizer.io/v3/vectorize?apikey=69936907-18666295&colors=8&minarea=5&threshold=20&input=clipart&output=svg&svgversion=1.1';\r\n    // var url = 'https://api.vectorizer.io/v3/vectorize?apikey=69936907-18666295';\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"POST\", (proxyurl+url), true); // method, url, async\r\n    xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n    xhr.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\r\n\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState === 4) {      // completed\r\n          if (xhr.status === 200) {    // OK\r\n              var response = xhr.responseText;\r\n              console.log(response.type);\r\n          }\r\n          else {\r\n            console.log(\"Vectorize error: \"+xhr.status);\r\n          }\r\n      }\r\n    }    \r\n    xhr.send(pngBlob);\r\n  }\r\n\r\n  showSVGResult(svgImgStr) {\r\n    this.pap.current.loadResultSVGImage(svgImgStr);\r\n  }\r\n\r\n  doVectorizeIntern(pngImg) {\r\n    if (pngImg == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    if (window.ImageTracer != null) {\r\n      window.ImageTracer.imageToSVG(pngImg, this.showSVGResult);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var curzoom = this.state.zoom;\r\n    var point = this.state.point;\r\n    return (\r\n        <div className=\"main\">\r\n          <ZoomContext.Provider value={curzoom}>\r\n            <div className=\"toolbar shadow\">\r\n\r\n              <Button name=\"load\" title={\"Load file\"} className={\"active\"} handleClick={ (e) => this.loadImage(e) }>\r\n                <img alt={\"Load file\"} src=\"assets/image-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"clear\" title={\"Clear canvas\"} className={\"active\"} handleClick={ () => {\r\n                this.pap.current.clearCanvas();\r\n                this.pdfRend.current.setState({\r\n                  file: null\r\n                });\r\n                      } }>\r\n                <img alt={\"Clear canvas\"} src=\"assets/close-circle-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"crop\" title={\"Crop image\"} className={\"active\"} handleClick={ () => {this.pap.current.cropImage(); this.setShieldActive(true);} }>\r\n                <img alt={\"Crop\"} src=\"assets/crop-outline.svg\"></img>\r\n              </Button>\r\n              {/* <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeIntern(this.pap.current.crImgUrl) }> */}\r\n              <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeExtern(this.pap.current.crBlob) }>\r\n                <img alt={\"Vectorize\"} src=\"assets/vector.svg\"></img>\r\n              </Button>\r\n              <Button name=\"save\" title={\"Save\"} className={\"active\"} handleClick={ () => this.showModalDialog() }>\r\n                <img alt={\"Save\"} src=\"assets/save-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <PDFRenderer ref={this.pdfRend} shieldHandler={this.setShieldActive}/>\r\n\r\n              <div className=\"filler\"></div>\r\n\r\n              <Button name=\"reset_position\" title={\"Reset position\"} className={\"active\"} handleClick={ () => this.pap.current.resetPosition() }>\r\n                <img alt={\"Reset position\"} src=\"assets/locate.svg\"></img>\r\n              </Button>\r\n              <Button name=\"reset_zoom\" title={\"Reset zoom\"} className={\"active\"} handleClick={ () => this.setState({zoom:1.0}) }>\r\n                <img alt={\"Reset zoom\"} src=\"assets/zoom-to-actual-size.svg\"></img>\r\n              </Button>\r\n\r\n              <ValueChooser \r\n                ref={this.zoomer}\r\n                dbIconSrc={\"assets/zoom-in.svg\"} \r\n                ibIconSrc={\"assets/zoom-out.svg\"}\r\n                dbTitle={\"Zoom in\"}\r\n                ibTitle={\"Zoom out\"}\r\n                dbCallback={ () => this.doZoom(true) }\r\n                ibCallback={ () => this.doZoom(false) }\r\n                prompt={\"Zoom\"}\r\n                minValue={0.05}\r\n                maxValue={5.0}\r\n                step={0.05}\r\n                className=\"zoomer\"\r\n                blurAndEnterHandler={ newZoom => { this.setZoom(newZoom)} }\r\n                currentValue={curzoom}\r\n            >\r\n            </ValueChooser>\r\n\r\n            </div>\r\n\r\n            <div className=\"sand shadow\">\r\n              <Paper \r\n                ref={this.pap} \r\n                zoom={curzoom}\r\n                point={point}\r\n                onMouseWheelZoom={this.doZoom}\r\n                resetZoom={() => this.setState({zoom:1.0})}\r\n                shieldHandler={this.setShieldActive}\r\n              /> \r\n            </div>\r\n          </ZoomContext.Provider>\r\n\r\n          <input ref={this.hiddenFileInput} type=\"file\" style={{display: 'none'}} onChange={this.processFiles}/>\r\n\r\n          <BusyIndicator ref={this.busyind}/>\r\n\r\n          <Dialog ref={this.modDialog} acceptCallback={this.onDialogAccept} title={\"Save dialog\"}>\r\n            <div className={\"dlgrow\"}>\r\n              <label>Measurement</label>\r\n              <input type=\"text\" placeholder={\"30 ft\"}></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>File name</label>\r\n              <input type=\"text\"></input>\r\n            </div>\r\n          </Dialog>\r\n\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Extractor;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Extractor from './components/Extractor';\nimport './App.css';\n\nReactDOM.render(<Extractor />, document.getElementById('root'))\n"],"sourceRoot":""}