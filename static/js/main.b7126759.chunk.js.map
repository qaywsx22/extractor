{"version":3,"sources":["components/Button.js","components/Paper.js","components/ValueChooser.js","components/PDFRenderer.js","components/BusyIndicator.js","components/Dialog.js","components/Extractor.js","index.js"],"names":["Button","React","forwardRef","props","ref","onClick","handleClick","title","className","disabled","children","b64toBlob","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","length","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","type","polygonPositionHandler","dim","finalMatrix","fabricObject","x","points","this","pointIndex","pathOffset","y","fabric","util","transformPoint","multiplyTransformMatrices","canvas","viewportTransform","calcTransformMatrix","actionHandler","eventData","transform","polygon","target","currentControl","controls","__corner","mouseLocalPosition","toLocalPoint","Point","polygonBaseSize","_getNonTransformedDimensions","size","_getTransformedDimensions","finalPointPosition","resizePolygon","peer","activeObject","paper","getActiveObject","setActiveObject","mask","edit","objectCaching","Object","prototype","cornerStyle","cornerColor","transparentCorners","borderColor","hasBorders","requestRenderAll","Paper","state","file","updateViewBoxPosition","bind","setZoom","resetPosition","clearCanvas","cropImage","loadRasterImage","loadSVGImage","loadResultSVGImage","loadCropedImage","cancelMask","onKeyDown","removeOldImage","toggleSelectionMode","polyModeMouseDown","rectModeMouseDown","isCropEnabled","removeProcessedImages","doCropExtern","wrapper","createRef","paperId","pathSelection","activeLine","lineArray","pointArray","crBlob","crImgUrl","startPos","moveFlag","newFlag","mdp","pausePanning","allowedTypes","imageOptions","hasControls","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockScewingX","lockScewingY","lockRotation","selectable","hoverCursor","locPaper","items","getObjects","reverse","forEach","item","id","remove","opt","pt","getPointer","point","onMouseWheelZoom","e","deltaY","preventDefault","stopPropagation","evt","ctrlKey","obj","findTarget","lastControl","reduce","acc","index","anchorIndex","fn","Control","positionHandler","absolutePoint","actionPerformed","_setPositionDimensions","newX","newY","setPositionByOrigin","actionName","editPolygon","deselected","selected","startsWith","screenX","screenY","polyModeMouseUp","endPos","set","width","Math","abs","height","o","left","top","setCoords","polyModeMouseMove","rectModeMouseMove","setWidth","current","offsetWidth","setHeight","offsetHeight","renderAll","deltaX","delta","relativePan","val","getVpCenter","zoomToPoint","absolutePan","keyCode","resetZoom","clear","setState","cropButtonStateHandler","discardActiveObject","zoomF","getZoom","tco","getCoords","right","bottom","cropX","cropY","mco","scaleX","scaleY","dirty","clipPath","mc","getCenterPoint","tc","originX","originY","optObj","withoutTransform","withoutShadow","cloned","toDataURL","split","useExternalCropping","vectButtonStateHandler","Image","fromURL","pngBlob","apiKey","apiSecret","apiURL","url","xhr","XMLHttpRequest","open","setRequestHeader","btoa","responseType","fd","FormData","append","pap","onreadystatechange","readyState","status","dataURL","response","data","byte","String","fromCharCode","console","log","send","shieldHandler","img","scaleToHeight","getHeight","scaleToWidth","getWidth","add","center","fire","svgString","loadSVGFromString","crossOrigin","objects","options","groupSVGElements","w","h","line","Polygon","moveable","fill","stroke","strokeDashArray","strokeWidth","opacity","setControlVisible","toggleDrawPolygon","generatePolygon","curpos","pointOption","Date","getTime","radius","linePoints","Circle","Line","evented","class","get","polyPoint","addPoint","pointer","x2","y2","rectMaskOptions","selectionBorderColor","cornerStrokeColor","hasBorder","Rect","pos","found","selection","on","onMouseWheel","onMouseDown","onMouseUp","onMouseMove","onMouseDblclick","onSelectionCleared","onSelectionCreated","window","addEventListener","onWindowResize","Canvas","tabIndex","initCanvas","prevProps","prevState","zoom","includes","reader","FileReader","callback","onload","f","result","readAsText","readAsDataURL","Component","ValueChooser","active","value","decrementButton","incrementButton","mainContainer","input","leftSeparator","rightSeparator","update","onBlurI","onFocusI","oldInputValue","cl","getAttribute","classNames","inactive","setAttribute","currentValue","cur","parseFloat","min","max","isNaN","blurAndEnterHandler","clName","dbTitle","dbCallback","alt","src","dbIconSrc","placeholder","prompt","minValue","maxValue","step","onBlur","onFocus","ibTitle","ibCallback","ibIconSrc","pdfjsLib","require","pdfjsWorker","GlobalWorkerOptions","workerSrc","PDFRenderer","totalPageNumber","currentPage","paperSetImage","paperRemoveOldImage","hiddenCanvas","pager","loadPdfFile","saveImageToState","loadPage","loadPdfDocument","renderPage","processError","changePage","setCurrentPage","pdfDocument","name","endsWith","parseInt","imgStr","pageNumber","pdf","getPage","then","page","viewport","getViewport","scale","context","getContext","render","canvasContext","promise","numPages","error","fileReader","lPDFD","perr","ev","typedarray","getDocument","readAsArrayBuffer","act","dec","cp","tp","pn","style","display","BusyIndicator","Dialog","modal","ok","cancel","dialogWrapper","content","shield","doAccept","doCancel","show","hide","acceptCallback","titleClassName","ZoomContext","createContext","cm_apiURL","process","cm_apiKey","cm_apiSecret","Extractor","hiddenFileInput","pdfRend","zoomer","busyind","modDialog","measurment","exportFileName","saveButton","cropButton","vectButton","settingsButton","eaConfDialog","eaUrl","eaKey","eaSecret","processFiles","loadImage","doZoom","setShieldActive","showModalDialog","onDialogAccept","doVectorizeIntern","showSVGResult","updateSaveButton","updateCropButton","updateVectButton","showExternalApiConfigurationDialog","onExternalAPIConfigAccept","polySelection","saveEnabled","cropEnabled","vectEnabled","zoomFactor","minZoom","maxZoom","files","out","zf","z","toPrecision","click","meas","key","i1","indexOf","i2","substring","fileName","blob","a","document","createElement","download","href","URL","createObjectURL","body","appendChild","removeChild","svgImgStr","pngImg","ImageTracer","imageToSVG","curzoom","selIcon","useExternalCroppingAllowed","Provider","newZoom","onChange","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.b7126759.chunk.js","sourcesContent":["import React from 'react';\r\n// import './Button.css';\r\n\r\nvar Button = React.forwardRef((props, ref) => (\r\n  <button\r\n    ref={ref}\r\n    onClick={props.handleClick}\r\n    title={props.title}\r\n    className={props.className}\r\n    disabled={props.disabled === true}\r\n    >{props.children}\r\n  </button>\r\n))\r\n\r\nexport default Button;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\n// import './Paper.css';\r\n\r\nfunction b64toBlob(b64Data, contentType, sliceSize) {\r\n  contentType = contentType || '';\r\n  sliceSize = sliceSize || 512;\r\n\r\n  var byteCharacters = atob(b64Data);\r\n  var byteArrays = [];\r\n\r\n  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n          byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n\r\n      byteArrays.push(byteArray);\r\n  }\r\n\r\n  var blob = new Blob(byteArrays, {type: contentType});\r\n  return blob;\r\n}\r\n\r\nfunction addPoint(evt, peer) {\r\n  var curpos = peer.paper.getPointer(evt);\r\n  var pointOption = {\r\n    id: new Date().getTime(),\r\n    radius: 5,\r\n    fill: '#ffffff',\r\n    stroke: '#333333',\r\n    strokeWidth: 0.5,\r\n    left: curpos.x,\r\n    top: curpos.y,\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    originX: 'center',\r\n    originY: 'center',\r\n    objectCaching: false,\r\n  };\r\n  var linePoints = [\r\n    curpos.x,\r\n    curpos.y,\r\n    curpos.x,\r\n    curpos.y\r\n  ];\r\n  var lineOption = {\r\n    strokeWidth: 2,\r\n    fill: '#999999',\r\n    stroke: '#999999',\r\n    originX: 'center',\r\n    originY: 'center',\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    evented: false,\r\n    objectCaching: false,\r\n  };\r\n\r\n  var point = new fabric.Circle(pointOption);\r\n\r\n  if (peer.pointArray.length === 0) {\r\n    peer.newFlag = true;\r\n    // fill first point with red color\r\n    point.set({\r\n      fill: 'red'\r\n    });\r\n  }\r\n\r\n  var line = new fabric.Line(linePoints, lineOption);\r\n  line.class = 'line';\r\n  \r\n  var polygon = null;\r\n\r\n  if (peer.mask != null) {\r\n    var points = peer.mask.get('points');\r\n    points.push({\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    });\r\n    polygon = new fabric.Polygon(points, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false\r\n    });\r\n    peer.paper.remove(peer.mask);\r\n    peer.paper.add(polygon);\r\n    peer.mask = polygon;\r\n    peer.paper.renderAll();\r\n  } \r\n  else {\r\n    var polyPoint = [{\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    }, ];\r\n    polygon = new fabric.Polygon(polyPoint, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false,\r\n    });\r\n    peer.mask = polygon;\r\n    peer.paper.add(polygon);\r\n  }\r\n\r\n  peer.activeLine = line;\r\n  peer.pointArray.push(point);\r\n  peer.lineArray.push(line);\r\n\r\n  peer.paper.add(line);\r\n  peer.paper.add(point);\r\n}\r\n\r\nfunction generatePolygon(peer) {\r\n  var points = [];\r\n  for (var point of peer.pointArray) {\r\n    points.push({\r\n      x: point.left,\r\n      y: point.top,\r\n    });\r\n    peer.paper.remove(point);\r\n  }\r\n\r\n  for (var line of peer.lineArray) {\r\n    peer.paper.remove(line);\r\n  }\r\n\r\n  peer.paper.remove(peer.mask).remove(peer.activeLine);\r\n\r\n  var polygon = new fabric.Polygon(points, {\r\n    id: \"mask\",\r\n    objectCaching: false,\r\n    moveable: false,\r\n    selectable: true,\r\n    fill: \"rgba(255,255,0,0.2)\",\r\n    stroke: 'red',\r\n    strokeDashArray: [8, 8],\r\n    strokeWidth: 1,\r\n    opacity: 1.0\r\n});\r\n  peer.paper.add(polygon);\r\n  peer.mask = polygon;\r\n  peer.mask.setControlVisible(\"mtr\", false);\r\n\r\n  toggleDrawPolygon(peer);\r\n  resizePolygon(peer);\r\n}\r\n\r\nfunction toggleDrawPolygon(peer) {\r\n  if (peer.newFlag) {\r\n    // stop draw mode\r\n    peer.activeLine = null;\r\n    peer.lineArray = [];\r\n    peer.pointArray = [];\r\n    peer.newFlag = false;\r\n  } else {\r\n    // start draw mode\r\n    peer.newFlag = true;\r\n  }\r\n}\r\n\r\nfunction editPolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = true;\r\n  activeObject.objectCaching = false;\r\n\r\n  var lastControl = activeObject.points.length - 1;\r\n  activeObject.cornerStyle = 'circle';\r\n  activeObject.controls = activeObject.points.reduce((acc, point, index) => {\r\n    acc['p' + index] = new fabric.Control({\r\n      positionHandler: polygonPositionHandler,\r\n      actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),\r\n      actionName: 'modifyPolygon',\r\n      pointIndex: index,\r\n    });\r\n    return acc;\r\n  }, {});\r\n\r\n  activeObject.hasBorders = false;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\nfunction polygonPositionHandler(dim, finalMatrix, fabricObject) {\r\n  var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),\r\n      y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);\r\n  \r\n  return fabric.util.transformPoint(\r\n    { x: x, y: y },\r\n    fabric.util.multiplyTransformMatrices(\r\n      fabricObject.canvas.viewportTransform,\r\n      fabricObject.calcTransformMatrix()\r\n    )\r\n  );\r\n}\r\n\r\nfunction actionHandler(eventData, transform, x, y) {\r\n  var polygon = transform.target,\r\n      currentControl = polygon.controls[polygon.__corner],\r\n      mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),\r\n      polygonBaseSize = polygon._getNonTransformedDimensions(),\r\n      size = polygon._getTransformedDimensions(0, 0),\r\n      finalPointPosition = {\r\n        x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,\r\n        y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y\r\n      };\r\n  polygon.points[currentControl.pointIndex] = finalPointPosition;\r\n  return true;\r\n}\r\n\r\nfunction anchorWrapper(anchorIndex, fn) {\r\n  return function(eventData, transform, x, y) {\r\n    var fabricObject = transform.target,\r\n        absolutePoint = fabric.util.transformPoint({\r\n            x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),\r\n            y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),\r\n        }, fabricObject.calcTransformMatrix()),\r\n        actionPerformed = fn(eventData, transform, x, y);\r\n\r\n    fabricObject._setPositionDimensions({});\r\n\r\n    var polygonBaseSize = fabricObject._getNonTransformedDimensions(),\r\n        newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,\r\n        newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;\r\n    fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);\r\n    return actionPerformed;\r\n  }\r\n}\r\n\r\nfunction resizePolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = false;\r\n  activeObject.objectCaching = false;\r\n  activeObject.controls = fabric.Object.prototype.controls;\r\n  activeObject.cornerStyle = 'rect';\r\n  activeObject.cornerColor = 'red';\r\n  activeObject.transparentCorners = true;\r\n  activeObject.borderColor = 'red';\r\n  activeObject.hasBorders = true;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\n\r\nclass Paper extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      file: null\r\n    }   \r\n    this.updateViewBoxPosition = this.updateViewBoxPosition.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.resetPosition = this.resetPosition.bind(this);\r\n    this.clearCanvas = this.clearCanvas.bind(this);\r\n    this.cropImage = this.cropImage.bind(this);\r\n    this.loadRasterImage = this.loadRasterImage.bind(this);\r\n    this.loadSVGImage = this.loadSVGImage.bind(this);\r\n    this.loadResultSVGImage = this.loadResultSVGImage.bind(this);\r\n    this.loadCropedImage = this.loadCropedImage.bind(this);\r\n    this.cancelMask = this.cancelMask.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.removeOldImage = this.removeOldImage.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n    this.polyModeMouseDown = this.polyModeMouseDown.bind(this);\r\n    this.rectModeMouseDown = this.rectModeMouseDown.bind(this);\r\n    this.isCropEnabled = this.isCropEnabled.bind(this);\r\n    this.removeProcessedImages = this.removeProcessedImages.bind(this);\r\n    this.doCropExtern = this.doCropExtern.bind(this);\r\n\r\n    this.wrapper = React.createRef();\r\n    this.paperId = React.createRef();\r\n\r\n    this.pathSelection = false;\r\n    this.activeLine = null;\r\n    this.lineArray = [];\r\n    this.pointArray = [];\r\n    this.crBlob = null;\r\n    this.crImgUrl = null;\r\n    this.paper = null;\r\n    this.mask = null;\r\n    this.startPos = null;\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mdp = null;\r\n    this.pausePanning = false;\r\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/svg+xml'];\r\n    this.imageOptions = {\r\n      hasControls: false,\r\n      hasBorders: false,\r\n      lockMovementX: true,\r\n      lockMovementY: true,\r\n      lockScalingX: true,\r\n      lockScalingY: true,\r\n      lockScewingX: true,\r\n      lockScewingY: true,\r\n      lockRotation: true,\r\n      selectable: false,\r\n      hoverCursor: 'default'\r\n    };\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    if (this.pathSelection) {\r\n      this.pathSelection = false;\r\n    }\r\n    else {\r\n      this.pathSelection = true;\r\n    }\r\n    this.cancelMask();\r\n    if (!this.pathSelection && this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          if (\"target\" !== item.id && \"croped\" !== item.id && \"result\" !== item.id) {\r\n            locPaper.remove(item);\r\n          }\r\n        });\r\n      }\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }  \r\n\r\n  onMouseWheel(opt) {\r\n    var pt = this.paper.getPointer(opt);\r\n    var point = new fabric.Point(pt.x, pt.y);\r\n    this.props.onMouseWheelZoom(opt.e.deltaY < 0, point);\r\n    opt.e.preventDefault();\r\n    opt.e.stopPropagation();\r\n  }\r\n\r\n  onMouseDblclick(evt) {\r\n    if (evt.e.ctrlKey || !this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      var obj = this.paper.findTarget(evt);\r\n      if (obj != null && obj === this.mask) {\r\n        editPolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCleared(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.deselected && evt.deselected.length > 0) {\r\n        evt.deselected.forEach((item) => {\r\n          if (item.id === \"mask\" && item.type === 'polygon') {\r\n            item.edit = false;\r\n            item.controls = fabric.Object.prototype.controls;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCreated(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.selected && evt.selected.length ===1 && evt.selected[0].id === \"mask\") {\r\n        resizePolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onMouseDown(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n    if (evt.e.ctrlKey) {\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseDown(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseDown(evt);\r\n    }\r\n  }\r\n\r\n  onMouseUp(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n    }\r\n    else {\r\n      if (this.pathSelection) {\r\n        this.polyModeMouseUp(evt, this);\r\n      }\r\n      else if (this.mask != null) {\r\n        if (this.moveFlag) {\r\n          var endPos = this.paper.getPointer(evt);\r\n          this.mask.set({\r\n            width: Math.abs(endPos.x - this.startPos.x),\r\n            height: Math.abs(endPos.y - this.startPos.y)\r\n          });\r\n          var o = {\r\n            left: this.startPos.x,\r\n            top: this.startPos.y\r\n          };\r\n          if (endPos.x < this.startPos.x) {\r\n            o.left = endPos.x;\r\n          }\r\n          if (endPos.y < this.startPos.y) {\r\n            o.top = endPos.y;\r\n          }\r\n          this.mask.setCoords(o);\r\n          this.paper.setActiveObject(this.mask);\r\n          this.paper.requestRenderAll();\r\n        }\r\n        else if (this.newFlag) {\r\n          this.paper.remove(this.mask);\r\n          this.mask = null;\r\n        }\r\n        this.newFlag = false;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  onMouseMove(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseMove(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseMove(evt);\r\n    }\r\n  }\r\n\r\n  onWindowResize(evt) {\r\n    this.paper.setWidth(this.wrapper.current.offsetWidth);\r\n    this.paper.setHeight(this.wrapper.current.offsetHeight);\r\n    this.paper.renderAll();\r\n  }\r\n\r\n  updateViewBoxPosition(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (this.mdp != null) {\r\n      var deltaX = evt.e.screenX - this.mdp.x;\r\n      var deltaY = evt.e.screenY - this.mdp.y;\r\n      this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n      var delta = new fabric.Point(deltaX, deltaY);\r\n      this.paper.relativePan(delta);\r\n    }\r\n  }\r\n\r\n  setZoom(val, point) {\r\n    var pt = point;\r\n    if (pt == null) {\r\n      pt = this.paper.getVpCenter();\r\n    }\r\n    this.paper.zoomToPoint(pt, val);\r\n  }\r\n\r\n  // reset viewport position to 0,0\r\n  resetPosition() {\r\n    this.paper.absolutePan(new fabric.Point(0, 0));\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    if (e.keyCode === 27) { // ESC\r\n      this.cancelMask(e);\r\n      if (this.pathSelection && this.paper != null) {\r\n        var locPaper = this.paper;\r\n        var items = this.paper.getObjects();\r\n        if (items != null) {\r\n          items = items.reverse();\r\n          items.forEach(function(item){\r\n            if (\"target\" !== item.id && \"croped\" !== item.id && \"result\" !== item.id) {\r\n              locPaper.remove(item);\r\n            }\r\n          });\r\n        }\r\n        this.paper.requestRenderAll();\r\n      }\r\n      }\r\n  }\r\n\r\n  cancelMask(e) {\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    if (this.mask != null) {\r\n      this.paper.remove(this.mask);\r\n      this.mask = null;\r\n    }\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    this.paper.requestRenderAll();\r\n  }\r\n\r\n  removeOldImage() {\r\n    if (this.props.resetZoom != null) {\r\n      this.props.resetZoom();\r\n    }\r\n    this.resetPosition();\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mask = null;\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          locPaper.remove(item);\r\n        });\r\n      }\r\n      this.paper.clear();\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  removeProcessedImages() {\r\n    this.crBlob = null\r\n    this.crImgUrl = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          if (item.id !== \"target\") {\r\n            locPaper.remove(item);\r\n          }\r\n        });\r\n      }\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    this.removeOldImage();\r\n    this.setState({file: null});\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n  }\r\n  \r\n  cropImage() {\r\n    if (this.paper != null) {\r\n      this.paper.discardActiveObject();\r\n      this.setZoom(1.0);\r\n      this.resetPosition();\r\n      var target = null;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items.forEach((item) => {\r\n          if (item != null && (item.id === \"target\" || item.id === \"croped\")) {\r\n            target = item;\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n      if (target != null) {\r\n        var zoomF = this.paper.getZoom();\r\n        var tco = target.getCoords();\r\n        var left = tco[0].x;\r\n        var right = tco[1].x;\r\n        var top = tco[0].y;\r\n        var bottom = tco[2].y;\r\n        var cropX = 0;\r\n        var cropY = 0;\r\n        var width = target.width;\r\n        var height = target.height;\r\n        var mask = this.mask;\r\n        if (mask != null) {\r\n          var mco = mask.getCoords();\r\n          if (mco[0].x > left) {\r\n            left = mco[0].x;\r\n          }\r\n          if (mco[0].y > top) {\r\n            top = mco[0].y;\r\n          }\r\n          if (mco[2].y < bottom) {\r\n            bottom = mco[2].y;\r\n          }\r\n          if (mco[1].x < right) {\r\n            right = mco[1].x;\r\n          }\r\n          cropX = (left - tco[0].x) / (target.scaleX * zoomF);\r\n          cropY = (top - tco[0].y) / (target.scaleY * zoomF);\r\n          width = (right - left) / (target.scaleX * zoomF);\r\n          height = (bottom - top) / (target.scaleY * zoomF);\r\n          target.dirty = true;\r\n          target.clipPath = mask;\r\n          var mc = mask.getCenterPoint();\r\n          var tc = target.getCenterPoint();\r\n          this.paper.remove(mask);\r\n          mask.originX = 'center';\r\n          mask.originY = 'center';\r\n          mask.left = -(tc.x - mc.x) / (target.scaleX);\r\n          mask.top = -(tc.y - mc.y) / (target.scaleY);\r\n          mask.scaleX = 1.0 * zoomF / (target.scaleX);\r\n          mask.scaleY = 1.0 * zoomF / (target.scaleY);\r\n          mask.setCoords();\r\n          mask.dirty = true;\r\n\r\n          this.paper.renderAll();\r\n        }\r\n        var optObj = {\r\n          left:cropX, \r\n          top:cropY, \r\n          width:width, \r\n          height:height, \r\n          withoutTransform: true, \r\n          withoutShadow: true\r\n        };\r\n        var cloned = target.toDataURL(optObj);\r\n        var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n        if (this.props.useExternalCropping) {\r\n          // this.crBlob = crBlob;\r\n          this.doCropExtern(crBlob);\r\n        }\r\n        else {\r\n          this.crImgUrl = cloned;\r\n          if (this.props.vectButtonStateHandler != null) {\r\n            this.props.vectButtonStateHandler();\r\n          }\r\n          fabric.Image.fromURL(cloned, this.loadCropedImage);\r\n        }\r\n      }\r\n      if (this.props.resetZoom != null) {\r\n        this.props.resetZoom();\r\n      }\r\n    }\r\n  }\r\n\r\n  doCropExtern(pngBlob) {\r\n    if (pngBlob == null || this.props.apiKey == null || this.props.apiSecret == null || this.props.apiURL == null) {\r\n      // hide shield\r\n      if (this.props.shieldHandler != null) {\r\n        this.props.shieldHandler(false);\r\n      }\r\n      return;\r\n    }\r\n    var proxyurl = \"\";\r\n    var url = this.props.apiURL;\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"POST\", (proxyurl+url), true); // method, url, async\r\n    // xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa('8151:amntk91kircq1mmnddbitg5imbavpqflp1f8moes8hego8ctrfju'));\r\n    xhr.setRequestHeader(\"Authorization\", \"Basic \" + btoa(this.props.apiKey + ':' + this.props.apiSecret));\r\n    xhr.responseType = 'arraybuffer';\r\n    var fd = new FormData();\r\n    fd.append('image', pngBlob);\r\n    fd.append('format', 'result');\r\n    fd.append('test', 'true');\r\n    var pap = this;\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState === 4) {      // completed\r\n        if (xhr.status === 200) {    // OK\r\n          var b64 = btoa(new Uint8Array(xhr.response).reduce(\r\n            function (data, byte) {\r\n                return data + String.fromCharCode(byte);\r\n            },'')\r\n          );\r\n          var dataURL=\"data:image/png;base64,\"+b64;\r\n          pap.removeProcessedImages();\r\n          pap.crImgUrl = dataURL;\r\n          if (pap.props.vectButtonStateHandler != null) {\r\n            pap.props.vectButtonStateHandler();\r\n          }\r\n          fabric.Image.fromURL(dataURL, pap.loadCropedImage);\r\n        }\r\n        else {\r\n          console.log(\"Autocrop error: \"+xhr.status);\r\n        }\r\n      }\r\n    }    \r\n    xhr.send(fd);\r\n  }\r\n\r\n  loadCropedImage(img) {\r\n    this.clearCanvas();        \r\n    img.set(this.imageOptions);\r\n    img.set({id:\"croped\"});\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(this.paper.getHeight());\r\n    }\r\n    else {\r\n      img.scaleToWidth(this.paper.getWidth());\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.requestRenderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }  \r\n \r\n  loadResultSVGImage(svgString) {\r\n    this.clearCanvas();        \r\n    fabric.loadSVGFromString(svgString, this.loadSVGImage, null, {crossOrigin: 'anonymous', id: 'result'});  \r\n  }\r\n\r\n  loadSVGImage(objects, options) {\r\n    var obj = fabric.util.groupSVGElements(objects, options);\r\n    obj.set(this.imageOptions);\r\n    // obj.needsItsOwnCache = () => {return true};\r\n    this.paper.add(obj);\r\n    obj.center().setCoords();\r\n    obj.set({id: options.id}); \r\n    this.paper.renderAll()\r\n    this.paper.fire('object:modified')\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n  \r\n  loadRasterImage(img) {\r\n    img.set(this.imageOptions);\r\n    img.set({id:\"target\"});\r\n    var w = this.paper.getWidth();\r\n    var h = this.paper.getHeight();\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(h);\r\n    }\r\n    else if (img.width === img.height) {\r\n      if (w > h) {\r\n        img.scaleToWidth(h);\r\n      }\r\n      else {\r\n        img.scaleToWidth(w);\r\n      }\r\n    }\r\n    else {\r\n      img.scaleToWidth(w);\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.renderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    var optObj = {\r\n      left:0, \r\n      top:0, \r\n      width:img.width, \r\n      height:img.height, \r\n      withoutTransform: true, \r\n      withoutShadow: true\r\n    };\r\n    var cloned = img.toDataURL(optObj);\r\n    var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n    this.crBlob = crBlob;\r\n    this.crImgUrl = cloned;\r\n\r\n    if (this.props.vectButtonStateHandler != null) {\r\n      this.props.vectButtonStateHandler();\r\n    }\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n\r\n  polyModeMouseDown(o, peer) {\r\n    if (!peer.newFlag && peer.mask != null) {\r\n      return;\r\n    }\r\n    if (peer.mask != null && o.target && o.target.id === this.pointArray[0].id) {\r\n      // when click on the first point\r\n      generatePolygon(peer);\r\n    } else {\r\n      addPoint(o, peer);\r\n    }\r\n  }\r\n  \r\n  polyModeMouseMove(o, peer) {\r\n    if (peer.newFlag) {\r\n      if (peer.activeLine && peer.activeLine.class === 'line') {\r\n        var pointer = peer.paper.getPointer(o);\r\n        peer.activeLine.set({\r\n          x2: pointer.x,\r\n          y2: pointer.y\r\n        });\r\n        var points = peer.mask.get('points');\r\n        points[peer.pointArray.length] = {\r\n          x: pointer.x,\r\n          y: pointer.y,\r\n        };\r\n        peer.mask.set({\r\n          points\r\n        });\r\n      }\r\n      peer.paper.renderAll();\r\n    }\r\n  }\r\n\r\n  polyModeMouseUp(o, peer) {\r\n  }\r\n\r\n  rectModeMouseDown(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    this.startPos = this.paper.getPointer(evt);\r\n    if (this.mask == null) {\r\n      var rectMaskOptions = {\r\n        fill: \"rgba(255,255,0,0.2)\",\r\n        stroke: 'red',\r\n        strokeDashArray: [8, 8],\r\n        \"stroke-width\": 2,\r\n        opacity: 1.0,\r\n        left: this.startPos.x,\r\n        top: this.startPos.y,\r\n        width: 0,\r\n        height: 0,\r\n        evented: true,\r\n        selectable: true,\r\n        lockScewingX: true,\r\n        lockScewingY: true,\r\n        lockRotation: true,\r\n        selectionBorderColor: 'red',\r\n        transparentCorners: true,\r\n        cornerColor: 'red',\r\n        cornerStrokeColor: 'red',\r\n        hasBorder: false,\r\n        id: \"mask\"\r\n      };\r\n      this.newFlag = true;\r\n      this.mask = new fabric.Rect(rectMaskOptions);\r\n      this.paper.add(this.mask);\r\n      this.mask.setControlVisible(\"mtr\", false);\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  rectModeMouseMove(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null && this.startPos != null && this.newFlag) {\r\n      var pos = this.paper.getPointer(evt);\r\n      var w = pos.x - this.startPos.x;\r\n      var h = pos.y - this.startPos.y;\r\n      this.mask.set({\r\n        width: w,\r\n        height: h\r\n      });\r\n      this.paper.requestRenderAll();\r\n      this.moveFlag = true;\r\n    }\r\n  }\r\n\r\n  rectModeMouseUp(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null) {\r\n      if (this.moveFlag) {\r\n        var endPos = this.paper.getPointer(evt);\r\n        this.mask.set({\r\n          width: Math.abs(endPos.x - this.startPos.x),\r\n          height: Math.abs(endPos.y - this.startPos.y)\r\n        });\r\n        var o = {\r\n          left: this.startPos.x,\r\n          top: this.startPos.y\r\n        };\r\n        if (endPos.x < this.startPos.x) {\r\n          o.left = endPos.x;\r\n        }\r\n        if (endPos.y < this.startPos.y) {\r\n          o.top = endPos.y;\r\n        }\r\n        this.mask.setCoords(o);\r\n        this.paper.setActiveObject(this.mask);\r\n        this.paper.requestRenderAll();\r\n      }\r\n      else if (this.newFlag) {\r\n        this.paper.remove(this.mask);\r\n        this.mask = null;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  isCropEnabled() {\r\n    if (this.paper != null) {\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        var found = null;\r\n        items.forEach((item) => {\r\n          if (item != null && (item.id === \"target\" || item.id === \"croped\")) {\r\n            found = item;\r\n            return false;\r\n          }\r\n        });\r\n        return (found != null);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  initCanvas() {\r\n    this.paper.selection = false;\r\n    if (this.props.onMouseWheelZoom != null) {\r\n      this.paper.on('mouse:wheel', this.onMouseWheel.bind(this));\r\n    }\r\n    this.paper.on('mouse:down', this.onMouseDown.bind(this));\r\n    this.paper.on('mouse:up', this.onMouseUp.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:dblclick', this.onMouseDblclick.bind(this));\r\n    this.paper.on('selection:cleared', this.onSelectionCleared.bind(this));\r\n    this.paper.on('selection:created', this.onSelectionCreated.bind(this));\r\n    \r\n    window.addEventListener(\"resize\", this.onWindowResize.bind(this)); \r\n  }\r\n\r\n  componentDidMount() {\r\n    this.paper = new fabric.Canvas(this.paperId.current.id, {\r\n      height: this.wrapper.current.offsetHeight,\r\n      width: this.wrapper.current.offsetWidth\r\n    });\r\n    this.wrapper.current.tabIndex = 1;\r\n    this.wrapper.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (this.props.zoom !== this.paper.getZoom()) {\r\n      this.setZoom(this.props.zoom, this.props.point);\r\n    }\r\n    if (this.state.file === null) {\r\n        return;\r\n    }\r\n    var file = this.state.file;\r\n    this.clearCanvas();\r\n    // check type\r\n    if (this.allowedTypes.includes(file.type)) {\r\n      var reader = new FileReader();\r\n      var callback = null;\r\n\r\n      // handle svg\r\n      if (file.type === 'image/svg+xml') {\r\n        callback = this.loadSVGImage;\r\n        reader.onload = function(f) {\r\n          fabric.loadSVGFromString(f.target.result, callback, null, {crossOrigin: 'anonymous', id: 'target'});\r\n        }\r\n        reader.readAsText(file);\r\n        return;\r\n      }\r\n\r\n      // handle image, read file, add to canvas\r\n      callback = this.loadRasterImage;\r\n      reader.onload = function(f) {\r\n        fabric.Image.fromURL(f.target.result, callback);\r\n      }\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <div className=\"main\">\r\n      <div className=\"canvasWrapper\" ref={this.wrapper}>\r\n        <canvas id=\"canvasElementId\" className=\"paper\" ref={this.paperId}></canvas>\r\n      </div>\r\n    </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Paper;","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\n// import './ValueChooser.css';\r\n\r\nclass ValueChooser extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            active: false,\r\n            value: null\r\n        }\r\n        this.decrementButton = React.createRef();\r\n        this.incrementButton = React.createRef();\r\n        this.mainContainer = React.createRef();\r\n        this.input = React.createRef();\r\n        this.leftSeparator = React.createRef();\r\n        this.rightSeparator = React.createRef();\r\n\r\n        this.update = this.update.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onBlurI = this.onBlurI.bind(this);\r\n        this.onFocusI = this.onFocusI.bind(this);\r\n\r\n        this.oldInputValue = null; \r\n    }\r\n\r\n    update(prevState, prevProps) {\r\n        var cl;\r\n        if (prevState == null || this.state.active !== prevState.active) {\r\n            cl = this.mainContainer.current.getAttribute(\"class\");\r\n            if (this.state.active) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.mainContainer.current.setAttribute(\"class\", cl);\r\n        }\r\n        if (!this.state.active) {\r\n            return;\r\n        }\r\n        if (prevProps == null || this.props.leftSeparator !== prevProps.leftSeparator) {\r\n            cl = this.leftSeparator.current.getAttribute(\"class\");\r\n            if (this.props.leftSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.leftSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null || this.props.rightSeparator !== prevProps.rightSeparator) {\r\n            cl = this.rightSeparator.current.getAttribute(\"class\");\r\n            if (this.props.rightSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.rightSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null) {\r\n            if (prevState == null) {\r\n                this.input.current.value = this.state.value;\r\n            }\r\n        }\r\n        else if (prevProps == null || this.props.currentValue !== this.input.current.value) {\r\n            this.input.current.value = this.props.currentValue;\r\n        }\r\n\r\n        if (this.input.current != null) {\r\n            var cur = parseFloat(this.input.current.value);\r\n            var min = parseFloat(this.input.current.min);\r\n            var max = parseFloat(this.input.current.max);\r\n            if (this.decrementButton.current != null) {\r\n                if (!isNaN(cur) && cur > min) {\r\n                    this.decrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.decrementButton.current.disabled = true;\r\n                }\r\n            }\r\n            if (this.incrementButton.current != null) {\r\n                if (!isNaN(cur) && cur < max) {\r\n                    this.incrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.incrementButton.current.disabled = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        if (this.props.blurAndEnterHandler != null && e.keyCode === 13  && this.oldInputValue !== this.input.current.value) { // ENTER\r\n            this.props.blurAndEnterHandler(parseFloat(this.input.current.value));\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n\r\n    onBlurI(e) {\r\n        if (this.props.blurAndEnterHandler != null && this.oldInputValue !== this.input.current.value) {\r\n            this.props.blurAndEnterHandler(this.input.current.value);\r\n            this.oldInputValue = null;\r\n        }\r\n    }\r\n\r\n    onFocusI(e) {\r\n        if (this.props.blurAndEnterHandler != null) {\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n       \r\n    componentDidUpdate(prevProps, prevState) {\r\n        this.update(prevState, prevProps);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        this.input.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n        this.update();\r\n    }\r\n  \r\n    render() {\r\n        var clName = \"inactive blockdiv\";\r\n        if (this.props.className != null) {\r\n            clName += \" \" + this.props.className;\r\n        }\r\n        return (\r\n            <div className={clName} ref={this.mainContainer}>\r\n                <div ref={this.leftSeparator} className=\"separator inactive\"></div>\r\n                <Button ref={this.decrementButton} title={this.props.dbTitle} handleClick={ this.props.dbCallback }>\r\n                    <img alt={this.props.dbTitle} src={this.props.dbIconSrc}></img>\r\n                </Button>\r\n                <input \r\n                    className=\"value_input\" \r\n                    ref={this.input} \r\n                    type=\"text\"\r\n                    placeholder={this.props.prompt} \r\n                    min={this.props.minValue}\r\n                    max={this.props.maxValue} \r\n                    step={this.props.step} \r\n                    onBlur={this.onBlurI} \r\n                    onFocus={this.onFocusI}\r\n                    >\r\n                </input>\r\n                <Button ref={this.incrementButton} title={this.props.ibTitle} handleClick={ this.props.ibCallback }>\r\n                    <img alt={this.props.ibTitle}src={this.props.ibIconSrc}></img>\r\n                </Button>\r\n                <div ref={this.rightSeparator} className=\"separator inactive\"></div>\r\n                {this.props.children}\r\n            </div>\r\n        )\r\n  }\r\n}\r\n\r\nexport default ValueChooser;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\nimport ValueChooser from './ValueChooser';\r\n// import './PDFRenderer.css';\r\n\r\nvar pdfjsLib = require(\"pdfjs-dist/build/pdf.js\");\r\nvar pdfjsWorker = require('pdfjs-dist/build/pdf.worker.entry');\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n// const PageContext = React.createContext(1);\r\n\r\nclass PDFRenderer extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n        totalPageNumber: 0,\r\n        currentPage: 0,\r\n        paperSetImage: null,\r\n        paperRemoveOldImage: null,\r\n        file: null\r\n    }\r\n    this.hiddenCanvas = React.createRef();\r\n    this.pager = React.createRef();\r\n\r\n    this.update = this.update.bind(this);\r\n    this.loadPdfFile = this.loadPdfFile.bind(this);\r\n    this.saveImageToState = this.saveImageToState.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.loadPdfDocument = this.loadPdfDocument.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.renderPage = this.renderPage.bind(this);\r\n    this.processError = this.processError.bind(this);\r\n    this.changePage = this.changePage.bind(this);\r\n    this.setCurrentPage = this.setCurrentPage.bind(this);\r\n\r\n    this.pdfDocument = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.pdfDocument = null;\r\n    this.setState({currentPage: 0, totalPageNumber: 0});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!this.update(prevState)) {\r\n      return;\r\n    }\r\n    if (this.state.file === null || !this.state.file.name.endsWith(\".pdf\")) {\r\n        return;\r\n    }\r\n    if (prevState != null) {\r\n      if (prevState.file !== this.state.file) {\r\n        this.loadPdfFile(this.state.file);\r\n        return;\r\n      }\r\n      if (this.state.totalPageNumber >= 1 && this.state.currentPage <= this.state.totalPageNumber && this.pdfDocument != null && this.state.currentPage !== prevState.currentPage) {\r\n        this.loadPage(parseInt(this.state.currentPage), this.pdfDocument);\r\n      }\r\n    }\r\n  }\r\n\r\n  saveImageToState() {\r\n    var imgStr = this.hiddenCanvas.current.toDataURL(\"image/png\");\r\n    if (imgStr != null && this.state.paperSetImage != null) {\r\n      fabric.Image.fromURL(imgStr, this.state.paperSetImage);\r\n    }\r\n  }\r\n\r\n  loadPage(pageNumber, pdf) {\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    if (this.state.paperRemoveOldImage != null) {\r\n      this.state.paperRemoveOldImage();\r\n    }\r\n    pdf.getPage(pageNumber).then(this.renderPage);\r\n  }\r\n\r\n  renderPage(page) {\r\n    var viewport = page.getViewport({\r\n        scale: 8.0\r\n    });\r\n    // Prepare canvas using PDF page dimensions\r\n    var context = this.hiddenCanvas.current.getContext('2d');\r\n    this.hiddenCanvas.current.height = viewport.height;\r\n    this.hiddenCanvas.current.width = viewport.width;\r\n    // Render PDF page into canvas context\r\n    var task = page.render({canvasContext: context, viewport: viewport});\r\n    task.promise.then(this.saveImageToState);\r\n  }\r\n\r\n  loadPdfDocument(pdf) {\r\n    this.pdfDocument = pdf;\r\n    // Fetch the first page\r\n    this.setState({totalPageNumber: pdf.numPages, currentPage: 1});\r\n  }\r\n\r\n  processError(error) {\r\n    console.log(error);\r\n  }\r\n\r\n  loadPdfFile(file) {\r\n    var fileReader = new FileReader();\r\n    var lPDFD = this.loadPdfDocument;\r\n    var perr = this.processError;\r\n    this.pdfDocument = null;    \r\n    this.setState({currentPage: 0, totalPageNumber: 0});    \r\n    fileReader.onload = function(ev) {\r\n      var typedarray = new Uint8Array(ev.target.result);\r\n      pdfjsLib.getDocument(typedarray).promise.then(lPDFD, perr);\r\n    };\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    fileReader.readAsArrayBuffer(file);\r\n  }\r\n\r\n  update(prevState) {\r\n    var act = (this.state.file != null && this.state.file.name.endsWith(\".pdf\"));\r\n    if (this.pager.current.state.active !== act) {\r\n      this.pager.current.setState({active: act});\r\n    }\r\n    return act;\r\n  }\r\n\r\n  changePage(dec) {\r\n    if (this.state.totalPageNumber > 0) {\r\n      var cp = parseInt(this.state.currentPage);\r\n      if (!isNaN(cp)) {\r\n        dec ? cp-- : cp++;\r\n        this.setCurrentPage(cp);\r\n      }\r\n    }\r\n  }\r\n\r\n  setCurrentPage(cp) {\r\n    if (cp < 1) {\r\n      cp = 1;\r\n    }\r\n    if (cp > this.state.totalPageNumber) {\r\n      cp = this.state.totalPageNumber;\r\n    }\r\n    this.setState({currentPage: cp});\r\n  }  \r\n\r\n  render() {\r\n    var tp = this.state.totalPageNumber;\r\n    var cp = this.state.currentPage;\r\n    return (\r\n        <ValueChooser \r\n            ref={this.pager}\r\n            dbIconSrc={\"assets/chevron-back-circle-outline.svg\"} \r\n            ibIconSrc={\"assets/chevron-forward-circle-outline.svg\"}\r\n            dbTitle={\"Previous page\"}\r\n            ibTitle={\"Next page\"}\r\n            dbCallback={ () => this.changePage(true) }\r\n            ibCallback={ () => this.changePage(false) }\r\n            prompt={\"Page Nr\"}\r\n            minValue={1}\r\n            maxValue={tp}\r\n            step={1}\r\n            leftSeparator={true}\r\n            className=\"pager\"\r\n            blurAndEnterHandler={ pn => {this.setCurrentPage(pn);} }\r\n            currentValue={cp}\r\n        >\r\n          <canvas id=\"hiddenCanvasForPdfId\" ref={this.hiddenCanvas} style={{display: 'none'}}></canvas>\r\n        </ValueChooser>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PDFRenderer;","import React from 'react';\r\n// import './BusyIndicator.css';\r\n\r\nvar BusyIndicator = React.forwardRef((props, ref) => (\r\n  <div className=\"shield inactive\" ref={ref}>\r\n    <div className=\"viewer-busyind\"></div>\r\n    {props.children}\r\n  </div>\r\n))\r\n\r\nexport default BusyIndicator;\r\n","import React from 'react';\r\nimport Button from './Button';\r\nimport classNames from 'classnames/dedupe';\r\n// import './Dialog.css';\r\n\r\nclass Dialog extends React.Component {\r\n \r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      modal: true,\r\n      active: false\r\n  }\r\n\r\n    this.ok = React.createRef();\r\n    this.cancel = React.createRef();\r\n    this.dialogWrapper = React.createRef();\r\n    this.content = React.createRef();\r\n    this.shield = React.createRef();\r\n\r\n    this.doAccept = this.doAccept.bind(this);\r\n    this.doCancel = this.doCancel.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n\r\n  show() {\r\n    var cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:true, inactive: false});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n    if (this.state.modal) {\r\n      cl = this.shield.current.getAttribute(\"class\");\r\n      cl = classNames(cl, {active:true, inactive: false});\r\n      this.shield.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  hide() {\r\n    var cl = this.shield.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.shield.current.setAttribute(\"class\", cl);\r\n    cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n  }\r\n\r\n  doAccept() {\r\n    if (this.props.acceptCallback != null) {\r\n      this.props.acceptCallback();\r\n    }\r\n    this.setState({active: false});\r\n  }\r\n\r\n  doCancel() {\r\n    this.setState({active: false});\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState == null || this.state.active !== prevState.active) {\r\n      if (this.state.active) {\r\n        this.show();\r\n      }\r\n      else {\r\n        this.hide();\r\n      }\r\n    }\r\n    // if (!this.state.active) {\r\n    //   return;\r\n    // }\r\n  }\r\n\r\n  render() {\r\n    var title = this.props.title;\r\n    var titleClassName = \"dlgtitle\" + (title == null ? \" inactive\" : \" active\");\r\n    return (\r\n      <div className=\"inactive dialogwrapper\" ref={this.dialogWrapper}>\r\n        <div className=\"shield inactive\" ref={this.shield}></div>\r\n        <div className=\"dlg\">\r\n          <div className={titleClassName}>\r\n            {title}\r\n          </div>\r\n          <div className=\"dlgcontent\" ref={this.content}>\r\n            {this.props.children}\r\n          </div>\r\n\r\n          <div className=\"toolbar\">\r\n            <Button name=\"ok\" title={\"Accept\"} ref={this.ok} className={\"active\"} handleClick={ () => this.doAccept() }>\r\n              Ok\r\n            </Button>\r\n\r\n            <div className=\"filler\"></div>\r\n\r\n            <Button name=\"cancel\" title={\"Cancel\"} ref={this.cancel} className={\"active\"} handleClick={ () => this.doCancel() }>\r\n              Cancel\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Dialog;\r\n","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\nimport Paper from './Paper';\r\nimport PDFRenderer from './PDFRenderer';\r\nimport ValueChooser from './ValueChooser';\r\nimport BusyIndicator from './BusyIndicator';\r\nimport Dialog from './Dialog';\r\n// import './Extractor.css';\r\n\r\nvar ZoomContext = React.createContext(1.0);\r\nvar cm_apiURL = process.env.REACT_APP_APIUrl;\r\nvar cm_apiKey = process.env.REACT_APP_APIKey;\r\nvar cm_apiSecret = process.env.REACT_APP_APISecret;\r\n\r\nclass Extractor extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.pap = React.createRef();\r\n    this.hiddenFileInput = React.createRef();\r\n    this.pdfRend = React.createRef();\r\n    this.zoomer = React.createRef();\r\n    this.busyind = React.createRef();\r\n    this.modDialog = React.createRef();\r\n    this.measurment = React.createRef();\r\n    this.exportFileName = React.createRef();\r\n    this.saveButton = React.createRef();\r\n    this.cropButton = React.createRef();\r\n    this.vectButton = React.createRef();\r\n    this.settingsButton = React.createRef();\r\n    this.eaConfDialog = React.createRef();\r\n    this.eaUrl = React.createRef();\r\n    this.eaKey = React.createRef();\r\n    this.eaSecret = React.createRef();\r\n\r\n\r\n    this.processFiles = this.processFiles.bind(this);\r\n    this.loadImage = this.loadImage.bind(this);\r\n    this.doZoom = this.doZoom.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.setShieldActive = this.setShieldActive.bind(this);\r\n    this.showModalDialog = this.showModalDialog.bind(this);\r\n    this.onDialogAccept = this.onDialogAccept.bind(this);\r\n    // this.doVectorizeExtern = this.doVectorizeExtern.bind(this);\r\n    this.doVectorizeIntern = this.doVectorizeIntern.bind(this);\r\n    this.showSVGResult = this.showSVGResult.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n    this.updateSaveButton = this.updateSaveButton.bind(this);\r\n    this.updateCropButton = this.updateCropButton.bind(this);\r\n    this.updateVectButton = this.updateVectButton.bind(this);\r\n    this.showExternalApiConfigurationDialog = this.showExternalApiConfigurationDialog.bind(this);\r\n    this.onExternalAPIConfigAccept = this.onExternalAPIConfigAccept.bind(this);\r\n    \r\n    this.state = {\r\n      polySelection: false,\r\n      zoom: '1.0',\r\n      point: null,\r\n      saveEnabled: false,\r\n      cropEnabled: false,\r\n      vectEnabled: false\r\n    }\r\n\r\n    this.zoomFactor = 0.05;\r\n    this.minZoom = 0.05;\r\n    this.maxZoom = 5.0;\r\n    this.svgString = null;\r\n  }\r\n\r\n  toggleSelectionMode(e) {\r\n    if (this.pap.current == null) {\r\n      return;\r\n    }\r\n    this.pap.current.toggleSelectionMode();\r\n    this.setState({polySelection: this.pap.current.pathSelection});\r\n  }\r\n\r\n  setShieldActive(act) {\r\n    if (this.busyind.current != null) {\r\n      var cl = this.busyind.current.getAttribute(\"class\");\r\n      if (act) {\r\n          cl = classNames(cl, {active:true, inactive: false});\r\n      }\r\n      else {\r\n          cl = classNames(cl, {active:false, inactive: true});\r\n      }\r\n      this.busyind.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  showModalDialog() {\r\n    if (this.modDialog.current != null) {\r\n      this.modDialog.current.setState({active: true});\r\n    }\r\n  }\r\n\r\n  showExternalApiConfigurationDialog() {\r\n    if (this.eaConfDialog.current != null) {\r\n      if (this.eaUrl.current != null) {\r\n        this.eaUrl.current.value = (cm_apiURL == null ? \"\" : cm_apiURL);\r\n      }\r\n      if (this.eaKey.current != null) {\r\n        this.eaKey.current.value = (cm_apiKey == null ? \"\" : cm_apiKey);\r\n      }\r\n      if (this.eaSecret.current != null) {\r\n        this.eaSecret.current.value = (cm_apiSecret == null ? \"\" : cm_apiSecret);\r\n      }\r\n        this.eaConfDialog.current.setState({active: true});\r\n    }\r\n  }\r\n\r\n  processFiles(e) {\r\n    if (e.target.files != null && e.target.files.length === 1) {\r\n      this.svgString = null;\r\n      this.updateSaveButton();      \r\n      if (this.pap.current.allowedTypes.includes(e.target.files.item(0).type) || e.target.files.item(0).name.endsWith(\".pdf\")) {\r\n        // show shield\r\n        this.setShieldActive(true);\r\n        this.pap.current.crBlob = null\r\n        this.pap.current.crImgUrl = null;\r\n        this.updateVectButton();      \r\n        this.pdfRend.current.setState({\r\n          paperSetImage: this.pap.current.loadRasterImage, \r\n          file: e.target.files.item(0)\r\n        });\r\n        this.pap.current.setState({file: e.target.files.item(0)});\r\n      }\r\n      e.target.value = null;\r\n    }\r\n  }\r\n\r\n  doZoom(out, point) {\r\n    var zf = out ? this.zoomFactor : -this.zoomFactor;\r\n    var zoom = parseFloat(this.state.zoom) + zf;\r\n    this.setZoom(zoom, point);\r\n  }\r\n\r\n  setZoom(zoom, point) {\r\n    var z = parseFloat(zoom);\r\n    if (z > this.maxZoom) {\r\n      z = this.maxZoom;\r\n    }\r\n    if (z < this.minZoom) {\r\n      z = this.minZoom;\r\n    }\r\n    this.setState({zoom:parseFloat(z).toPrecision(3), point:point});\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.pdfRend.current.setState({paperSetImage: this.pap.current.loadRasterImage, paperRemoveOldImage: this.pap.current.removeOldImage});\r\n    this.zoomer.current.setState({active: true});\r\n    this.updateSaveButton();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  loadImage(e) {\r\n    e.preventDefault();\r\n    this.hiddenFileInput.current.click();\r\n  }\r\n  \r\n  onExternalAPIConfigAccept() {\r\n    if (this.eaUrl.current != null) {\r\n      if (this.eaUrl.current.value == null || this.eaUrl.current.value === \"\") {\r\n        cm_apiURL = null;\r\n      }\r\n      else {\r\n        cm_apiURL = this.eaUrl.current.value;\r\n      }\r\n    }\r\n    if (this.eaKey.current != null) {\r\n      if (this.eaKey.current.value == null || this.eaKey.current.value === \"\") {\r\n        cm_apiKey = null;\r\n      }\r\n      else {\r\n        cm_apiKey = this.eaKey.current.value;\r\n      }\r\n    }\r\n    if (this.eaSecret.current != null) {\r\n      if (this.eaSecret.current.value == null || this.eaSecret.current.value === \"\") {\r\n        cm_apiSecret = null;\r\n      }\r\n      else {\r\n        cm_apiSecret = this.eaSecret.current.value;\r\n      }\r\n    }\r\n  }\r\n\r\n  onDialogAccept() {\r\n    if (this.svgString != null) {\r\n      var meas = null;\r\n      if (this.measurment.current != null) {\r\n        meas = this.measurment.current.value;\r\n      }\r\n      if (meas == null) {\r\n        meas = \"\";\r\n      }\r\n      var key = 'desc=\"';\r\n      var i1 = this.svgString.indexOf(key);\r\n      if (i1 >= 0) {\r\n        var i2 = this.svgString.indexOf('\"', i1 + key.length);\r\n        if (i2 >= 0) {\r\n          var data = this.svgString.substring(0, i1 + key.length) + meas + this.svgString.substring(i2);\r\n          this.svgString = data;\r\n        }\r\n      }\r\n      var fileName = null;\r\n      if (this.exportFileName.current != null) {\r\n        fileName = this.exportFileName.current.value;\r\n      }\r\n      if (fileName != null) {\r\n        var blob = new Blob([this.svgString], {\r\n          \"type\": \"image/svg+xml\"\r\n        });\r\n        var a = document.createElement(\"a\");\r\n        a.download = fileName;\r\n        a.href = URL.createObjectURL(blob);\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n      }\r\n    }\r\n  }\r\n\r\n  // doVectorizeExtern(pngBlob) {\r\n  //   if (pngBlob == null) {\r\n  //     return;\r\n  //   }\r\n  //   // show shield\r\n  //   this.setShieldActive(true);\r\n  //   var proxyurl = \"\";\r\n  //   var url = 'https://api.vectorizer.io/v3/vectorize?apikey=69936907-18666295&colors=8&minarea=5&threshold=20';\r\n  //   var xhr = new XMLHttpRequest();\r\n  //   xhr.open(\"POST\", (proxyurl+url), true); // method, url, async\r\n  //   xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n  //   xhr.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\r\n\r\n  //   xhr.onreadystatechange = function() {\r\n  //     if (xhr.readyState === 4) {      // completed\r\n  //         if (xhr.status === 200) {    // OK\r\n  //             var response = xhr.responseText;\r\n  //             console.log(response.type);\r\n  //         }\r\n  //         else {\r\n  //           console.log(\"Vectorize error: \"+xhr.status);\r\n  //         }\r\n  //     }\r\n  //   }    \r\n  //   xhr.send(pngBlob);\r\n  // }\r\n\r\n  showSVGResult(svgImgStr) {\r\n    this.svgString = svgImgStr;\r\n    this.updateSaveButton();\r\n    this.pap.current.loadResultSVGImage(svgImgStr);\r\n  }\r\n\r\n  doVectorizeIntern(pngImg) {\r\n    if (pngImg == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    if (window.ImageTracer != null) {\r\n      window.ImageTracer.imageToSVG(pngImg, this.showSVGResult);\r\n    }\r\n  }\r\n\r\n  updateSaveButton() {\r\n    if (this.saveButton.current != null) {\r\n      if (this.svgString != null) {\r\n        this.setState({saveEnabled: true});\r\n      }\r\n      else {\r\n        this.setState({saveEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  updateCropButton() {\r\n    if (this.cropButton.current != null) {\r\n      if (this.pap.current != null) {\r\n        this.setState({cropEnabled: this.pap.current.isCropEnabled()});\r\n      }\r\n      else {\r\n        this.setState({cropEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  updateVectButton() {\r\n    if (this.vectButton.current != null) {\r\n      if (this.pap.current != null && this.pap.current.crImgUrl != null) {\r\n        this.setState({vectEnabled: true});\r\n      }\r\n      else {\r\n        this.setState({vectEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var curzoom = this.state.zoom;\r\n    var point = this.state.point;\r\n    var selIcon = this.state.polySelection ? \"assets/square-dashed-outline.svg\" : \"assets/analytics-outline.svg\";\r\n    var useExternalCroppingAllowed = (cm_apiKey != null && cm_apiSecret != null && cm_apiURL != null);\r\n    return (\r\n        <div className=\"main\">\r\n          <ZoomContext.Provider value={curzoom}>\r\n            <div className=\"toolbar shadow\">\r\n\r\n              <Button name=\"load\" title={\"Load file\"} className={\"active\"} handleClick={ (e) => this.loadImage(e) }>\r\n                <img alt={\"Load file\"} src=\"assets/image-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"clear\" title={\"Clear canvas\"} className={\"active\"} handleClick={ () => {\r\n                    this.svgString = null;\r\n                    this.pap.current.removeProcessedImages();\r\n                    this.pap.current.clearCanvas();\r\n                    this.pdfRend.current.setState({\r\n                      file: null\r\n                    });\r\n                    this.updateSaveButton();\r\n                    this.updateCropButton();\r\n                    this.updateVectButton();\r\n                  } }>\r\n                <img alt={\"Clear canvas\"} src=\"assets/close-circle-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"sel_mode\" \r\n                title={\"Selection mode\"} \r\n                className={\"active\"} \r\n                handleClick={ (e) => { this.toggleSelectionMode(e) } }\r\n              >\r\n                <img alt={\"Selection mode\"} src={selIcon}></img>\r\n              </Button>\r\n\r\n              <Button name=\"crop\" \r\n                ref={this.cropButton} \r\n                title={\"Crop image\"} \r\n                className={\"active\"} \r\n                // handleClick={ () => { this.setShieldActive(true); this.pap.current.cropImage(); this.doCropExtern(this.pap.current.crBlob);} }\r\n                handleClick={ () => { this.setShieldActive(true); this.pap.current.cropImage();} }\r\n                disabled={!this.state.cropEnabled}\r\n              >\r\n                <img alt={\"Crop\"} src=\"assets/crop-outline.svg\"></img>\r\n              </Button>\r\n\r\n              {/* <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeExtern(this.pap.current.crBlob) }> */}\r\n              <Button name=\"to_vector\" \r\n                ref={this.vectButton} \r\n                title={\"Vectorize\"} \r\n                className={\"active\"} \r\n                handleClick={ () => this.doVectorizeIntern(this.pap.current.crImgUrl) }\r\n                disabled={!this.state.vectEnabled}\r\n              >\r\n                <img alt={\"Vectorize\"} src=\"assets/vector.svg\"></img>\r\n              </Button>\r\n              <Button name=\"save\" \r\n                ref={this.saveButton} \r\n                title={\"Save\"} \r\n                className={\"active\"} \r\n                handleClick={ () => this.showModalDialog() }\r\n                disabled={!this.state.saveEnabled}\r\n              >\r\n                <img alt={\"Save\"} src=\"assets/save-outline.svg\"></img>\r\n              </Button>\r\n              <Button name=\"settings\" \r\n                ref={this.saveButton} \r\n                title={\"Settings\"} \r\n                className={\"active\"} \r\n                handleClick={ () => this.showExternalApiConfigurationDialog() }\r\n              >\r\n                <img alt={\"Save\"} src=\"assets/settings-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <PDFRenderer ref={this.pdfRend} shieldHandler={this.setShieldActive}/>\r\n\r\n              <div className=\"filler\"></div>\r\n\r\n              <Button name=\"reset_position\" title={\"Reset position\"} className={\"active\"} handleClick={ () => this.pap.current.resetPosition() }>\r\n                <img alt={\"Reset position\"} src=\"assets/locate.svg\"></img>\r\n              </Button>\r\n              <Button name=\"reset_zoom\" title={\"Reset zoom\"} className={\"active\"} handleClick={ () => this.setState({zoom:1.0}) }>\r\n                <img alt={\"Reset zoom\"} src=\"assets/zoom-to-actual-size.svg\"></img>\r\n              </Button>\r\n\r\n              <ValueChooser \r\n                ref={this.zoomer}\r\n                dbIconSrc={\"assets/zoom-in.svg\"} \r\n                ibIconSrc={\"assets/zoom-out.svg\"}\r\n                dbTitle={\"Zoom in\"}\r\n                ibTitle={\"Zoom out\"}\r\n                dbCallback={ () => this.doZoom(true) }\r\n                ibCallback={ () => this.doZoom(false) }\r\n                prompt={\"Zoom\"}\r\n                minValue={0.05}\r\n                maxValue={5.0}\r\n                step={0.05}\r\n                className=\"zoomer\"\r\n                blurAndEnterHandler={ newZoom => { this.setZoom(newZoom)} }\r\n                currentValue={curzoom}\r\n            >\r\n            </ValueChooser>\r\n\r\n            </div>\r\n\r\n            <div className=\"sand shadow\">\r\n              <Paper \r\n                ref={this.pap} \r\n                zoom={curzoom}\r\n                point={point}\r\n                onMouseWheelZoom={this.doZoom}\r\n                resetZoom={() => this.setState({zoom:1.0})}\r\n                shieldHandler={this.setShieldActive}\r\n                cropButtonStateHandler={this.updateCropButton}\r\n                vectButtonStateHandler={this.updateVectButton}\r\n                useExternalCropping={useExternalCroppingAllowed}\r\n                apiKey={cm_apiKey}\r\n                apiSecret={cm_apiSecret}\r\n                apiURL={cm_apiURL}\r\n              /> \r\n            </div>\r\n          </ZoomContext.Provider>\r\n\r\n          <input ref={this.hiddenFileInput} type=\"file\" style={{display: 'none'}} onChange={this.processFiles}/>\r\n\r\n          <BusyIndicator ref={this.busyind}/>\r\n\r\n          <Dialog ref={this.modDialog} acceptCallback={this.onDialogAccept} title={\"Save dialog\"}>\r\n            <div className={\"dlgrow\"}>\r\n              <label>Measurement</label>\r\n              <input ref={this.measurment} type=\"text\" placeholder={\"30 ft\"}></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>File name</label>\r\n              <input ref={this.exportFileName} type=\"text\"></input>\r\n            </div>\r\n          </Dialog>\r\n\r\n          <Dialog ref={this.eaConfDialog} acceptCallback={this.onExternalAPIConfigAccept} title={\"External API configuration\"}>\r\n            <div className={\"dlgrow\"}>\r\n              <label>API URL</label>\r\n              <input ref={this.eaUrl} type=\"text\"></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>API Key (User Id)</label>\r\n              <input ref={this.eaKey} type=\"text\"></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>API Secret</label>\r\n              <input ref={this.eaSecret} type=\"text\"></input>\r\n            </div>\r\n          </Dialog>\r\n\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Extractor;\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Extractor from './components/Extractor';\nimport './App.css';\n\nReactDOM.render(<Extractor />, document.getElementById('root'))\n"],"sourceRoot":""}