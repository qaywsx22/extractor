{"version":3,"sources":["components/Button.js","components/Paper.js","components/ValueChooser.js","components/PDFRenderer.js","components/BusyIndicator.js","components/Dialog.js","components/Extractor.js","index.js"],"names":["Button","React","forwardRef","props","ref","onClick","handleClick","title","className","children","polygonPositionHandler","dim","finalMatrix","fabricObject","x","points","this","pointIndex","pathOffset","y","fabric","util","transformPoint","multiplyTransformMatrices","canvas","viewportTransform","calcTransformMatrix","actionHandler","eventData","transform","polygon","target","currentControl","controls","__corner","mouseLocalPosition","toLocalPoint","Point","polygonBaseSize","_getNonTransformedDimensions","size","_getTransformedDimensions","finalPointPosition","resizePolygon","peer","activeObject","paper","getActiveObject","setActiveObject","mask","edit","objectCaching","Object","prototype","cornerStyle","cornerColor","transparentCorners","borderColor","hasBorders","requestRenderAll","Paper","state","file","updateViewBoxPosition","bind","setZoom","resetPosition","clearCanvas","cropImage","loadRasterImage","loadSVGImage","loadResultSVGImage","loadCropedImage","cancelMask","onKeyDown","removeOldImage","toggleSelectionMode","polyModeMouseDown","rectModeMouseDown","wrapper","createRef","paperId","pathSelection","activeLine","lineArray","pointArray","crBlob","crImgUrl","startPos","moveFlag","newFlag","mdp","pausePanning","allowedTypes","imageOptions","hasControls","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockScewingX","lockScewingY","lockRotation","selectable","hoverCursor","locPaper","items","getObjects","reverse","forEach","item","id","remove","opt","pt","getPointer","point","onMouseWheelZoom","e","deltaY","preventDefault","stopPropagation","evt","ctrlKey","obj","findTarget","lastControl","length","reduce","acc","index","anchorIndex","fn","Control","positionHandler","absolutePoint","actionPerformed","_setPositionDimensions","newX","newY","setPositionByOrigin","actionName","editPolygon","deselected","type","selected","startsWith","screenX","screenY","polyModeMouseUp","endPos","set","width","Math","abs","height","o","left","top","setCoords","polyModeMouseMove","rectModeMouseMove","setWidth","current","offsetWidth","setHeight","offsetHeight","renderAll","deltaX","delta","relativePan","val","getVpCenter","zoomToPoint","absolutePan","keyCode","resetZoom","clear","setState","discardActiveObject","tco","getCoords","mco","bottom","right","zoomF","getZoom","cropX","scaleX","cropY","scaleY","dirty","clipPath","mc","getCenterPoint","tc","originX","originY","optObj","withoutTransform","withoutShadow","cloned","toDataURL","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","b64toBlob","split","Image","fromURL","img","scaleToHeight","getHeight","scaleToWidth","getWidth","add","center","fire","shieldHandler","svgString","loadSVGFromString","crossOrigin","objects","options","groupSVGElements","w","h","line","Polygon","moveable","fill","stroke","strokeDashArray","strokeWidth","opacity","setControlVisible","toggleDrawPolygon","generatePolygon","curpos","pointOption","Date","getTime","radius","linePoints","Circle","Line","evented","class","get","polyPoint","addPoint","pointer","x2","y2","rectMaskOptions","selectionBorderColor","cornerStrokeColor","hasBorder","Rect","pos","selection","on","onMouseWheel","onMouseDown","onMouseUp","onMouseMove","onMouseDblclick","onSelectionCleared","onSelectionCreated","window","addEventListener","onWindowResize","Canvas","tabIndex","initCanvas","prevProps","prevState","zoom","includes","reader","FileReader","callback","onload","f","result","readAsText","readAsDataURL","Component","ValueChooser","active","value","decrementButton","incrementButton","mainContainer","input","leftSeparator","rightSeparator","update","onBlurI","onFocusI","oldInputValue","cl","getAttribute","classNames","inactive","setAttribute","currentValue","cur","parseFloat","min","max","isNaN","disabled","blurAndEnterHandler","clName","dbTitle","dbCallback","alt","src","dbIconSrc","placeholder","prompt","minValue","maxValue","step","onBlur","onFocus","ibTitle","ibCallback","ibIconSrc","pdfjsLib","require","pdfjsWorker","GlobalWorkerOptions","workerSrc","PDFRenderer","totalPageNumber","currentPage","paperSetImage","paperRemoveOldImage","hiddenCanvas","pager","loadPdfFile","saveImageToState","loadPage","loadPdfDocument","renderPage","processError","changePage","setCurrentPage","pdfDocument","name","endsWith","parseInt","imgStr","pageNumber","pdf","getPage","then","page","viewport","getViewport","scale","context","getContext","render","canvasContext","promise","numPages","error","console","log","fileReader","lPDFD","perr","ev","typedarray","getDocument","readAsArrayBuffer","act","dec","cp","tp","pn","style","display","BusyIndicator","Dialog","modal","ok","cancel","dialogWrapper","content","shield","doAccept","doCancel","show","hide","acceptCallback","titleClassName","ZoomContext","createContext","Extractor","pap","hiddenFileInput","pdfRend","zoomer","busyind","modDialog","measurment","exportFileName","processFiles","loadImage","doZoom","setShieldActive","showModalDialog","onDialogAccept","doVectorizeExtern","doVectorizeIntern","showSVGResult","polySelection","zoomFactor","minZoom","maxZoom","files","out","zf","z","toPrecision","click","meas","key","i1","indexOf","i2","data","substring","fileName","blob","a","document","createElement","download","href","URL","createObjectURL","body","appendChild","removeChild","pngBlob","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","response","responseText","send","svgImgStr","pngImg","ImageTracer","imageToSVG","curzoom","selIcon","Provider","newZoom","onChange","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.dd91efd8.chunk.js","sourcesContent":["import React from 'react';\r\n// import './Button.css';\r\n\r\nvar Button = React.forwardRef((props, ref) => (\r\n  <button\r\n    ref={ref}\r\n    onClick={props.handleClick}\r\n    title={props.title}\r\n    className={props.className}\r\n    >{props.children}\r\n  </button>\r\n))\r\n\r\nexport default Button;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\n// import './Paper.css';\r\n\r\nfunction b64toBlob(b64Data, contentType, sliceSize) {\r\n  contentType = contentType || '';\r\n  sliceSize = sliceSize || 512;\r\n\r\n  var byteCharacters = atob(b64Data);\r\n  var byteArrays = [];\r\n\r\n  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n          byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n\r\n      byteArrays.push(byteArray);\r\n  }\r\n\r\n  var blob = new Blob(byteArrays, {type: contentType});\r\n  return blob;\r\n}\r\n\r\nfunction addPoint(evt, peer) {\r\n  var curpos = peer.paper.getPointer(evt);\r\n  var pointOption = {\r\n    id: new Date().getTime(),\r\n    radius: 5,\r\n    fill: '#ffffff',\r\n    stroke: '#333333',\r\n    strokeWidth: 0.5,\r\n    left: curpos.x,\r\n    top: curpos.y,\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    originX: 'center',\r\n    originY: 'center',\r\n    objectCaching: false,\r\n  };\r\n  var linePoints = [\r\n    curpos.x,\r\n    curpos.y,\r\n    curpos.x,\r\n    curpos.y\r\n  ];\r\n  var lineOption = {\r\n    strokeWidth: 2,\r\n    fill: '#999999',\r\n    stroke: '#999999',\r\n    originX: 'center',\r\n    originY: 'center',\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    evented: false,\r\n    objectCaching: false,\r\n  };\r\n\r\n  var point = new fabric.Circle(pointOption);\r\n\r\n  if (peer.pointArray.length === 0) {\r\n    peer.newFlag = true;\r\n    // fill first point with red color\r\n    point.set({\r\n      fill: 'red'\r\n    });\r\n  }\r\n\r\n  var line = new fabric.Line(linePoints, lineOption);\r\n  line.class = 'line';\r\n  \r\n  var polygon = null;\r\n\r\n  if (peer.mask != null) {\r\n    var points = peer.mask.get('points');\r\n    points.push({\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    });\r\n    polygon = new fabric.Polygon(points, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false\r\n    });\r\n    peer.paper.remove(peer.mask);\r\n    peer.paper.add(polygon);\r\n    peer.mask = polygon;\r\n    peer.paper.renderAll();\r\n  } \r\n  else {\r\n    var polyPoint = [{\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    }, ];\r\n    polygon = new fabric.Polygon(polyPoint, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false,\r\n    });\r\n    peer.mask = polygon;\r\n    peer.paper.add(polygon);\r\n  }\r\n\r\n  peer.activeLine = line;\r\n  peer.pointArray.push(point);\r\n  peer.lineArray.push(line);\r\n\r\n  peer.paper.add(line);\r\n  peer.paper.add(point);\r\n}\r\n\r\nfunction generatePolygon(peer) {\r\n  var points = [];\r\n  for (var point of peer.pointArray) {\r\n    points.push({\r\n      x: point.left,\r\n      y: point.top,\r\n    });\r\n    peer.paper.remove(point);\r\n  }\r\n\r\n  for (var line of peer.lineArray) {\r\n    peer.paper.remove(line);\r\n  }\r\n\r\n  peer.paper.remove(peer.mask).remove(peer.activeLine);\r\n\r\n  var polygon = new fabric.Polygon(points, {\r\n    id: \"mask\",\r\n    objectCaching: false,\r\n    moveable: false,\r\n    selectable: true,\r\n    fill: \"rgba(255,255,0,0.2)\",\r\n    stroke: 'red',\r\n    strokeDashArray: [8, 8],\r\n    strokeWidth: 1,\r\n    opacity: 1.0\r\n});\r\n  peer.paper.add(polygon);\r\n  peer.mask = polygon;\r\n  peer.mask.setControlVisible(\"mtr\", false);\r\n\r\n  toggleDrawPolygon(peer);\r\n  resizePolygon(peer);\r\n}\r\n\r\nfunction toggleDrawPolygon(peer) {\r\n  if (peer.newFlag) {\r\n    // stop draw mode\r\n    peer.activeLine = null;\r\n    peer.lineArray = [];\r\n    peer.pointArray = [];\r\n    peer.newFlag = false;\r\n  } else {\r\n    // start draw mode\r\n    peer.newFlag = true;\r\n  }\r\n}\r\n\r\nfunction editPolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = true;\r\n  activeObject.objectCaching = false;\r\n\r\n  var lastControl = activeObject.points.length - 1;\r\n  activeObject.cornerStyle = 'circle';\r\n  activeObject.controls = activeObject.points.reduce((acc, point, index) => {\r\n    acc['p' + index] = new fabric.Control({\r\n      positionHandler: polygonPositionHandler,\r\n      actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),\r\n      actionName: 'modifyPolygon',\r\n      pointIndex: index,\r\n    });\r\n    return acc;\r\n  }, {});\r\n\r\n  activeObject.hasBorders = false;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\nfunction polygonPositionHandler(dim, finalMatrix, fabricObject) {\r\n  var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),\r\n      y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);\r\n  \r\n  return fabric.util.transformPoint(\r\n    { x: x, y: y },\r\n    fabric.util.multiplyTransformMatrices(\r\n      fabricObject.canvas.viewportTransform,\r\n      fabricObject.calcTransformMatrix()\r\n    )\r\n  );\r\n}\r\n\r\nfunction actionHandler(eventData, transform, x, y) {\r\n  var polygon = transform.target,\r\n      currentControl = polygon.controls[polygon.__corner],\r\n      mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),\r\n      polygonBaseSize = polygon._getNonTransformedDimensions(),\r\n      size = polygon._getTransformedDimensions(0, 0),\r\n      finalPointPosition = {\r\n        x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,\r\n        y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y\r\n      };\r\n  polygon.points[currentControl.pointIndex] = finalPointPosition;\r\n  return true;\r\n}\r\n\r\nfunction anchorWrapper(anchorIndex, fn) {\r\n  return function(eventData, transform, x, y) {\r\n    var fabricObject = transform.target,\r\n        absolutePoint = fabric.util.transformPoint({\r\n            x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),\r\n            y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),\r\n        }, fabricObject.calcTransformMatrix()),\r\n        actionPerformed = fn(eventData, transform, x, y);\r\n\r\n    fabricObject._setPositionDimensions({});\r\n\r\n    var polygonBaseSize = fabricObject._getNonTransformedDimensions(),\r\n        newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,\r\n        newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;\r\n    fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);\r\n    return actionPerformed;\r\n  }\r\n}\r\n\r\nfunction resizePolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = false;\r\n  activeObject.objectCaching = false;\r\n  activeObject.controls = fabric.Object.prototype.controls;\r\n  activeObject.cornerStyle = 'rect';\r\n  activeObject.cornerColor = 'red';\r\n  activeObject.transparentCorners = true;\r\n  activeObject.borderColor = 'red';\r\n  activeObject.hasBorders = true;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\n\r\nclass Paper extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      file: null\r\n    }   \r\n    this.updateViewBoxPosition = this.updateViewBoxPosition.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.resetPosition = this.resetPosition.bind(this);\r\n    this.clearCanvas = this.clearCanvas.bind(this);\r\n    this.cropImage = this.cropImage.bind(this);\r\n    this.loadRasterImage = this.loadRasterImage.bind(this);\r\n    this.loadSVGImage = this.loadSVGImage.bind(this);\r\n    this.loadResultSVGImage = this.loadResultSVGImage.bind(this);\r\n    this.loadCropedImage = this.loadCropedImage.bind(this);\r\n    this.cancelMask = this.cancelMask.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.removeOldImage = this.removeOldImage.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n    this.polyModeMouseDown = this.polyModeMouseDown.bind(this);\r\n    this.rectModeMouseDown = this.rectModeMouseDown.bind(this);\r\n\r\n    this.wrapper = React.createRef();\r\n    this.paperId = React.createRef();\r\n\r\n    this.pathSelection = false;\r\n    this.activeLine = null;\r\n    this.lineArray = [];\r\n    this.pointArray = [];\r\n    this.crBlob = null;\r\n    this.crImgUrl = null;\r\n    this.paper = null;\r\n    this.mask = null;\r\n    this.startPos = null;\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mdp = null;\r\n    this.pausePanning = false;\r\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/svg+xml'];\r\n    this.imageOptions = {\r\n      hasControls: false,\r\n      hasBorders: false,\r\n      lockMovementX: true,\r\n      lockMovementY: true,\r\n      lockScalingX: true,\r\n      lockScalingY: true,\r\n      lockScewingX: true,\r\n      lockScewingY: true,\r\n      lockRotation: true,\r\n      selectable: false,\r\n      hoverCursor: 'default'\r\n    };\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    if (this.pathSelection) {\r\n      this.pathSelection = false;\r\n    }\r\n    else {\r\n      this.pathSelection = true;\r\n    }\r\n    this.cancelMask();\r\n    if (!this.pathSelection && this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          if (\"target\" !== item.id && \"croped\" !== item.id) {\r\n            locPaper.remove(item);\r\n          }\r\n        });\r\n      }\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }  \r\n\r\n  onMouseWheel(opt) {\r\n    var pt = this.paper.getPointer(opt);\r\n    var point = new fabric.Point(pt.x, pt.y);\r\n    this.props.onMouseWheelZoom(opt.e.deltaY < 0, point);\r\n    opt.e.preventDefault();\r\n    opt.e.stopPropagation();\r\n  }\r\n\r\n  onMouseDblclick(evt) {\r\n    if (evt.e.ctrlKey || !this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      var obj = this.paper.findTarget(evt);\r\n      if (obj != null && obj === this.mask) {\r\n        editPolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCleared(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.deselected && evt.deselected.length > 0) {\r\n        evt.deselected.forEach((item) => {\r\n          if (item.id === \"mask\" && item.type === 'polygon') {\r\n            item.edit = false;\r\n            item.controls = fabric.Object.prototype.controls;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCreated(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.selected && evt.selected.length ===1 && evt.selected[0].id === \"mask\") {\r\n        resizePolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onMouseDown(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n    if (evt.e.ctrlKey) {\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseDown(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseDown(evt);\r\n    }\r\n  }\r\n\r\n  onMouseUp(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n    }\r\n    else {\r\n      if (this.pathSelection) {\r\n        this.polyModeMouseUp(evt, this);\r\n      }\r\n      else if (this.mask != null) {\r\n        if (this.moveFlag) {\r\n          var endPos = this.paper.getPointer(evt);\r\n          this.mask.set({\r\n            width: Math.abs(endPos.x - this.startPos.x),\r\n            height: Math.abs(endPos.y - this.startPos.y)\r\n          });\r\n          var o = {\r\n            left: this.startPos.x,\r\n            top: this.startPos.y\r\n          };\r\n          if (endPos.x < this.startPos.x) {\r\n            o.left = endPos.x;\r\n          }\r\n          if (endPos.y < this.startPos.y) {\r\n            o.top = endPos.y;\r\n          }\r\n          this.mask.setCoords(o);\r\n          this.paper.setActiveObject(this.mask);\r\n          this.paper.requestRenderAll();\r\n        }\r\n        else if (this.newFlag) {\r\n          this.paper.remove(this.mask);\r\n          this.mask = null;\r\n        }\r\n        this.newFlag = false;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  onMouseMove(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseMove(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseMove(evt);\r\n    }\r\n  }\r\n\r\n  onWindowResize(evt) {\r\n    this.paper.setWidth(this.wrapper.current.offsetWidth);\r\n    this.paper.setHeight(this.wrapper.current.offsetHeight);\r\n    this.paper.renderAll();\r\n  }\r\n\r\n  updateViewBoxPosition(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (this.mdp != null) {\r\n      var deltaX = evt.e.screenX - this.mdp.x;\r\n      var deltaY = evt.e.screenY - this.mdp.y;\r\n      this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n      var delta = new fabric.Point(deltaX, deltaY);\r\n      this.paper.relativePan(delta);\r\n    }\r\n  }\r\n\r\n  setZoom(val, point) {\r\n    var pt = point;\r\n    if (pt == null) {\r\n      pt = this.paper.getVpCenter();\r\n    }\r\n    this.paper.zoomToPoint(pt, val);\r\n  }\r\n\r\n  // reset viewport position to 0,0\r\n  resetPosition() {\r\n    this.paper.absolutePan(new fabric.Point(0, 0));\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    if (e.keyCode === 27) { // ESC\r\n      this.cancelMask(e);\r\n      if (this.pathSelection && this.paper != null) {\r\n        var locPaper = this.paper;\r\n        var items = this.paper.getObjects();\r\n        if (items != null) {\r\n          items = items.reverse();\r\n          items.forEach(function(item){\r\n            if (\"target\" !== item.id && \"croped\" !== item.id) {\r\n              locPaper.remove(item);\r\n            }\r\n          });\r\n        }\r\n        this.paper.requestRenderAll();\r\n      }\r\n      }\r\n  }\r\n\r\n  cancelMask(e) {\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    if (this.mask != null) {\r\n      this.paper.remove(this.mask);\r\n      this.mask = null;\r\n    }\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    this.paper.requestRenderAll();\r\n  }\r\n\r\n  removeOldImage() {\r\n    if (this.props.resetZoom != null) {\r\n      this.props.resetZoom();\r\n    }\r\n    this.resetPosition();\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mask = null;\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          locPaper.remove(item);\r\n        });\r\n      }\r\n      this.paper.clear();\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    this.removeOldImage();\r\n    // this.crBlob = null\r\n    // this.crImgUrl = null;\r\n    this.setState({file: null});\r\n  }\r\n\r\n  cropImage() {\r\n    if (this.paper != null) {\r\n      this.paper.discardActiveObject();\r\n      this.setZoom(1.0);\r\n      this.resetPosition();\r\n      var items = this.paper.getObjects();\r\n      if (items != null && this.mask != null) {\r\n        var target = items[0];\r\n        var mask = this.mask;\r\n        var tco = target.getCoords();\r\n        var mco = mask.getCoords();\r\n        var left = tco[0].x;\r\n        if (mco[0].x > left) {\r\n          left = mco[0].x;\r\n        }\r\n        var top = tco[0].y;\r\n        if (mco[0].y > top) {\r\n          top = mco[0].y;\r\n        }\r\n        var bottom = tco[2].y;\r\n        if (mco[2].y < bottom) {\r\n          bottom = mco[2].y;\r\n        }\r\n        var right = tco[1].x;\r\n        if (mco[1].x < right) {\r\n          right = mco[1].x;\r\n        }\r\n        var zoomF = this.paper.getZoom();\r\n        var cropX = (left - tco[0].x) / (target.scaleX * zoomF);\r\n        var cropY = (top - tco[0].y) / (target.scaleY * zoomF);\r\n        var width = (right - left) / (target.scaleX * zoomF);\r\n        var height = (bottom - top) / (target.scaleY * zoomF);\r\n        target.dirty = true;\r\n        target.clipPath = mask;\r\n        var mc = mask.getCenterPoint();\r\n        var tc = target.getCenterPoint();\r\n        this.paper.remove(mask);\r\n        mask.originX = 'center';\r\n        mask.originY = 'center';\r\n        mask.left = -(tc.x - mc.x) / (target.scaleX);\r\n        mask.top = -(tc.y - mc.y) / (target.scaleY);\r\n        mask.scaleX = 1.0 * zoomF / (target.scaleX);\r\n        mask.scaleY = 1.0 * zoomF / (target.scaleY);\r\n        mask.setCoords();\r\n        mask.dirty = true;\r\n\r\n        this.paper.renderAll();\r\n\r\n        var optObj = {\r\n          left:cropX, \r\n          top:cropY, \r\n          width:width, \r\n          height:height, \r\n          withoutTransform: true, \r\n          withoutShadow: true\r\n        };\r\n        var cloned = target.toDataURL(optObj);\r\n        var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n        this.crBlob = crBlob;\r\n        this.crImgUrl = cloned;\r\n        fabric.Image.fromURL(cloned, this.loadCropedImage);\r\n      }\r\n      if (this.props.resetZoom != null) {\r\n        this.props.resetZoom();\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCropedImage(img) {\r\n    this.clearCanvas();        \r\n    img.set(this.imageOptions);\r\n    img.set({id:\"croped\"});\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(this.paper.getHeight());\r\n    }\r\n    else {\r\n      img.scaleToWidth(this.paper.getWidth());\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.requestRenderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }  \r\n \r\n  loadResultSVGImage(svgString) {\r\n    this.clearCanvas();        \r\n    fabric.loadSVGFromString(svgString, this.loadSVGImage, null, {crossOrigin: 'anonymous'});  \r\n  }\r\n\r\n  loadSVGImage(objects, options) {\r\n    var obj = fabric.util.groupSVGElements(objects, options);\r\n    obj.set(this.imageOptions);\r\n    this.paper.add(obj);\r\n    obj.center().setCoords();\r\n\r\n    this.paper.renderAll()\r\n    this.paper.fire('object:modified')\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n  \r\n  loadRasterImage(img) {\r\n    img.set(this.imageOptions);\r\n    img.set({id:\"target\"});\r\n    var w = this.paper.getWidth();\r\n    var h = this.paper.getHeight();\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(h);\r\n    }\r\n    else if (img.width === img.height) {\r\n      if (w > h) {\r\n        img.scaleToWidth(h);\r\n      }\r\n      else {\r\n        img.scaleToWidth(w);\r\n      }\r\n    }\r\n    else {\r\n      img.scaleToWidth(w);\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.renderAll();\r\n    this.paper.fire('object:modified');\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n\r\n  polyModeMouseDown(o, peer) {\r\n    if (!peer.newFlag && peer.mask != null) {\r\n      return;\r\n    }\r\n    if (peer.mask != null && o.target && o.target.id === this.pointArray[0].id) {\r\n      // when click on the first point\r\n      generatePolygon(peer);\r\n    } else {\r\n      addPoint(o, peer);\r\n    }\r\n  }\r\n  \r\n  polyModeMouseMove(o, peer) {\r\n    if (peer.newFlag) {\r\n      if (peer.activeLine && peer.activeLine.class === 'line') {\r\n        var pointer = peer.paper.getPointer(o);\r\n        peer.activeLine.set({\r\n          x2: pointer.x,\r\n          y2: pointer.y\r\n        });\r\n        var points = peer.mask.get('points');\r\n        points[peer.pointArray.length] = {\r\n          x: pointer.x,\r\n          y: pointer.y,\r\n        };\r\n        peer.mask.set({\r\n          points\r\n        });\r\n      }\r\n      peer.paper.renderAll();\r\n    }\r\n  }\r\n\r\n  polyModeMouseUp(o, peer) {\r\n  }\r\n\r\n  rectModeMouseDown(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    this.startPos = this.paper.getPointer(evt);\r\n    if (this.mask == null) {\r\n      var rectMaskOptions = {\r\n        fill: \"rgba(255,255,0,0.2)\",\r\n        stroke: 'red',\r\n        strokeDashArray: [8, 8],\r\n        \"stroke-width\": 2,\r\n        opacity: 1.0,\r\n        left: this.startPos.x,\r\n        top: this.startPos.y,\r\n        width: 0,\r\n        height: 0,\r\n        evented: true,\r\n        selectable: true,\r\n        lockScewingX: true,\r\n        lockScewingY: true,\r\n        lockRotation: true,\r\n        selectionBorderColor: 'red',\r\n        transparentCorners: true,\r\n        cornerColor: 'red',\r\n        cornerStrokeColor: 'red',\r\n        hasBorder: false,\r\n        id: \"mask\"\r\n      };\r\n      this.newFlag = true;\r\n      this.mask = new fabric.Rect(rectMaskOptions);\r\n      this.paper.add(this.mask);\r\n      this.mask.setControlVisible(\"mtr\", false);\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  rectModeMouseMove(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null && this.startPos != null && this.newFlag) {\r\n      var pos = this.paper.getPointer(evt);\r\n      var w = pos.x - this.startPos.x;\r\n      var h = pos.y - this.startPos.y;\r\n      this.mask.set({\r\n        width: w,\r\n        height: h\r\n      });\r\n      this.paper.requestRenderAll();\r\n      this.moveFlag = true;\r\n    }\r\n  }\r\n\r\n  rectModeMouseUp(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null) {\r\n      if (this.moveFlag) {\r\n        var endPos = this.paper.getPointer(evt);\r\n        this.mask.set({\r\n          width: Math.abs(endPos.x - this.startPos.x),\r\n          height: Math.abs(endPos.y - this.startPos.y)\r\n        });\r\n        var o = {\r\n          left: this.startPos.x,\r\n          top: this.startPos.y\r\n        };\r\n        if (endPos.x < this.startPos.x) {\r\n          o.left = endPos.x;\r\n        }\r\n        if (endPos.y < this.startPos.y) {\r\n          o.top = endPos.y;\r\n        }\r\n        this.mask.setCoords(o);\r\n        this.paper.setActiveObject(this.mask);\r\n        this.paper.requestRenderAll();\r\n      }\r\n      else if (this.newFlag) {\r\n        this.paper.remove(this.mask);\r\n        this.mask = null;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  initCanvas() {\r\n    this.paper.selection = false;\r\n    if (this.props.onMouseWheelZoom != null) {\r\n      this.paper.on('mouse:wheel', this.onMouseWheel.bind(this));\r\n    }\r\n    this.paper.on('mouse:down', this.onMouseDown.bind(this));\r\n    this.paper.on('mouse:up', this.onMouseUp.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:dblclick', this.onMouseDblclick.bind(this));\r\n    this.paper.on('selection:cleared', this.onSelectionCleared.bind(this));\r\n    this.paper.on('selection:created', this.onSelectionCreated.bind(this));\r\n    \r\n    window.addEventListener(\"resize\", this.onWindowResize.bind(this)); \r\n  }\r\n\r\n  componentDidMount() {\r\n    this.paper = new fabric.Canvas(this.paperId.current.id, {\r\n      height: this.wrapper.current.offsetHeight,\r\n      width: this.wrapper.current.offsetWidth\r\n    });\r\n    this.wrapper.current.tabIndex = 1;\r\n    this.wrapper.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (this.props.zoom !== this.paper.getZoom()) {\r\n      this.setZoom(this.props.zoom, this.props.point);\r\n    }\r\n    if (this.state.file === null) {\r\n        return;\r\n    }\r\n    var file = this.state.file;\r\n    this.clearCanvas();\r\n    // check type\r\n    if (this.allowedTypes.includes(file.type)) {\r\n      var reader = new FileReader();\r\n      var callback = null;\r\n\r\n      // handle svg\r\n      if (file.type === 'image/svg+xml') {\r\n        callback = this.loadSVGImage;\r\n        reader.onload = function(f) {\r\n          fabric.loadSVGFromString(f.target.result, callback, null, {crossOrigin: 'anonymous'});\r\n        }\r\n        reader.readAsText(file);\r\n        return;\r\n      }\r\n\r\n      // handle image, read file, add to canvas\r\n      callback = this.loadRasterImage;\r\n      reader.onload = function(f) {\r\n        fabric.Image.fromURL(f.target.result, callback);\r\n      }\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <div className=\"main\">\r\n      <div className=\"canvasWrapper\" ref={this.wrapper}>\r\n        <canvas id=\"canvasElementId\" className=\"paper\" ref={this.paperId}></canvas>\r\n      </div>\r\n    </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Paper;","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\n// import './ValueChooser.css';\r\n\r\nclass ValueChooser extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            active: false,\r\n            value: null\r\n        }\r\n        this.decrementButton = React.createRef();\r\n        this.incrementButton = React.createRef();\r\n        this.mainContainer = React.createRef();\r\n        this.input = React.createRef();\r\n        this.leftSeparator = React.createRef();\r\n        this.rightSeparator = React.createRef();\r\n\r\n        this.update = this.update.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onBlurI = this.onBlurI.bind(this);\r\n        this.onFocusI = this.onFocusI.bind(this);\r\n\r\n        this.oldInputValue = null; \r\n    }\r\n\r\n    update(prevState, prevProps) {\r\n        var cl;\r\n        if (prevState == null || this.state.active !== prevState.active) {\r\n            cl = this.mainContainer.current.getAttribute(\"class\");\r\n            if (this.state.active) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.mainContainer.current.setAttribute(\"class\", cl);\r\n        }\r\n        if (!this.state.active) {\r\n            return;\r\n        }\r\n        if (prevProps == null || this.props.leftSeparator !== prevProps.leftSeparator) {\r\n            cl = this.leftSeparator.current.getAttribute(\"class\");\r\n            if (this.props.leftSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.leftSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null || this.props.rightSeparator !== prevProps.rightSeparator) {\r\n            cl = this.rightSeparator.current.getAttribute(\"class\");\r\n            if (this.props.rightSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.rightSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null) {\r\n            if (prevState == null) {\r\n                this.input.current.value = this.state.value;\r\n            }\r\n        }\r\n        else if (prevProps == null || this.props.currentValue !== this.input.current.value) {\r\n            this.input.current.value = this.props.currentValue;\r\n        }\r\n\r\n        if (this.input.current != null) {\r\n            var cur = parseFloat(this.input.current.value);\r\n            var min = parseFloat(this.input.current.min);\r\n            var max = parseFloat(this.input.current.max);\r\n            if (this.decrementButton.current != null) {\r\n                if (!isNaN(cur) && cur > min) {\r\n                    this.decrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.decrementButton.current.disabled = true;\r\n                }\r\n            }\r\n            if (this.incrementButton.current != null) {\r\n                if (!isNaN(cur) && cur < max) {\r\n                    this.incrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.incrementButton.current.disabled = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        if (this.props.blurAndEnterHandler != null && e.keyCode === 13  && this.oldInputValue !== this.input.current.value) { // ENTER\r\n            this.props.blurAndEnterHandler(parseFloat(this.input.current.value));\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n\r\n    onBlurI(e) {\r\n        if (this.props.blurAndEnterHandler != null && this.oldInputValue !== this.input.current.value) {\r\n            this.props.blurAndEnterHandler(this.input.current.value);\r\n            this.oldInputValue = null;\r\n        }\r\n    }\r\n\r\n    onFocusI(e) {\r\n        if (this.props.blurAndEnterHandler != null) {\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n       \r\n    componentDidUpdate(prevProps, prevState) {\r\n        this.update(prevState, prevProps);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        this.input.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n        this.update();\r\n    }\r\n  \r\n    render() {\r\n        var clName = \"inactive blockdiv\";\r\n        if (this.props.className != null) {\r\n            clName += \" \" + this.props.className;\r\n        }\r\n        return (\r\n            <div className={clName} ref={this.mainContainer}>\r\n                <div ref={this.leftSeparator} className=\"separator inactive\"></div>\r\n                <Button ref={this.decrementButton} title={this.props.dbTitle} handleClick={ this.props.dbCallback }>\r\n                    <img alt={this.props.dbTitle} src={this.props.dbIconSrc}></img>\r\n                </Button>\r\n                <input \r\n                    className=\"value_input\" \r\n                    ref={this.input} \r\n                    type=\"text\"\r\n                    placeholder={this.props.prompt} \r\n                    min={this.props.minValue}\r\n                    max={this.props.maxValue} \r\n                    step={this.props.step} \r\n                    onBlur={this.onBlurI} \r\n                    onFocus={this.onFocusI}\r\n                    >\r\n                </input>\r\n                <Button ref={this.incrementButton} title={this.props.ibTitle} handleClick={ this.props.ibCallback }>\r\n                    <img alt={this.props.ibTitle}src={this.props.ibIconSrc}></img>\r\n                </Button>\r\n                <div ref={this.rightSeparator} className=\"separator inactive\"></div>\r\n                {this.props.children}\r\n            </div>\r\n        )\r\n  }\r\n}\r\n\r\nexport default ValueChooser;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\nimport ValueChooser from './ValueChooser';\r\n// import './PDFRenderer.css';\r\n\r\nvar pdfjsLib = require(\"pdfjs-dist/build/pdf.js\");\r\nvar pdfjsWorker = require('pdfjs-dist/build/pdf.worker.entry');\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n// const PageContext = React.createContext(1);\r\n\r\nclass PDFRenderer extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n        totalPageNumber: 0,\r\n        currentPage: 0,\r\n        paperSetImage: null,\r\n        paperRemoveOldImage: null,\r\n        file: null\r\n    }\r\n    this.hiddenCanvas = React.createRef();\r\n    this.pager = React.createRef();\r\n\r\n    this.update = this.update.bind(this);\r\n    this.loadPdfFile = this.loadPdfFile.bind(this);\r\n    this.saveImageToState = this.saveImageToState.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.loadPdfDocument = this.loadPdfDocument.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.renderPage = this.renderPage.bind(this);\r\n    this.processError = this.processError.bind(this);\r\n    this.changePage = this.changePage.bind(this);\r\n    this.setCurrentPage = this.setCurrentPage.bind(this);\r\n\r\n    this.pdfDocument = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.pdfDocument = null;\r\n    this.setState({currentPage: 0, totalPageNumber: 0});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!this.update(prevState)) {\r\n      return;\r\n    }\r\n    if (this.state.file === null || !this.state.file.name.endsWith(\".pdf\")) {\r\n        return;\r\n    }\r\n    if (prevState != null) {\r\n      if (prevState.file !== this.state.file) {\r\n        this.loadPdfFile(this.state.file);\r\n        return;\r\n      }\r\n      if (this.state.totalPageNumber >= 1 && this.state.currentPage <= this.state.totalPageNumber && this.pdfDocument != null && this.state.currentPage !== prevState.currentPage) {\r\n        this.loadPage(parseInt(this.state.currentPage), this.pdfDocument);\r\n      }\r\n    }\r\n  }\r\n\r\n  saveImageToState() {\r\n    var imgStr = this.hiddenCanvas.current.toDataURL(\"image/png\");\r\n    if (imgStr != null && this.state.paperSetImage != null) {\r\n      fabric.Image.fromURL(imgStr, this.state.paperSetImage);\r\n    }\r\n  }\r\n\r\n  loadPage(pageNumber, pdf) {\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    if (this.state.paperRemoveOldImage != null) {\r\n      this.state.paperRemoveOldImage();\r\n    }\r\n    pdf.getPage(pageNumber).then(this.renderPage);\r\n  }\r\n\r\n  renderPage(page) {\r\n    var viewport = page.getViewport({\r\n        scale: 8.0\r\n    });\r\n    // Prepare canvas using PDF page dimensions\r\n    var context = this.hiddenCanvas.current.getContext('2d');\r\n    this.hiddenCanvas.current.height = viewport.height;\r\n    this.hiddenCanvas.current.width = viewport.width;\r\n    // Render PDF page into canvas context\r\n    var task = page.render({canvasContext: context, viewport: viewport});\r\n    task.promise.then(this.saveImageToState);\r\n  }\r\n\r\n  loadPdfDocument(pdf) {\r\n    this.pdfDocument = pdf;\r\n    // Fetch the first page\r\n    this.setState({totalPageNumber: pdf.numPages, currentPage: 1});\r\n  }\r\n\r\n  processError(error) {\r\n    console.log(error);\r\n  }\r\n\r\n  loadPdfFile(file) {\r\n    var fileReader = new FileReader();\r\n    var lPDFD = this.loadPdfDocument;\r\n    var perr = this.processError;\r\n    this.pdfDocument = null;    \r\n    this.setState({currentPage: 0, totalPageNumber: 0});    \r\n    fileReader.onload = function(ev) {\r\n      var typedarray = new Uint8Array(ev.target.result);\r\n      pdfjsLib.getDocument(typedarray).promise.then(lPDFD, perr);\r\n    };\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    fileReader.readAsArrayBuffer(file);\r\n  }\r\n\r\n  update(prevState) {\r\n    var act = (this.state.file != null && this.state.file.name.endsWith(\".pdf\"));\r\n    if (this.pager.current.state.active !== act) {\r\n      this.pager.current.setState({active: act});\r\n    }\r\n    return act;\r\n  }\r\n\r\n  changePage(dec) {\r\n    if (this.state.totalPageNumber > 0) {\r\n      var cp = parseInt(this.state.currentPage);\r\n      if (!isNaN(cp)) {\r\n        dec ? cp-- : cp++;\r\n        this.setCurrentPage(cp);\r\n      }\r\n    }\r\n  }\r\n\r\n  setCurrentPage(cp) {\r\n    if (cp < 1) {\r\n      cp = 1;\r\n    }\r\n    if (cp > this.state.totalPageNumber) {\r\n      cp = this.state.totalPageNumber;\r\n    }\r\n    this.setState({currentPage: cp});\r\n  }  \r\n\r\n  render() {\r\n    var tp = this.state.totalPageNumber;\r\n    var cp = this.state.currentPage;\r\n    return (\r\n        <ValueChooser \r\n            ref={this.pager}\r\n            dbIconSrc={\"assets/chevron-back-circle-outline.svg\"} \r\n            ibIconSrc={\"assets/chevron-forward-circle-outline.svg\"}\r\n            dbTitle={\"Previous page\"}\r\n            ibTitle={\"Next page\"}\r\n            dbCallback={ () => this.changePage(true) }\r\n            ibCallback={ () => this.changePage(false) }\r\n            prompt={\"Page Nr\"}\r\n            minValue={1}\r\n            maxValue={tp}\r\n            step={1}\r\n            leftSeparator={true}\r\n            className=\"pager\"\r\n            blurAndEnterHandler={ pn => {this.setCurrentPage(pn);} }\r\n            currentValue={cp}\r\n        >\r\n          <canvas id=\"hiddenCanvasForPdfId\" ref={this.hiddenCanvas} style={{display: 'none'}}></canvas>\r\n        </ValueChooser>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PDFRenderer;","import React from 'react';\r\n// import './BusyIndicator.css';\r\n\r\nvar BusyIndicator = React.forwardRef((props, ref) => (\r\n  <div className=\"shield inactive\" ref={ref}>\r\n    <div className=\"viewer-busyind\"></div>\r\n    {props.children}\r\n  </div>\r\n))\r\n\r\nexport default BusyIndicator;\r\n","import React from 'react';\r\nimport Button from './Button';\r\nimport classNames from 'classnames/dedupe';\r\n// import './Dialog.css';\r\n\r\nclass Dialog extends React.Component {\r\n \r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      modal: true,\r\n      active: false\r\n  }\r\n\r\n    this.ok = React.createRef();\r\n    this.cancel = React.createRef();\r\n    this.dialogWrapper = React.createRef();\r\n    this.content = React.createRef();\r\n    this.shield = React.createRef();\r\n\r\n    this.doAccept = this.doAccept.bind(this);\r\n    this.doCancel = this.doCancel.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n\r\n  show() {\r\n    var cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:true, inactive: false});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n    if (this.state.modal) {\r\n      cl = this.shield.current.getAttribute(\"class\");\r\n      cl = classNames(cl, {active:true, inactive: false});\r\n      this.shield.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  hide() {\r\n    var cl = this.shield.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.shield.current.setAttribute(\"class\", cl);\r\n    cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n  }\r\n\r\n  doAccept() {\r\n    if (this.props.acceptCallback != null) {\r\n      this.props.acceptCallback();\r\n    }\r\n    this.setState({active: false});\r\n  }\r\n\r\n  doCancel() {\r\n    this.setState({active: false});\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState == null || this.state.active !== prevState.active) {\r\n      if (this.state.active) {\r\n        this.show();\r\n      }\r\n      else {\r\n        this.hide();\r\n      }\r\n    }\r\n    // if (!this.state.active) {\r\n    //   return;\r\n    // }\r\n  }\r\n\r\n  render() {\r\n    var title = this.props.title;\r\n    var titleClassName = \"dlgtitle\" + (title == null ? \" inactive\" : \" active\");\r\n    return (\r\n      <div className=\"inactive dialogwrapper\" ref={this.dialogWrapper}>\r\n        <div className=\"shield inactive\" ref={this.shield}></div>\r\n        <div className=\"dlg\">\r\n          <div className={titleClassName}>\r\n            {title}\r\n          </div>\r\n          <div className=\"dlgcontent\" ref={this.content}>\r\n            {this.props.children}\r\n          </div>\r\n\r\n          <div className=\"toolbar\">\r\n            <Button name=\"ok\" title={\"Accept\"} ref={this.ok} className={\"active\"} handleClick={ () => this.doAccept() }>\r\n              Ok\r\n            </Button>\r\n\r\n            <div className=\"filler\"></div>\r\n\r\n            <Button name=\"cancel\" title={\"Cancel\"} ref={this.cancel} className={\"active\"} handleClick={ () => this.doCancel() }>\r\n              Cancel\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Dialog;\r\n","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\nimport Paper from './Paper';\r\nimport PDFRenderer from './PDFRenderer';\r\nimport ValueChooser from './ValueChooser';\r\nimport BusyIndicator from './BusyIndicator';\r\nimport Dialog from './Dialog';\r\n// import './Extractor.css';\r\n\r\nvar ZoomContext = React.createContext(1.0);\r\n\r\nclass Extractor extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.pap = React.createRef();\r\n    this.hiddenFileInput = React.createRef();\r\n    this.pdfRend = React.createRef();\r\n    this.zoomer = React.createRef();\r\n    this.busyind = React.createRef();\r\n    this.modDialog = React.createRef();\r\n    this.measurment = React.createRef();\r\n    this.exportFileName = React.createRef();\r\n\r\n    this.processFiles = this.processFiles.bind(this);\r\n    this.loadImage = this.loadImage.bind(this);\r\n    this.doZoom = this.doZoom.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.setShieldActive = this.setShieldActive.bind(this);\r\n    this.showModalDialog = this.showModalDialog.bind(this);\r\n    this.onDialogAccept = this.onDialogAccept.bind(this);\r\n    this.doVectorizeExtern = this.doVectorizeExtern.bind(this);\r\n    this.doVectorizeIntern = this.doVectorizeIntern.bind(this);\r\n    this.showSVGResult = this.showSVGResult.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n\r\n    this.state = {\r\n      polySelection: false,\r\n      zoom: '1.0',\r\n      point: null\r\n    }\r\n\r\n    this.zoomFactor = 0.05;\r\n    this.minZoom = 0.05;\r\n    this.maxZoom = 5.0;\r\n    this.svgString = null;\r\n  }\r\n\r\n  toggleSelectionMode(e) {\r\n    if (this.pap.current == null) {\r\n      return;\r\n    }\r\n    this.pap.current.toggleSelectionMode();\r\n    this.setState({polySelection: this.pap.current.pathSelection});\r\n  }\r\n\r\n  setShieldActive(act) {\r\n    if (this.busyind.current != null) {\r\n      var cl = this.busyind.current.getAttribute(\"class\");\r\n      if (act) {\r\n          cl = classNames(cl, {active:true, inactive: false});\r\n      }\r\n      else {\r\n          cl = classNames(cl, {active:false, inactive: true});\r\n      }\r\n      this.busyind.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  showModalDialog() {\r\n    if (this.modDialog.current != null) {\r\n      this.modDialog.current.setState({active: true});\r\n    }\r\n  }\r\n\r\n  processFiles(e) {\r\n    if (e.target.files != null && e.target.files.length === 1) {\r\n      this.svgString = null;\r\n      if (this.pap.current.allowedTypes.includes(e.target.files.item(0).type) || e.target.files.item(0).name.endsWith(\".pdf\")) {\r\n        // show shield\r\n        this.setShieldActive(true);\r\n        this.pap.current.crBlob = null\r\n        this.pap.current.crImgUrl = null;\r\n          this.pdfRend.current.setState({\r\n          paperSetImage: this.pap.current.loadRasterImage, \r\n          file: e.target.files.item(0)\r\n        });\r\n        this.pap.current.setState({file: e.target.files.item(0)});\r\n      }\r\n      e.target.value = null;\r\n    }\r\n  }\r\n\r\n  doZoom(out, point) {\r\n    var zf = out ? this.zoomFactor : -this.zoomFactor;\r\n    var zoom = parseFloat(this.state.zoom) + zf;\r\n    this.setZoom(zoom, point);\r\n  }\r\n\r\n  setZoom(zoom, point) {\r\n    var z = parseFloat(zoom);\r\n    if (z > this.maxZoom) {\r\n      z = this.maxZoom;\r\n    }\r\n    if (z < this.minZoom) {\r\n      z = this.minZoom;\r\n    }\r\n    this.setState({zoom:parseFloat(z).toPrecision(3), point:point});\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.pdfRend.current.setState({paperSetImage: this.pap.current.loadRasterImage, paperRemoveOldImage: this.pap.current.removeOldImage});\r\n    this.zoomer.current.setState({active: true});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  loadImage(e) {\r\n    e.preventDefault();\r\n    this.hiddenFileInput.current.click();\r\n  }\r\n  \r\n  onDialogAccept() {\r\n    if (this.svgString != null) {\r\n      var meas = null;\r\n      if (this.measurment.current != null) {\r\n        meas = this.measurment.current.value;\r\n      }\r\n      if (meas != null) {\r\n        var key = 'desc=\"';\r\n        var i1 = this.svgString.indexOf(key);\r\n        if (i1 >= 0) {\r\n          var i2 = this.svgString.indexOf('\"', i1 + key.length);\r\n          if (i2 >= 0) {\r\n            var data = this.svgString.substring(0, i1 + key.length) + meas + this.svgString.substring(i2);\r\n            this.svgString = data;\r\n          }\r\n        }\r\n      }\r\n      var fileName = null;\r\n      if (this.exportFileName.current != null) {\r\n        fileName = this.exportFileName.current.value;\r\n      }\r\n      if (fileName != null) {\r\n        var blob = new Blob([this.svgString], {\r\n          \"type\": \"image/svg+xml\"\r\n        });\r\n        var a = document.createElement(\"a\");\r\n        a.download = fileName;\r\n        a.href = URL.createObjectURL(blob);\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n      }\r\n    }\r\n    // var mess = \"Dialog content accepted. \";\r\n    // if (this.measurment.current != null) {\r\n    //   mess += \"Measurment=\" + this.measurment.current.value + \". \";\r\n    // }\r\n    // if (this.exportFileName.current != null) {\r\n    //   mess += \"Will be saved in \" + this.exportFileName.current.value;\r\n    // }\r\n    // console.log(mess);\r\n  }\r\n\r\n  doVectorizeExtern(pngBlob) {\r\n    if (pngBlob == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    var proxyurl = \"\";\r\n    var url = 'https://api.vectorizer.io/v3/vectorize?apikey=69936907-18666295&colors=8&minarea=5&threshold=20';\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"POST\", (proxyurl+url), true); // method, url, async\r\n    xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n    xhr.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\r\n\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState === 4) {      // completed\r\n          if (xhr.status === 200) {    // OK\r\n              var response = xhr.responseText;\r\n              console.log(response.type);\r\n          }\r\n          else {\r\n            console.log(\"Vectorize error: \"+xhr.status);\r\n          }\r\n      }\r\n    }    \r\n    xhr.send(pngBlob);\r\n  }\r\n\r\n  showSVGResult(svgImgStr) {\r\n    this.svgString = svgImgStr;\r\n    this.pap.current.loadResultSVGImage(svgImgStr);\r\n  }\r\n\r\n  doVectorizeIntern(pngImg) {\r\n    if (pngImg == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    if (window.ImageTracer != null) {\r\n      window.ImageTracer.imageToSVG(pngImg, this.showSVGResult);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var curzoom = this.state.zoom;\r\n    var point = this.state.point;\r\n    var selIcon = this.state.polySelection ? \"assets/square-dashed-outline.svg\" : \"assets/analytics-outline.svg\";\r\n    return (\r\n        <div className=\"main\">\r\n          <ZoomContext.Provider value={curzoom}>\r\n            <div className=\"toolbar shadow\">\r\n\r\n              <Button name=\"load\" title={\"Load file\"} className={\"active\"} handleClick={ (e) => this.loadImage(e) }>\r\n                <img alt={\"Load file\"} src=\"assets/image-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"clear\" title={\"Clear canvas\"} className={\"active\"} handleClick={ () => {\r\n                    this.svgString = null;\r\n                    this.pap.current.clearCanvas();\r\n                    this.pdfRend.current.setState({\r\n                      file: null\r\n                    });\r\n                  } }>\r\n                <img alt={\"Clear canvas\"} src=\"assets/close-circle-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"sel_mode\" title={\"Selection mode\"} className={\"active\"} handleClick={ (e) => { this.toggleSelectionMode(e) } }>\r\n                <img alt={\"Selection mode\"} src={selIcon}></img>\r\n              </Button>\r\n\r\n              <Button name=\"crop\" title={\"Crop image\"} className={\"active\"} handleClick={ () => { this.setShieldActive(true); this.pap.current.cropImage();} }>\r\n                <img alt={\"Crop\"} src=\"assets/crop-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeIntern(this.pap.current.crImgUrl) }>\r\n              {/* <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeExtern(this.pap.current.crBlob) }> */}\r\n                <img alt={\"Vectorize\"} src=\"assets/vector.svg\"></img>\r\n              </Button>\r\n              <Button name=\"save\" title={\"Save\"} className={\"active\"} handleClick={ () => this.showModalDialog() }>\r\n                <img alt={\"Save\"} src=\"assets/save-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <PDFRenderer ref={this.pdfRend} shieldHandler={this.setShieldActive}/>\r\n\r\n              <div className=\"filler\"></div>\r\n\r\n              <Button name=\"reset_position\" title={\"Reset position\"} className={\"active\"} handleClick={ () => this.pap.current.resetPosition() }>\r\n                <img alt={\"Reset position\"} src=\"assets/locate.svg\"></img>\r\n              </Button>\r\n              <Button name=\"reset_zoom\" title={\"Reset zoom\"} className={\"active\"} handleClick={ () => this.setState({zoom:1.0}) }>\r\n                <img alt={\"Reset zoom\"} src=\"assets/zoom-to-actual-size.svg\"></img>\r\n              </Button>\r\n\r\n              <ValueChooser \r\n                ref={this.zoomer}\r\n                dbIconSrc={\"assets/zoom-in.svg\"} \r\n                ibIconSrc={\"assets/zoom-out.svg\"}\r\n                dbTitle={\"Zoom in\"}\r\n                ibTitle={\"Zoom out\"}\r\n                dbCallback={ () => this.doZoom(true) }\r\n                ibCallback={ () => this.doZoom(false) }\r\n                prompt={\"Zoom\"}\r\n                minValue={0.05}\r\n                maxValue={5.0}\r\n                step={0.05}\r\n                className=\"zoomer\"\r\n                blurAndEnterHandler={ newZoom => { this.setZoom(newZoom)} }\r\n                currentValue={curzoom}\r\n            >\r\n            </ValueChooser>\r\n\r\n            </div>\r\n\r\n            <div className=\"sand shadow\">\r\n              <Paper \r\n                ref={this.pap} \r\n                zoom={curzoom}\r\n                point={point}\r\n                onMouseWheelZoom={this.doZoom}\r\n                resetZoom={() => this.setState({zoom:1.0})}\r\n                shieldHandler={this.setShieldActive}\r\n              /> \r\n            </div>\r\n          </ZoomContext.Provider>\r\n\r\n          <input ref={this.hiddenFileInput} type=\"file\" style={{display: 'none'}} onChange={this.processFiles}/>\r\n\r\n          <BusyIndicator ref={this.busyind}/>\r\n\r\n          <Dialog ref={this.modDialog} acceptCallback={this.onDialogAccept} title={\"Save dialog\"}>\r\n            <div className={\"dlgrow\"}>\r\n              <label>Measurement</label>\r\n              <input ref={this.measurment} type=\"text\" placeholder={\"30 ft\"}></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>File name</label>\r\n              <input ref={this.exportFileName} type=\"text\"></input>\r\n            </div>\r\n          </Dialog>\r\n\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Extractor;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Extractor from './components/Extractor';\nimport './App.css';\n\nReactDOM.render(<Extractor />, document.getElementById('root'))\n"],"sourceRoot":""}