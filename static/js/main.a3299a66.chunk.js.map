{"version":3,"sources":["components/Button.js","components/Paper.js","components/ValueChooser.js","components/PDFRenderer.js","components/BusyIndicator.js","components/Dialog.js","components/Extractor.js","index.js"],"names":["Button","React","forwardRef","props","ref","onClick","handleClick","title","className","disabled","children","b64toBlob","b64Data","contentType","sliceSize","byteCharacters","atob","byteArrays","offset","length","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","type","polygonPositionHandler","dim","finalMatrix","fabricObject","x","points","this","pointIndex","pathOffset","y","fabric","util","transformPoint","multiplyTransformMatrices","canvas","viewportTransform","calcTransformMatrix","actionHandler","eventData","transform","polygon","target","currentControl","controls","__corner","mouseLocalPosition","toLocalPoint","Point","polygonBaseSize","_getNonTransformedDimensions","size","_getTransformedDimensions","finalPointPosition","resizePolygon","peer","activeObject","paper","getActiveObject","setActiveObject","mask","edit","objectCaching","Object","prototype","cornerStyle","cornerColor","transparentCorners","borderColor","hasBorders","requestRenderAll","Paper","state","file","updateViewBoxPosition","bind","setZoom","resetPosition","clearCanvas","cropImage","loadRasterImage","loadSVGImage","loadResultSVGImage","loadCropedImage","cancelMask","onKeyDown","removeOldImage","toggleSelectionMode","polyModeMouseDown","rectModeMouseDown","isCropEnabled","removeProcessedImages","wrapper","createRef","paperId","pathSelection","activeLine","lineArray","pointArray","crBlob","crImgUrl","startPos","moveFlag","newFlag","mdp","pausePanning","allowedTypes","imageOptions","hasControls","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockScewingX","lockScewingY","lockRotation","selectable","hoverCursor","locPaper","items","getObjects","reverse","forEach","item","id","remove","opt","pt","getPointer","point","onMouseWheelZoom","e","deltaY","preventDefault","stopPropagation","evt","ctrlKey","obj","findTarget","lastControl","reduce","acc","index","anchorIndex","fn","Control","positionHandler","absolutePoint","actionPerformed","_setPositionDimensions","newX","newY","setPositionByOrigin","actionName","editPolygon","deselected","selected","startsWith","screenX","screenY","polyModeMouseUp","endPos","set","width","Math","abs","height","o","left","top","setCoords","polyModeMouseMove","rectModeMouseMove","setWidth","current","offsetWidth","setHeight","offsetHeight","renderAll","deltaX","delta","relativePan","val","getVpCenter","zoomToPoint","absolutePan","keyCode","resetZoom","clear","setState","cropButtonStateHandler","discardActiveObject","zoomF","getZoom","tco","getCoords","right","bottom","cropX","cropY","mco","scaleX","scaleY","dirty","clipPath","mc","getCenterPoint","tc","originX","originY","optObj","withoutTransform","withoutShadow","cloned","toDataURL","split","vectButtonStateHandler","Image","fromURL","img","scaleToHeight","getHeight","scaleToWidth","getWidth","add","center","fire","shieldHandler","svgString","loadSVGFromString","crossOrigin","objects","options","groupSVGElements","w","h","line","Polygon","moveable","fill","stroke","strokeDashArray","strokeWidth","opacity","setControlVisible","toggleDrawPolygon","generatePolygon","curpos","pointOption","Date","getTime","radius","linePoints","Circle","Line","evented","class","get","polyPoint","addPoint","pointer","x2","y2","rectMaskOptions","selectionBorderColor","cornerStrokeColor","hasBorder","Rect","pos","found","selection","on","onMouseWheel","onMouseDown","onMouseUp","onMouseMove","onMouseDblclick","onSelectionCleared","onSelectionCreated","window","addEventListener","onWindowResize","Canvas","tabIndex","initCanvas","prevProps","prevState","zoom","includes","reader","FileReader","callback","onload","f","result","readAsText","readAsDataURL","Component","ValueChooser","active","value","decrementButton","incrementButton","mainContainer","input","leftSeparator","rightSeparator","update","onBlurI","onFocusI","oldInputValue","cl","getAttribute","classNames","inactive","setAttribute","currentValue","cur","parseFloat","min","max","isNaN","blurAndEnterHandler","clName","dbTitle","dbCallback","alt","src","dbIconSrc","placeholder","prompt","minValue","maxValue","step","onBlur","onFocus","ibTitle","ibCallback","ibIconSrc","pdfjsLib","require","pdfjsWorker","GlobalWorkerOptions","workerSrc","PDFRenderer","totalPageNumber","currentPage","paperSetImage","paperRemoveOldImage","hiddenCanvas","pager","loadPdfFile","saveImageToState","loadPage","loadPdfDocument","renderPage","processError","changePage","setCurrentPage","pdfDocument","name","endsWith","parseInt","imgStr","pageNumber","pdf","getPage","then","page","viewport","getViewport","scale","context","getContext","render","canvasContext","promise","numPages","error","console","log","fileReader","lPDFD","perr","ev","typedarray","getDocument","readAsArrayBuffer","act","dec","cp","tp","pn","style","display","BusyIndicator","Dialog","modal","ok","cancel","dialogWrapper","content","shield","doAccept","doCancel","show","hide","acceptCallback","titleClassName","ZoomContext","createContext","Extractor","pap","hiddenFileInput","pdfRend","zoomer","busyind","modDialog","measurment","exportFileName","saveButton","cropButton","vectButton","processFiles","loadImage","doZoom","setShieldActive","showModalDialog","onDialogAccept","doVectorizeExtern","doVectorizeIntern","showSVGResult","updateSaveButton","updateCropButton","updateVectButton","polySelection","saveEnabled","cropEnabled","vectEnabled","zoomFactor","minZoom","maxZoom","files","out","zf","z","toPrecision","click","meas","key","i1","indexOf","i2","data","substring","fileName","blob","a","document","createElement","download","href","URL","createObjectURL","body","appendChild","removeChild","pngBlob","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","response","responseText","send","svgImgStr","pngImg","ImageTracer","imageToSVG","curzoom","selIcon","Provider","newZoom","onChange","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.a3299a66.chunk.js","sourcesContent":["import React from 'react';\r\n// import './Button.css';\r\n\r\nvar Button = React.forwardRef((props, ref) => (\r\n  <button\r\n    ref={ref}\r\n    onClick={props.handleClick}\r\n    title={props.title}\r\n    className={props.className}\r\n    disabled={props.disabled === true}\r\n    >{props.children}\r\n  </button>\r\n))\r\n\r\nexport default Button;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\n// import './Paper.css';\r\n\r\nfunction b64toBlob(b64Data, contentType, sliceSize) {\r\n  contentType = contentType || '';\r\n  sliceSize = sliceSize || 512;\r\n\r\n  var byteCharacters = atob(b64Data);\r\n  var byteArrays = [];\r\n\r\n  for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {\r\n      var slice = byteCharacters.slice(offset, offset + sliceSize);\r\n\r\n      var byteNumbers = new Array(slice.length);\r\n      for (var i = 0; i < slice.length; i++) {\r\n          byteNumbers[i] = slice.charCodeAt(i);\r\n      }\r\n\r\n      var byteArray = new Uint8Array(byteNumbers);\r\n\r\n      byteArrays.push(byteArray);\r\n  }\r\n\r\n  var blob = new Blob(byteArrays, {type: contentType});\r\n  return blob;\r\n}\r\n\r\nfunction addPoint(evt, peer) {\r\n  var curpos = peer.paper.getPointer(evt);\r\n  var pointOption = {\r\n    id: new Date().getTime(),\r\n    radius: 5,\r\n    fill: '#ffffff',\r\n    stroke: '#333333',\r\n    strokeWidth: 0.5,\r\n    left: curpos.x,\r\n    top: curpos.y,\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    originX: 'center',\r\n    originY: 'center',\r\n    objectCaching: false,\r\n  };\r\n  var linePoints = [\r\n    curpos.x,\r\n    curpos.y,\r\n    curpos.x,\r\n    curpos.y\r\n  ];\r\n  var lineOption = {\r\n    strokeWidth: 2,\r\n    fill: '#999999',\r\n    stroke: '#999999',\r\n    originX: 'center',\r\n    originY: 'center',\r\n    selectable: false,\r\n    hasBorders: false,\r\n    hasControls: false,\r\n    evented: false,\r\n    objectCaching: false,\r\n  };\r\n\r\n  var point = new fabric.Circle(pointOption);\r\n\r\n  if (peer.pointArray.length === 0) {\r\n    peer.newFlag = true;\r\n    // fill first point with red color\r\n    point.set({\r\n      fill: 'red'\r\n    });\r\n  }\r\n\r\n  var line = new fabric.Line(linePoints, lineOption);\r\n  line.class = 'line';\r\n  \r\n  var polygon = null;\r\n\r\n  if (peer.mask != null) {\r\n    var points = peer.mask.get('points');\r\n    points.push({\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    });\r\n    polygon = new fabric.Polygon(points, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false\r\n    });\r\n    peer.paper.remove(peer.mask);\r\n    peer.paper.add(polygon);\r\n    peer.mask = polygon;\r\n    peer.paper.renderAll();\r\n  } \r\n  else {\r\n    var polyPoint = [{\r\n      x: curpos.x,\r\n      y: curpos.y\r\n    }, ];\r\n    polygon = new fabric.Polygon(polyPoint, {\r\n      stroke: '#333333',\r\n      strokeWidth: 1,\r\n      fill: '#cccccc',\r\n      opacity: 0.3,\r\n      selectable: false,\r\n      hasBorders: false,\r\n      hasControls: false,\r\n      evented: false,\r\n      objectCaching: false,\r\n    });\r\n    peer.mask = polygon;\r\n    peer.paper.add(polygon);\r\n  }\r\n\r\n  peer.activeLine = line;\r\n  peer.pointArray.push(point);\r\n  peer.lineArray.push(line);\r\n\r\n  peer.paper.add(line);\r\n  peer.paper.add(point);\r\n}\r\n\r\nfunction generatePolygon(peer) {\r\n  var points = [];\r\n  for (var point of peer.pointArray) {\r\n    points.push({\r\n      x: point.left,\r\n      y: point.top,\r\n    });\r\n    peer.paper.remove(point);\r\n  }\r\n\r\n  for (var line of peer.lineArray) {\r\n    peer.paper.remove(line);\r\n  }\r\n\r\n  peer.paper.remove(peer.mask).remove(peer.activeLine);\r\n\r\n  var polygon = new fabric.Polygon(points, {\r\n    id: \"mask\",\r\n    objectCaching: false,\r\n    moveable: false,\r\n    selectable: true,\r\n    fill: \"rgba(255,255,0,0.2)\",\r\n    stroke: 'red',\r\n    strokeDashArray: [8, 8],\r\n    strokeWidth: 1,\r\n    opacity: 1.0\r\n});\r\n  peer.paper.add(polygon);\r\n  peer.mask = polygon;\r\n  peer.mask.setControlVisible(\"mtr\", false);\r\n\r\n  toggleDrawPolygon(peer);\r\n  resizePolygon(peer);\r\n}\r\n\r\nfunction toggleDrawPolygon(peer) {\r\n  if (peer.newFlag) {\r\n    // stop draw mode\r\n    peer.activeLine = null;\r\n    peer.lineArray = [];\r\n    peer.pointArray = [];\r\n    peer.newFlag = false;\r\n  } else {\r\n    // start draw mode\r\n    peer.newFlag = true;\r\n  }\r\n}\r\n\r\nfunction editPolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = true;\r\n  activeObject.objectCaching = false;\r\n\r\n  var lastControl = activeObject.points.length - 1;\r\n  activeObject.cornerStyle = 'circle';\r\n  activeObject.controls = activeObject.points.reduce((acc, point, index) => {\r\n    acc['p' + index] = new fabric.Control({\r\n      positionHandler: polygonPositionHandler,\r\n      actionHandler: anchorWrapper(index > 0 ? index - 1 : lastControl, actionHandler),\r\n      actionName: 'modifyPolygon',\r\n      pointIndex: index,\r\n    });\r\n    return acc;\r\n  }, {});\r\n\r\n  activeObject.hasBorders = false;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\nfunction polygonPositionHandler(dim, finalMatrix, fabricObject) {\r\n  var x = (fabricObject.points[this.pointIndex].x - fabricObject.pathOffset.x),\r\n      y = (fabricObject.points[this.pointIndex].y - fabricObject.pathOffset.y);\r\n  \r\n  return fabric.util.transformPoint(\r\n    { x: x, y: y },\r\n    fabric.util.multiplyTransformMatrices(\r\n      fabricObject.canvas.viewportTransform,\r\n      fabricObject.calcTransformMatrix()\r\n    )\r\n  );\r\n}\r\n\r\nfunction actionHandler(eventData, transform, x, y) {\r\n  var polygon = transform.target,\r\n      currentControl = polygon.controls[polygon.__corner],\r\n      mouseLocalPosition = polygon.toLocalPoint(new fabric.Point(x, y), 'center', 'center'),\r\n      polygonBaseSize = polygon._getNonTransformedDimensions(),\r\n      size = polygon._getTransformedDimensions(0, 0),\r\n      finalPointPosition = {\r\n        x: mouseLocalPosition.x * polygonBaseSize.x / size.x + polygon.pathOffset.x,\r\n        y: mouseLocalPosition.y * polygonBaseSize.y / size.y + polygon.pathOffset.y\r\n      };\r\n  polygon.points[currentControl.pointIndex] = finalPointPosition;\r\n  return true;\r\n}\r\n\r\nfunction anchorWrapper(anchorIndex, fn) {\r\n  return function(eventData, transform, x, y) {\r\n    var fabricObject = transform.target,\r\n        absolutePoint = fabric.util.transformPoint({\r\n            x: (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x),\r\n            y: (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y),\r\n        }, fabricObject.calcTransformMatrix()),\r\n        actionPerformed = fn(eventData, transform, x, y);\r\n\r\n    fabricObject._setPositionDimensions({});\r\n\r\n    var polygonBaseSize = fabricObject._getNonTransformedDimensions(),\r\n        newX = (fabricObject.points[anchorIndex].x - fabricObject.pathOffset.x) / polygonBaseSize.x,\r\n        newY = (fabricObject.points[anchorIndex].y - fabricObject.pathOffset.y) / polygonBaseSize.y;\r\n    fabricObject.setPositionByOrigin(absolutePoint, newX + 0.5, newY + 0.5);\r\n    return actionPerformed;\r\n  }\r\n}\r\n\r\nfunction resizePolygon(peer) {\r\n  var activeObject = peer.paper.getActiveObject();\r\n  if (!activeObject) {\r\n    peer.paper.setActiveObject(peer.mask);\r\n    activeObject = peer.mask;\r\n  }\r\n\r\n  activeObject.edit = false;\r\n  activeObject.objectCaching = false;\r\n  activeObject.controls = fabric.Object.prototype.controls;\r\n  activeObject.cornerStyle = 'rect';\r\n  activeObject.cornerColor = 'red';\r\n  activeObject.transparentCorners = true;\r\n  activeObject.borderColor = 'red';\r\n  activeObject.hasBorders = true;\r\n\r\n  peer.paper.requestRenderAll();\r\n}\r\n\r\n\r\nclass Paper extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      file: null\r\n    }   \r\n    this.updateViewBoxPosition = this.updateViewBoxPosition.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.resetPosition = this.resetPosition.bind(this);\r\n    this.clearCanvas = this.clearCanvas.bind(this);\r\n    this.cropImage = this.cropImage.bind(this);\r\n    this.loadRasterImage = this.loadRasterImage.bind(this);\r\n    this.loadSVGImage = this.loadSVGImage.bind(this);\r\n    this.loadResultSVGImage = this.loadResultSVGImage.bind(this);\r\n    this.loadCropedImage = this.loadCropedImage.bind(this);\r\n    this.cancelMask = this.cancelMask.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.removeOldImage = this.removeOldImage.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n    this.polyModeMouseDown = this.polyModeMouseDown.bind(this);\r\n    this.rectModeMouseDown = this.rectModeMouseDown.bind(this);\r\n    this.isCropEnabled = this.isCropEnabled.bind(this);\r\n    this.removeProcessedImages = this.removeProcessedImages.bind(this);\r\n\r\n    this.wrapper = React.createRef();\r\n    this.paperId = React.createRef();\r\n\r\n    this.pathSelection = false;\r\n    this.activeLine = null;\r\n    this.lineArray = [];\r\n    this.pointArray = [];\r\n    this.crBlob = null;\r\n    this.crImgUrl = null;\r\n    this.paper = null;\r\n    this.mask = null;\r\n    this.startPos = null;\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mdp = null;\r\n    this.pausePanning = false;\r\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/svg+xml'];\r\n    this.imageOptions = {\r\n      hasControls: false,\r\n      hasBorders: false,\r\n      lockMovementX: true,\r\n      lockMovementY: true,\r\n      lockScalingX: true,\r\n      lockScalingY: true,\r\n      lockScewingX: true,\r\n      lockScewingY: true,\r\n      lockRotation: true,\r\n      selectable: false,\r\n      hoverCursor: 'default'\r\n    };\r\n  }\r\n\r\n  toggleSelectionMode() {\r\n    if (this.pathSelection) {\r\n      this.pathSelection = false;\r\n    }\r\n    else {\r\n      this.pathSelection = true;\r\n    }\r\n    this.cancelMask();\r\n    if (!this.pathSelection && this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          if (\"target\" !== item.id && \"croped\" !== item.id && \"result\" !== item.id) {\r\n            locPaper.remove(item);\r\n          }\r\n        });\r\n      }\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }  \r\n\r\n  onMouseWheel(opt) {\r\n    var pt = this.paper.getPointer(opt);\r\n    var point = new fabric.Point(pt.x, pt.y);\r\n    this.props.onMouseWheelZoom(opt.e.deltaY < 0, point);\r\n    opt.e.preventDefault();\r\n    opt.e.stopPropagation();\r\n  }\r\n\r\n  onMouseDblclick(evt) {\r\n    if (evt.e.ctrlKey || !this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      var obj = this.paper.findTarget(evt);\r\n      if (obj != null && obj === this.mask) {\r\n        editPolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCleared(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.deselected && evt.deselected.length > 0) {\r\n        evt.deselected.forEach((item) => {\r\n          if (item.id === \"mask\" && item.type === 'polygon') {\r\n            item.edit = false;\r\n            item.controls = fabric.Object.prototype.controls;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectionCreated(evt) {\r\n    if (!this.pathSelection) {\r\n      return;\r\n    }\r\n    if (!this.newFlag && this.mask != null) {\r\n      if (evt.selected && evt.selected.length ===1 && evt.selected[0].id === \"mask\") {\r\n        resizePolygon(this);\r\n      }\r\n    }\r\n  }\r\n\r\n  onMouseDown(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n    if (evt.e.ctrlKey) {\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseDown(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseDown(evt);\r\n    }\r\n  }\r\n\r\n  onMouseUp(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n    }\r\n    else {\r\n      if (this.pathSelection) {\r\n        this.polyModeMouseUp(evt, this);\r\n      }\r\n      else if (this.mask != null) {\r\n        if (this.moveFlag) {\r\n          var endPos = this.paper.getPointer(evt);\r\n          this.mask.set({\r\n            width: Math.abs(endPos.x - this.startPos.x),\r\n            height: Math.abs(endPos.y - this.startPos.y)\r\n          });\r\n          var o = {\r\n            left: this.startPos.x,\r\n            top: this.startPos.y\r\n          };\r\n          if (endPos.x < this.startPos.x) {\r\n            o.left = endPos.x;\r\n          }\r\n          if (endPos.y < this.startPos.y) {\r\n            o.top = endPos.y;\r\n          }\r\n          this.mask.setCoords(o);\r\n          this.paper.setActiveObject(this.mask);\r\n          this.paper.requestRenderAll();\r\n        }\r\n        else if (this.newFlag) {\r\n          this.paper.remove(this.mask);\r\n          this.mask = null;\r\n        }\r\n        this.newFlag = false;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  onMouseMove(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (evt.e.ctrlKey) {\r\n      this.updateViewBoxPosition(evt);\r\n      return;\r\n    }\r\n    if (this.pathSelection) {\r\n      this.polyModeMouseMove(evt, this);\r\n    }\r\n    else {\r\n      this.rectModeMouseMove(evt);\r\n    }\r\n  }\r\n\r\n  onWindowResize(evt) {\r\n    this.paper.setWidth(this.wrapper.current.offsetWidth);\r\n    this.paper.setHeight(this.wrapper.current.offsetHeight);\r\n    this.paper.renderAll();\r\n  }\r\n\r\n  updateViewBoxPosition(evt) {\r\n    if (evt.e.type.startsWith(\"touch\")) {\r\n      return;\r\n    }\r\n    if (this.mdp != null) {\r\n      var deltaX = evt.e.screenX - this.mdp.x;\r\n      var deltaY = evt.e.screenY - this.mdp.y;\r\n      this.mdp = {x:evt.e.screenX, y:evt.e.screenY};\r\n      var delta = new fabric.Point(deltaX, deltaY);\r\n      this.paper.relativePan(delta);\r\n    }\r\n  }\r\n\r\n  setZoom(val, point) {\r\n    var pt = point;\r\n    if (pt == null) {\r\n      pt = this.paper.getVpCenter();\r\n    }\r\n    this.paper.zoomToPoint(pt, val);\r\n  }\r\n\r\n  // reset viewport position to 0,0\r\n  resetPosition() {\r\n    this.paper.absolutePan(new fabric.Point(0, 0));\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    if (e.keyCode === 27) { // ESC\r\n      this.cancelMask(e);\r\n      if (this.pathSelection && this.paper != null) {\r\n        var locPaper = this.paper;\r\n        var items = this.paper.getObjects();\r\n        if (items != null) {\r\n          items = items.reverse();\r\n          items.forEach(function(item){\r\n            if (\"target\" !== item.id && \"croped\" !== item.id && \"result\" !== item.id) {\r\n              locPaper.remove(item);\r\n            }\r\n          });\r\n        }\r\n        this.paper.requestRenderAll();\r\n      }\r\n      }\r\n  }\r\n\r\n  cancelMask(e) {\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    if (this.mask != null) {\r\n      this.paper.remove(this.mask);\r\n      this.mask = null;\r\n    }\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    this.paper.requestRenderAll();\r\n  }\r\n\r\n  removeOldImage() {\r\n    if (this.props.resetZoom != null) {\r\n      this.props.resetZoom();\r\n    }\r\n    this.resetPosition();\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.mask = null;\r\n    this.pointArray = [];\r\n    this.lineArray = [];\r\n    this.activeLine = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          locPaper.remove(item);\r\n        });\r\n      }\r\n      this.paper.clear();\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  removeProcessedImages() {\r\n    this.crBlob = null\r\n    this.crImgUrl = null;\r\n    if (this.paper != null) {\r\n      var locPaper = this.paper;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items = items.reverse();\r\n        items.forEach(function(item){\r\n          if (item.id !== \"target\") {\r\n            locPaper.remove(item);\r\n          }\r\n        });\r\n      }\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  clearCanvas() {\r\n    this.removeOldImage();\r\n    this.setState({file: null});\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n  }\r\n  \r\n  cropImage() {\r\n    if (this.paper != null) {\r\n      this.paper.discardActiveObject();\r\n      this.setZoom(1.0);\r\n      this.resetPosition();\r\n      var target = null;\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        items.forEach((item) => {\r\n          if (item != null && (item.id === \"target\" || item.id === \"croped\")) {\r\n            target = item;\r\n            return false;\r\n          }\r\n        });\r\n      }\r\n      if (target != null) {\r\n        var zoomF = this.paper.getZoom();\r\n        var tco = target.getCoords();\r\n        var left = tco[0].x;\r\n        var right = tco[1].x;\r\n        var top = tco[0].y;\r\n        var bottom = tco[2].y;\r\n        var cropX = 0;\r\n        var cropY = 0;\r\n        var width = target.width;\r\n        var height = target.height;\r\n        var mask = this.mask;\r\n        if (mask != null) {\r\n          var mco = mask.getCoords();\r\n          if (mco[0].x > left) {\r\n            left = mco[0].x;\r\n          }\r\n          if (mco[0].y > top) {\r\n            top = mco[0].y;\r\n          }\r\n          if (mco[2].y < bottom) {\r\n            bottom = mco[2].y;\r\n          }\r\n          if (mco[1].x < right) {\r\n            right = mco[1].x;\r\n          }\r\n          cropX = (left - tco[0].x) / (target.scaleX * zoomF);\r\n          cropY = (top - tco[0].y) / (target.scaleY * zoomF);\r\n          width = (right - left) / (target.scaleX * zoomF);\r\n          height = (bottom - top) / (target.scaleY * zoomF);\r\n          target.dirty = true;\r\n          target.clipPath = mask;\r\n          var mc = mask.getCenterPoint();\r\n          var tc = target.getCenterPoint();\r\n          this.paper.remove(mask);\r\n          mask.originX = 'center';\r\n          mask.originY = 'center';\r\n          mask.left = -(tc.x - mc.x) / (target.scaleX);\r\n          mask.top = -(tc.y - mc.y) / (target.scaleY);\r\n          mask.scaleX = 1.0 * zoomF / (target.scaleX);\r\n          mask.scaleY = 1.0 * zoomF / (target.scaleY);\r\n          mask.setCoords();\r\n          mask.dirty = true;\r\n\r\n          this.paper.renderAll();\r\n        }\r\n        var optObj = {\r\n          left:cropX, \r\n          top:cropY, \r\n          width:width, \r\n          height:height, \r\n          withoutTransform: true, \r\n          withoutShadow: true\r\n        };\r\n        var cloned = target.toDataURL(optObj);\r\n        var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n        this.crBlob = crBlob;\r\n        this.crImgUrl = cloned;\r\n        if (this.props.vectButtonStateHandler != null) {\r\n          this.props.vectButtonStateHandler();\r\n        }\r\n        fabric.Image.fromURL(cloned, this.loadCropedImage);\r\n      }\r\n      if (this.props.resetZoom != null) {\r\n        this.props.resetZoom();\r\n      }\r\n    }\r\n  }\r\n\r\n  loadCropedImage(img) {\r\n    this.clearCanvas();        \r\n    img.set(this.imageOptions);\r\n    img.set({id:\"croped\"});\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(this.paper.getHeight());\r\n    }\r\n    else {\r\n      img.scaleToWidth(this.paper.getWidth());\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.requestRenderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }  \r\n \r\n  loadResultSVGImage(svgString) {\r\n    this.clearCanvas();        \r\n    fabric.loadSVGFromString(svgString, this.loadSVGImage, null, {crossOrigin: 'anonymous', id: 'result'});  \r\n  }\r\n\r\n  loadSVGImage(objects, options) {\r\n    var obj = fabric.util.groupSVGElements(objects, options);\r\n    obj.set(this.imageOptions);\r\n    // obj.needsItsOwnCache = () => {return true};\r\n    this.paper.add(obj);\r\n    obj.center().setCoords();\r\n    obj.set({id: options.id}); \r\n    this.paper.renderAll()\r\n    this.paper.fire('object:modified')\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n  \r\n  loadRasterImage(img) {\r\n    img.set(this.imageOptions);\r\n    img.set({id:\"target\"});\r\n    var w = this.paper.getWidth();\r\n    var h = this.paper.getHeight();\r\n    if (img.height > img.width) {\r\n      img.scaleToHeight(h);\r\n    }\r\n    else if (img.width === img.height) {\r\n      if (w > h) {\r\n        img.scaleToWidth(h);\r\n      }\r\n      else {\r\n        img.scaleToWidth(w);\r\n      }\r\n    }\r\n    else {\r\n      img.scaleToWidth(w);\r\n    }\r\n    this.paper.add(img);\r\n    img.center().setCoords();\r\n\r\n    this.paper.renderAll();\r\n    this.paper.fire('object:modified');\r\n\r\n    var optObj = {\r\n      left:0, \r\n      top:0, \r\n      width:img.width, \r\n      height:img.height, \r\n      withoutTransform: true, \r\n      withoutShadow: true\r\n    };\r\n    var cloned = img.toDataURL(optObj);\r\n    var crBlob = b64toBlob(cloned.split(\",\")[1], \"image/png\");\r\n    this.crBlob = crBlob;\r\n    this.crImgUrl = cloned;\r\n\r\n    if (this.props.vectButtonStateHandler != null) {\r\n      this.props.vectButtonStateHandler();\r\n    }\r\n    if (this.props.cropButtonStateHandler != null) {\r\n      this.props.cropButtonStateHandler();\r\n    }\r\n    // hide shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(false);\r\n    }\r\n  }\r\n\r\n  polyModeMouseDown(o, peer) {\r\n    if (!peer.newFlag && peer.mask != null) {\r\n      return;\r\n    }\r\n    if (peer.mask != null && o.target && o.target.id === this.pointArray[0].id) {\r\n      // when click on the first point\r\n      generatePolygon(peer);\r\n    } else {\r\n      addPoint(o, peer);\r\n    }\r\n  }\r\n  \r\n  polyModeMouseMove(o, peer) {\r\n    if (peer.newFlag) {\r\n      if (peer.activeLine && peer.activeLine.class === 'line') {\r\n        var pointer = peer.paper.getPointer(o);\r\n        peer.activeLine.set({\r\n          x2: pointer.x,\r\n          y2: pointer.y\r\n        });\r\n        var points = peer.mask.get('points');\r\n        points[peer.pointArray.length] = {\r\n          x: pointer.x,\r\n          y: pointer.y,\r\n        };\r\n        peer.mask.set({\r\n          points\r\n        });\r\n      }\r\n      peer.paper.renderAll();\r\n    }\r\n  }\r\n\r\n  polyModeMouseUp(o, peer) {\r\n  }\r\n\r\n  rectModeMouseDown(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    this.startPos = this.paper.getPointer(evt);\r\n    if (this.mask == null) {\r\n      var rectMaskOptions = {\r\n        fill: \"rgba(255,255,0,0.2)\",\r\n        stroke: 'red',\r\n        strokeDashArray: [8, 8],\r\n        \"stroke-width\": 2,\r\n        opacity: 1.0,\r\n        left: this.startPos.x,\r\n        top: this.startPos.y,\r\n        width: 0,\r\n        height: 0,\r\n        evented: true,\r\n        selectable: true,\r\n        lockScewingX: true,\r\n        lockScewingY: true,\r\n        lockRotation: true,\r\n        selectionBorderColor: 'red',\r\n        transparentCorners: true,\r\n        cornerColor: 'red',\r\n        cornerStrokeColor: 'red',\r\n        hasBorder: false,\r\n        id: \"mask\"\r\n      };\r\n      this.newFlag = true;\r\n      this.mask = new fabric.Rect(rectMaskOptions);\r\n      this.paper.add(this.mask);\r\n      this.mask.setControlVisible(\"mtr\", false);\r\n      this.paper.requestRenderAll();\r\n    }\r\n  }\r\n\r\n  rectModeMouseMove(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null && this.startPos != null && this.newFlag) {\r\n      var pos = this.paper.getPointer(evt);\r\n      var w = pos.x - this.startPos.x;\r\n      var h = pos.y - this.startPos.y;\r\n      this.mask.set({\r\n        width: w,\r\n        height: h\r\n      });\r\n      this.paper.requestRenderAll();\r\n      this.moveFlag = true;\r\n    }\r\n  }\r\n\r\n  rectModeMouseUp(evt) {\r\n    if (this.pathSelection) {\r\n      return;\r\n    }\r\n    if (this.mask != null) {\r\n      if (this.moveFlag) {\r\n        var endPos = this.paper.getPointer(evt);\r\n        this.mask.set({\r\n          width: Math.abs(endPos.x - this.startPos.x),\r\n          height: Math.abs(endPos.y - this.startPos.y)\r\n        });\r\n        var o = {\r\n          left: this.startPos.x,\r\n          top: this.startPos.y\r\n        };\r\n        if (endPos.x < this.startPos.x) {\r\n          o.left = endPos.x;\r\n        }\r\n        if (endPos.y < this.startPos.y) {\r\n          o.top = endPos.y;\r\n        }\r\n        this.mask.setCoords(o);\r\n        this.paper.setActiveObject(this.mask);\r\n        this.paper.requestRenderAll();\r\n      }\r\n      else if (this.newFlag) {\r\n        this.paper.remove(this.mask);\r\n        this.mask = null;\r\n      }\r\n    }\r\n    this.moveFlag = false;\r\n    this.newFlag = false;\r\n    this.startPos = null;\r\n    this.mdp = null;\r\n  }\r\n\r\n  isCropEnabled() {\r\n    if (this.paper != null) {\r\n      var items = this.paper.getObjects();\r\n      if (items != null) {\r\n        var found = null;\r\n        items.forEach((item) => {\r\n          if (item != null && (item.id === \"target\" || item.id === \"croped\")) {\r\n            found = item;\r\n            return false;\r\n          }\r\n        });\r\n        return (found != null);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  initCanvas() {\r\n    this.paper.selection = false;\r\n    if (this.props.onMouseWheelZoom != null) {\r\n      this.paper.on('mouse:wheel', this.onMouseWheel.bind(this));\r\n    }\r\n    this.paper.on('mouse:down', this.onMouseDown.bind(this));\r\n    this.paper.on('mouse:up', this.onMouseUp.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:move', this.onMouseMove.bind(this));\r\n    this.paper.on('mouse:dblclick', this.onMouseDblclick.bind(this));\r\n    this.paper.on('selection:cleared', this.onSelectionCleared.bind(this));\r\n    this.paper.on('selection:created', this.onSelectionCreated.bind(this));\r\n    \r\n    window.addEventListener(\"resize\", this.onWindowResize.bind(this)); \r\n  }\r\n\r\n  componentDidMount() {\r\n    this.paper = new fabric.Canvas(this.paperId.current.id, {\r\n      height: this.wrapper.current.offsetHeight,\r\n      width: this.wrapper.current.offsetWidth\r\n    });\r\n    this.wrapper.current.tabIndex = 1;\r\n    this.wrapper.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (this.props.zoom !== this.paper.getZoom()) {\r\n      this.setZoom(this.props.zoom, this.props.point);\r\n    }\r\n    if (this.state.file === null) {\r\n        return;\r\n    }\r\n    var file = this.state.file;\r\n    this.clearCanvas();\r\n    // check type\r\n    if (this.allowedTypes.includes(file.type)) {\r\n      var reader = new FileReader();\r\n      var callback = null;\r\n\r\n      // handle svg\r\n      if (file.type === 'image/svg+xml') {\r\n        callback = this.loadSVGImage;\r\n        reader.onload = function(f) {\r\n          fabric.loadSVGFromString(f.target.result, callback, null, {crossOrigin: 'anonymous', id: 'target'});\r\n        }\r\n        reader.readAsText(file);\r\n        return;\r\n      }\r\n\r\n      // handle image, read file, add to canvas\r\n      callback = this.loadRasterImage;\r\n      reader.onload = function(f) {\r\n        fabric.Image.fromURL(f.target.result, callback);\r\n      }\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n    <div className=\"main\">\r\n      <div className=\"canvasWrapper\" ref={this.wrapper}>\r\n        <canvas id=\"canvasElementId\" className=\"paper\" ref={this.paperId}></canvas>\r\n      </div>\r\n    </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Paper;","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\n// import './ValueChooser.css';\r\n\r\nclass ValueChooser extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            active: false,\r\n            value: null\r\n        }\r\n        this.decrementButton = React.createRef();\r\n        this.incrementButton = React.createRef();\r\n        this.mainContainer = React.createRef();\r\n        this.input = React.createRef();\r\n        this.leftSeparator = React.createRef();\r\n        this.rightSeparator = React.createRef();\r\n\r\n        this.update = this.update.bind(this);\r\n        this.onKeyDown = this.onKeyDown.bind(this);\r\n        this.onBlurI = this.onBlurI.bind(this);\r\n        this.onFocusI = this.onFocusI.bind(this);\r\n\r\n        this.oldInputValue = null; \r\n    }\r\n\r\n    update(prevState, prevProps) {\r\n        var cl;\r\n        if (prevState == null || this.state.active !== prevState.active) {\r\n            cl = this.mainContainer.current.getAttribute(\"class\");\r\n            if (this.state.active) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.mainContainer.current.setAttribute(\"class\", cl);\r\n        }\r\n        if (!this.state.active) {\r\n            return;\r\n        }\r\n        if (prevProps == null || this.props.leftSeparator !== prevProps.leftSeparator) {\r\n            cl = this.leftSeparator.current.getAttribute(\"class\");\r\n            if (this.props.leftSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.leftSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null || this.props.rightSeparator !== prevProps.rightSeparator) {\r\n            cl = this.rightSeparator.current.getAttribute(\"class\");\r\n            if (this.props.rightSeparator) {\r\n                cl = classNames(cl, {active:true, inactive: false});\r\n            }\r\n            else {\r\n                cl = classNames(cl, {active:false, inactive: true});\r\n            }\r\n            this.rightSeparator.current.setAttribute(\"class\", cl);\r\n        }\r\n\r\n        if (prevProps == null) {\r\n            if (prevState == null) {\r\n                this.input.current.value = this.state.value;\r\n            }\r\n        }\r\n        else if (prevProps == null || this.props.currentValue !== this.input.current.value) {\r\n            this.input.current.value = this.props.currentValue;\r\n        }\r\n\r\n        if (this.input.current != null) {\r\n            var cur = parseFloat(this.input.current.value);\r\n            var min = parseFloat(this.input.current.min);\r\n            var max = parseFloat(this.input.current.max);\r\n            if (this.decrementButton.current != null) {\r\n                if (!isNaN(cur) && cur > min) {\r\n                    this.decrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.decrementButton.current.disabled = true;\r\n                }\r\n            }\r\n            if (this.incrementButton.current != null) {\r\n                if (!isNaN(cur) && cur < max) {\r\n                    this.incrementButton.current.disabled = false;\r\n                }\r\n                else {\r\n                    this.incrementButton.current.disabled = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    onKeyDown(e) {\r\n        if (this.props.blurAndEnterHandler != null && e.keyCode === 13  && this.oldInputValue !== this.input.current.value) { // ENTER\r\n            this.props.blurAndEnterHandler(parseFloat(this.input.current.value));\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n\r\n    onBlurI(e) {\r\n        if (this.props.blurAndEnterHandler != null && this.oldInputValue !== this.input.current.value) {\r\n            this.props.blurAndEnterHandler(this.input.current.value);\r\n            this.oldInputValue = null;\r\n        }\r\n    }\r\n\r\n    onFocusI(e) {\r\n        if (this.props.blurAndEnterHandler != null) {\r\n            this.oldInputValue = this.input.current.value;\r\n        }\r\n    }\r\n       \r\n    componentDidUpdate(prevProps, prevState) {\r\n        this.update(prevState, prevProps);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        this.input.current.addEventListener(\"keydown\", this.onKeyDown, true);\r\n        this.update();\r\n    }\r\n  \r\n    render() {\r\n        var clName = \"inactive blockdiv\";\r\n        if (this.props.className != null) {\r\n            clName += \" \" + this.props.className;\r\n        }\r\n        return (\r\n            <div className={clName} ref={this.mainContainer}>\r\n                <div ref={this.leftSeparator} className=\"separator inactive\"></div>\r\n                <Button ref={this.decrementButton} title={this.props.dbTitle} handleClick={ this.props.dbCallback }>\r\n                    <img alt={this.props.dbTitle} src={this.props.dbIconSrc}></img>\r\n                </Button>\r\n                <input \r\n                    className=\"value_input\" \r\n                    ref={this.input} \r\n                    type=\"text\"\r\n                    placeholder={this.props.prompt} \r\n                    min={this.props.minValue}\r\n                    max={this.props.maxValue} \r\n                    step={this.props.step} \r\n                    onBlur={this.onBlurI} \r\n                    onFocus={this.onFocusI}\r\n                    >\r\n                </input>\r\n                <Button ref={this.incrementButton} title={this.props.ibTitle} handleClick={ this.props.ibCallback }>\r\n                    <img alt={this.props.ibTitle}src={this.props.ibIconSrc}></img>\r\n                </Button>\r\n                <div ref={this.rightSeparator} className=\"separator inactive\"></div>\r\n                {this.props.children}\r\n            </div>\r\n        )\r\n  }\r\n}\r\n\r\nexport default ValueChooser;\r\n","import React from 'react';\r\nimport {fabric} from 'fabric';\r\nimport ValueChooser from './ValueChooser';\r\n// import './PDFRenderer.css';\r\n\r\nvar pdfjsLib = require(\"pdfjs-dist/build/pdf.js\");\r\nvar pdfjsWorker = require('pdfjs-dist/build/pdf.worker.entry');\r\npdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n// const PageContext = React.createContext(1);\r\n\r\nclass PDFRenderer extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n        totalPageNumber: 0,\r\n        currentPage: 0,\r\n        paperSetImage: null,\r\n        paperRemoveOldImage: null,\r\n        file: null\r\n    }\r\n    this.hiddenCanvas = React.createRef();\r\n    this.pager = React.createRef();\r\n\r\n    this.update = this.update.bind(this);\r\n    this.loadPdfFile = this.loadPdfFile.bind(this);\r\n    this.saveImageToState = this.saveImageToState.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.loadPdfDocument = this.loadPdfDocument.bind(this);\r\n    this.loadPage = this.loadPage.bind(this);\r\n    this.renderPage = this.renderPage.bind(this);\r\n    this.processError = this.processError.bind(this);\r\n    this.changePage = this.changePage.bind(this);\r\n    this.setCurrentPage = this.setCurrentPage.bind(this);\r\n\r\n    this.pdfDocument = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.update();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.pdfDocument = null;\r\n    this.setState({currentPage: 0, totalPageNumber: 0});\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (!this.update(prevState)) {\r\n      return;\r\n    }\r\n    if (this.state.file === null || !this.state.file.name.endsWith(\".pdf\")) {\r\n        return;\r\n    }\r\n    if (prevState != null) {\r\n      if (prevState.file !== this.state.file) {\r\n        this.loadPdfFile(this.state.file);\r\n        return;\r\n      }\r\n      if (this.state.totalPageNumber >= 1 && this.state.currentPage <= this.state.totalPageNumber && this.pdfDocument != null && this.state.currentPage !== prevState.currentPage) {\r\n        this.loadPage(parseInt(this.state.currentPage), this.pdfDocument);\r\n      }\r\n    }\r\n  }\r\n\r\n  saveImageToState() {\r\n    var imgStr = this.hiddenCanvas.current.toDataURL(\"image/png\");\r\n    if (imgStr != null && this.state.paperSetImage != null) {\r\n      fabric.Image.fromURL(imgStr, this.state.paperSetImage);\r\n    }\r\n  }\r\n\r\n  loadPage(pageNumber, pdf) {\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    if (this.state.paperRemoveOldImage != null) {\r\n      this.state.paperRemoveOldImage();\r\n    }\r\n    pdf.getPage(pageNumber).then(this.renderPage);\r\n  }\r\n\r\n  renderPage(page) {\r\n    var viewport = page.getViewport({\r\n        scale: 8.0\r\n    });\r\n    // Prepare canvas using PDF page dimensions\r\n    var context = this.hiddenCanvas.current.getContext('2d');\r\n    this.hiddenCanvas.current.height = viewport.height;\r\n    this.hiddenCanvas.current.width = viewport.width;\r\n    // Render PDF page into canvas context\r\n    var task = page.render({canvasContext: context, viewport: viewport});\r\n    task.promise.then(this.saveImageToState);\r\n  }\r\n\r\n  loadPdfDocument(pdf) {\r\n    this.pdfDocument = pdf;\r\n    // Fetch the first page\r\n    this.setState({totalPageNumber: pdf.numPages, currentPage: 1});\r\n  }\r\n\r\n  processError(error) {\r\n    console.log(error);\r\n  }\r\n\r\n  loadPdfFile(file) {\r\n    var fileReader = new FileReader();\r\n    var lPDFD = this.loadPdfDocument;\r\n    var perr = this.processError;\r\n    this.pdfDocument = null;    \r\n    this.setState({currentPage: 0, totalPageNumber: 0});    \r\n    fileReader.onload = function(ev) {\r\n      var typedarray = new Uint8Array(ev.target.result);\r\n      pdfjsLib.getDocument(typedarray).promise.then(lPDFD, perr);\r\n    };\r\n    // show shield\r\n    if (this.props.shieldHandler != null) {\r\n      this.props.shieldHandler(true);\r\n    }\r\n    fileReader.readAsArrayBuffer(file);\r\n  }\r\n\r\n  update(prevState) {\r\n    var act = (this.state.file != null && this.state.file.name.endsWith(\".pdf\"));\r\n    if (this.pager.current.state.active !== act) {\r\n      this.pager.current.setState({active: act});\r\n    }\r\n    return act;\r\n  }\r\n\r\n  changePage(dec) {\r\n    if (this.state.totalPageNumber > 0) {\r\n      var cp = parseInt(this.state.currentPage);\r\n      if (!isNaN(cp)) {\r\n        dec ? cp-- : cp++;\r\n        this.setCurrentPage(cp);\r\n      }\r\n    }\r\n  }\r\n\r\n  setCurrentPage(cp) {\r\n    if (cp < 1) {\r\n      cp = 1;\r\n    }\r\n    if (cp > this.state.totalPageNumber) {\r\n      cp = this.state.totalPageNumber;\r\n    }\r\n    this.setState({currentPage: cp});\r\n  }  \r\n\r\n  render() {\r\n    var tp = this.state.totalPageNumber;\r\n    var cp = this.state.currentPage;\r\n    return (\r\n        <ValueChooser \r\n            ref={this.pager}\r\n            dbIconSrc={\"assets/chevron-back-circle-outline.svg\"} \r\n            ibIconSrc={\"assets/chevron-forward-circle-outline.svg\"}\r\n            dbTitle={\"Previous page\"}\r\n            ibTitle={\"Next page\"}\r\n            dbCallback={ () => this.changePage(true) }\r\n            ibCallback={ () => this.changePage(false) }\r\n            prompt={\"Page Nr\"}\r\n            minValue={1}\r\n            maxValue={tp}\r\n            step={1}\r\n            leftSeparator={true}\r\n            className=\"pager\"\r\n            blurAndEnterHandler={ pn => {this.setCurrentPage(pn);} }\r\n            currentValue={cp}\r\n        >\r\n          <canvas id=\"hiddenCanvasForPdfId\" ref={this.hiddenCanvas} style={{display: 'none'}}></canvas>\r\n        </ValueChooser>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PDFRenderer;","import React from 'react';\r\n// import './BusyIndicator.css';\r\n\r\nvar BusyIndicator = React.forwardRef((props, ref) => (\r\n  <div className=\"shield inactive\" ref={ref}>\r\n    <div className=\"viewer-busyind\"></div>\r\n    {props.children}\r\n  </div>\r\n))\r\n\r\nexport default BusyIndicator;\r\n","import React from 'react';\r\nimport Button from './Button';\r\nimport classNames from 'classnames/dedupe';\r\n// import './Dialog.css';\r\n\r\nclass Dialog extends React.Component {\r\n \r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      modal: true,\r\n      active: false\r\n  }\r\n\r\n    this.ok = React.createRef();\r\n    this.cancel = React.createRef();\r\n    this.dialogWrapper = React.createRef();\r\n    this.content = React.createRef();\r\n    this.shield = React.createRef();\r\n\r\n    this.doAccept = this.doAccept.bind(this);\r\n    this.doCancel = this.doCancel.bind(this);\r\n    this.show = this.show.bind(this);\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n\r\n  show() {\r\n    var cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:true, inactive: false});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n    if (this.state.modal) {\r\n      cl = this.shield.current.getAttribute(\"class\");\r\n      cl = classNames(cl, {active:true, inactive: false});\r\n      this.shield.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  hide() {\r\n    var cl = this.shield.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.shield.current.setAttribute(\"class\", cl);\r\n    cl = this.dialogWrapper.current.getAttribute(\"class\");\r\n    cl = classNames(cl, {active:false, inactive: true});\r\n    this.dialogWrapper.current.setAttribute(\"class\", cl);\r\n  }\r\n\r\n  doAccept() {\r\n    if (this.props.acceptCallback != null) {\r\n      this.props.acceptCallback();\r\n    }\r\n    this.setState({active: false});\r\n  }\r\n\r\n  doCancel() {\r\n    this.setState({active: false});\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState == null || this.state.active !== prevState.active) {\r\n      if (this.state.active) {\r\n        this.show();\r\n      }\r\n      else {\r\n        this.hide();\r\n      }\r\n    }\r\n    // if (!this.state.active) {\r\n    //   return;\r\n    // }\r\n  }\r\n\r\n  render() {\r\n    var title = this.props.title;\r\n    var titleClassName = \"dlgtitle\" + (title == null ? \" inactive\" : \" active\");\r\n    return (\r\n      <div className=\"inactive dialogwrapper\" ref={this.dialogWrapper}>\r\n        <div className=\"shield inactive\" ref={this.shield}></div>\r\n        <div className=\"dlg\">\r\n          <div className={titleClassName}>\r\n            {title}\r\n          </div>\r\n          <div className=\"dlgcontent\" ref={this.content}>\r\n            {this.props.children}\r\n          </div>\r\n\r\n          <div className=\"toolbar\">\r\n            <Button name=\"ok\" title={\"Accept\"} ref={this.ok} className={\"active\"} handleClick={ () => this.doAccept() }>\r\n              Ok\r\n            </Button>\r\n\r\n            <div className=\"filler\"></div>\r\n\r\n            <Button name=\"cancel\" title={\"Cancel\"} ref={this.cancel} className={\"active\"} handleClick={ () => this.doCancel() }>\r\n              Cancel\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Dialog;\r\n","import React from 'react';\r\nimport classNames from 'classnames/dedupe';\r\nimport Button from './Button';\r\nimport Paper from './Paper';\r\nimport PDFRenderer from './PDFRenderer';\r\nimport ValueChooser from './ValueChooser';\r\nimport BusyIndicator from './BusyIndicator';\r\nimport Dialog from './Dialog';\r\n// import './Extractor.css';\r\n\r\nvar ZoomContext = React.createContext(1.0);\r\n\r\nclass Extractor extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props)\r\n\r\n    this.pap = React.createRef();\r\n    this.hiddenFileInput = React.createRef();\r\n    this.pdfRend = React.createRef();\r\n    this.zoomer = React.createRef();\r\n    this.busyind = React.createRef();\r\n    this.modDialog = React.createRef();\r\n    this.measurment = React.createRef();\r\n    this.exportFileName = React.createRef();\r\n    this.saveButton = React.createRef();\r\n    this.cropButton = React.createRef();\r\n    this.vectButton = React.createRef();\r\n\r\n\r\n    this.processFiles = this.processFiles.bind(this);\r\n    this.loadImage = this.loadImage.bind(this);\r\n    this.doZoom = this.doZoom.bind(this);\r\n    this.setZoom = this.setZoom.bind(this);\r\n    this.setShieldActive = this.setShieldActive.bind(this);\r\n    this.showModalDialog = this.showModalDialog.bind(this);\r\n    this.onDialogAccept = this.onDialogAccept.bind(this);\r\n    this.doVectorizeExtern = this.doVectorizeExtern.bind(this);\r\n    this.doVectorizeIntern = this.doVectorizeIntern.bind(this);\r\n    this.showSVGResult = this.showSVGResult.bind(this);\r\n    this.toggleSelectionMode = this.toggleSelectionMode.bind(this);\r\n    this.updateSaveButton = this.updateSaveButton.bind(this);\r\n    this.updateCropButton = this.updateCropButton.bind(this);\r\n    this.updateVectButton = this.updateVectButton.bind(this);\r\n    \r\n    this.state = {\r\n      polySelection: false,\r\n      zoom: '1.0',\r\n      point: null,\r\n      saveEnabled: false,\r\n      cropEnabled: false,\r\n      vectEnabled: false\r\n    }\r\n\r\n    this.zoomFactor = 0.05;\r\n    this.minZoom = 0.05;\r\n    this.maxZoom = 5.0;\r\n    this.svgString = null;\r\n  }\r\n\r\n  toggleSelectionMode(e) {\r\n    if (this.pap.current == null) {\r\n      return;\r\n    }\r\n    this.pap.current.toggleSelectionMode();\r\n    this.setState({polySelection: this.pap.current.pathSelection});\r\n  }\r\n\r\n  setShieldActive(act) {\r\n    if (this.busyind.current != null) {\r\n      var cl = this.busyind.current.getAttribute(\"class\");\r\n      if (act) {\r\n          cl = classNames(cl, {active:true, inactive: false});\r\n      }\r\n      else {\r\n          cl = classNames(cl, {active:false, inactive: true});\r\n      }\r\n      this.busyind.current.setAttribute(\"class\", cl);\r\n    }\r\n  }\r\n\r\n  showModalDialog() {\r\n    if (this.modDialog.current != null) {\r\n      this.modDialog.current.setState({active: true});\r\n    }\r\n  }\r\n\r\n  processFiles(e) {\r\n    if (e.target.files != null && e.target.files.length === 1) {\r\n      this.svgString = null;\r\n      this.updateSaveButton();      \r\n      if (this.pap.current.allowedTypes.includes(e.target.files.item(0).type) || e.target.files.item(0).name.endsWith(\".pdf\")) {\r\n        // show shield\r\n        this.setShieldActive(true);\r\n        this.pap.current.crBlob = null\r\n        this.pap.current.crImgUrl = null;\r\n        this.updateVectButton();      \r\n        this.pdfRend.current.setState({\r\n          paperSetImage: this.pap.current.loadRasterImage, \r\n          file: e.target.files.item(0)\r\n        });\r\n        this.pap.current.setState({file: e.target.files.item(0)});\r\n      }\r\n      e.target.value = null;\r\n    }\r\n  }\r\n\r\n  doZoom(out, point) {\r\n    var zf = out ? this.zoomFactor : -this.zoomFactor;\r\n    var zoom = parseFloat(this.state.zoom) + zf;\r\n    this.setZoom(zoom, point);\r\n  }\r\n\r\n  setZoom(zoom, point) {\r\n    var z = parseFloat(zoom);\r\n    if (z > this.maxZoom) {\r\n      z = this.maxZoom;\r\n    }\r\n    if (z < this.minZoom) {\r\n      z = this.minZoom;\r\n    }\r\n    this.setState({zoom:parseFloat(z).toPrecision(3), point:point});\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.pdfRend.current.setState({paperSetImage: this.pap.current.loadRasterImage, paperRemoveOldImage: this.pap.current.removeOldImage});\r\n    this.zoomer.current.setState({active: true});\r\n    this.updateSaveButton();\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  loadImage(e) {\r\n    e.preventDefault();\r\n    this.hiddenFileInput.current.click();\r\n  }\r\n  \r\n  onDialogAccept() {\r\n    if (this.svgString != null) {\r\n      var meas = null;\r\n      if (this.measurment.current != null) {\r\n        meas = this.measurment.current.value;\r\n      }\r\n      if (meas == null) {\r\n        meas = \"\";\r\n      }\r\n      var key = 'desc=\"';\r\n      var i1 = this.svgString.indexOf(key);\r\n      if (i1 >= 0) {\r\n        var i2 = this.svgString.indexOf('\"', i1 + key.length);\r\n        if (i2 >= 0) {\r\n          var data = this.svgString.substring(0, i1 + key.length) + meas + this.svgString.substring(i2);\r\n          this.svgString = data;\r\n        }\r\n      }\r\n      var fileName = null;\r\n      if (this.exportFileName.current != null) {\r\n        fileName = this.exportFileName.current.value;\r\n      }\r\n      if (fileName != null) {\r\n        var blob = new Blob([this.svgString], {\r\n          \"type\": \"image/svg+xml\"\r\n        });\r\n        var a = document.createElement(\"a\");\r\n        a.download = fileName;\r\n        a.href = URL.createObjectURL(blob);\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n      }\r\n    }\r\n  }\r\n\r\n  doVectorizeExtern(pngBlob) {\r\n    if (pngBlob == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    var proxyurl = \"\";\r\n    var url = 'https://api.vectorizer.io/v3/vectorize?apikey=69936907-18666295&colors=8&minarea=5&threshold=20';\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"POST\", (proxyurl+url), true); // method, url, async\r\n    xhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\r\n    xhr.setRequestHeader(\"Content-Type\", \"multipart/form-data\");\r\n\r\n    xhr.onreadystatechange = function() {\r\n      if (xhr.readyState === 4) {      // completed\r\n          if (xhr.status === 200) {    // OK\r\n              var response = xhr.responseText;\r\n              console.log(response.type);\r\n          }\r\n          else {\r\n            console.log(\"Vectorize error: \"+xhr.status);\r\n          }\r\n      }\r\n    }    \r\n    xhr.send(pngBlob);\r\n  }\r\n\r\n  showSVGResult(svgImgStr) {\r\n    this.svgString = svgImgStr;\r\n    this.updateSaveButton();\r\n    this.pap.current.loadResultSVGImage(svgImgStr);\r\n  }\r\n\r\n  doVectorizeIntern(pngImg) {\r\n    if (pngImg == null) {\r\n      return;\r\n    }\r\n    // show shield\r\n    this.setShieldActive(true);\r\n    if (window.ImageTracer != null) {\r\n      window.ImageTracer.imageToSVG(pngImg, this.showSVGResult);\r\n    }\r\n  }\r\n\r\n  updateSaveButton() {\r\n    if (this.saveButton.current != null) {\r\n      if (this.svgString != null) {\r\n        this.setState({saveEnabled: true});\r\n      }\r\n      else {\r\n        this.setState({saveEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  updateCropButton() {\r\n    if (this.cropButton.current != null) {\r\n      if (this.pap.current != null) {\r\n        this.setState({cropEnabled: this.pap.current.isCropEnabled()});\r\n      }\r\n      else {\r\n        this.setState({cropEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  updateVectButton() {\r\n    if (this.vectButton.current != null) {\r\n      if (this.pap.current != null && this.pap.current.crImgUrl != null) {\r\n        this.setState({vectEnabled: true});\r\n      }\r\n      else {\r\n        this.setState({vectEnabled: false});\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    var curzoom = this.state.zoom;\r\n    var point = this.state.point;\r\n    var selIcon = this.state.polySelection ? \"assets/square-dashed-outline.svg\" : \"assets/analytics-outline.svg\";\r\n    return (\r\n        <div className=\"main\">\r\n          <ZoomContext.Provider value={curzoom}>\r\n            <div className=\"toolbar shadow\">\r\n\r\n              <Button name=\"load\" title={\"Load file\"} className={\"active\"} handleClick={ (e) => this.loadImage(e) }>\r\n                <img alt={\"Load file\"} src=\"assets/image-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"clear\" title={\"Clear canvas\"} className={\"active\"} handleClick={ () => {\r\n                    this.svgString = null;\r\n                    this.pap.current.removeProcessedImages();\r\n                    this.pap.current.clearCanvas();\r\n                    this.pdfRend.current.setState({\r\n                      file: null\r\n                    });\r\n                    this.updateSaveButton();\r\n                    this.updateCropButton();\r\n                    this.updateVectButton();\r\n                  } }>\r\n                <img alt={\"Clear canvas\"} src=\"assets/close-circle-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <Button name=\"sel_mode\" \r\n                title={\"Selection mode\"} \r\n                className={\"active\"} \r\n                handleClick={ (e) => { this.toggleSelectionMode(e) } }\r\n              >\r\n                <img alt={\"Selection mode\"} src={selIcon}></img>\r\n              </Button>\r\n\r\n              <Button name=\"crop\" \r\n                ref={this.cropButton} \r\n                title={\"Crop image\"} \r\n                className={\"active\"} \r\n                handleClick={ () => { this.setShieldActive(true); this.pap.current.cropImage();} }\r\n                disabled={!this.state.cropEnabled}\r\n              >\r\n                <img alt={\"Crop\"} src=\"assets/crop-outline.svg\"></img>\r\n              </Button>\r\n\r\n              {/* <Button name=\"to_vector\" title={\"Vectorize\"} className={\"active\"} handleClick={ () => this.doVectorizeExtern(this.pap.current.crBlob) }> */}\r\n              <Button name=\"to_vector\" \r\n                ref={this.vectButton} \r\n                title={\"Vectorize\"} \r\n                className={\"active\"} \r\n                handleClick={ () => this.doVectorizeIntern(this.pap.current.crImgUrl) }\r\n                disabled={!this.state.vectEnabled}\r\n              >\r\n                <img alt={\"Vectorize\"} src=\"assets/vector.svg\"></img>\r\n              </Button>\r\n              <Button name=\"save\" \r\n                ref={this.saveButton} \r\n                title={\"Save\"} \r\n                className={\"active\"} \r\n                handleClick={ () => this.showModalDialog() }\r\n                disabled={!this.state.saveEnabled}\r\n              >\r\n                <img alt={\"Save\"} src=\"assets/save-outline.svg\"></img>\r\n              </Button>\r\n\r\n              <PDFRenderer ref={this.pdfRend} shieldHandler={this.setShieldActive}/>\r\n\r\n              <div className=\"filler\"></div>\r\n\r\n              <Button name=\"reset_position\" title={\"Reset position\"} className={\"active\"} handleClick={ () => this.pap.current.resetPosition() }>\r\n                <img alt={\"Reset position\"} src=\"assets/locate.svg\"></img>\r\n              </Button>\r\n              <Button name=\"reset_zoom\" title={\"Reset zoom\"} className={\"active\"} handleClick={ () => this.setState({zoom:1.0}) }>\r\n                <img alt={\"Reset zoom\"} src=\"assets/zoom-to-actual-size.svg\"></img>\r\n              </Button>\r\n\r\n              <ValueChooser \r\n                ref={this.zoomer}\r\n                dbIconSrc={\"assets/zoom-in.svg\"} \r\n                ibIconSrc={\"assets/zoom-out.svg\"}\r\n                dbTitle={\"Zoom in\"}\r\n                ibTitle={\"Zoom out\"}\r\n                dbCallback={ () => this.doZoom(true) }\r\n                ibCallback={ () => this.doZoom(false) }\r\n                prompt={\"Zoom\"}\r\n                minValue={0.05}\r\n                maxValue={5.0}\r\n                step={0.05}\r\n                className=\"zoomer\"\r\n                blurAndEnterHandler={ newZoom => { this.setZoom(newZoom)} }\r\n                currentValue={curzoom}\r\n            >\r\n            </ValueChooser>\r\n\r\n            </div>\r\n\r\n            <div className=\"sand shadow\">\r\n              <Paper \r\n                ref={this.pap} \r\n                zoom={curzoom}\r\n                point={point}\r\n                onMouseWheelZoom={this.doZoom}\r\n                resetZoom={() => this.setState({zoom:1.0})}\r\n                shieldHandler={this.setShieldActive}\r\n                cropButtonStateHandler={this.updateCropButton}\r\n                vectButtonStateHandler={this.updateVectButton}\r\n              /> \r\n            </div>\r\n          </ZoomContext.Provider>\r\n\r\n          <input ref={this.hiddenFileInput} type=\"file\" style={{display: 'none'}} onChange={this.processFiles}/>\r\n\r\n          <BusyIndicator ref={this.busyind}/>\r\n\r\n          <Dialog ref={this.modDialog} acceptCallback={this.onDialogAccept} title={\"Save dialog\"}>\r\n            <div className={\"dlgrow\"}>\r\n              <label>Measurement</label>\r\n              <input ref={this.measurment} type=\"text\" placeholder={\"30 ft\"}></input>\r\n            </div>\r\n            <div className={\"dlgrow\"}>\r\n              <label>File name</label>\r\n              <input ref={this.exportFileName} type=\"text\"></input>\r\n            </div>\r\n          </Dialog>\r\n\r\n        </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Extractor;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Extractor from './components/Extractor';\nimport './App.css';\n\nReactDOM.render(<Extractor />, document.getElementById('root'))\n"],"sourceRoot":""}